var IndexedMongo=function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);t.IndexedClient=n.IndexedClient},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2);t.IndexedClient=class e{constructor(e){}close(e){return Promise.resolve(this.db.close())}static connect(t,r){const s=new e(t);return n.Db.open(t).then(e=>(s.db=e,s))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3);class s{constructor(e){this.idb=e,this.collectionQueue=new Set}static open(e,t){const r=self.indexedDB.open(e);return new Promise((e,t)=>{r.addEventListener("error",t),r.addEventListener("success",function(t){let n=new s(r.result);e(n)}),r.onblocked=(e=>{console.log("blocked")})})}get version(){return this.idb?this.idb.version:0}createCollection(e,t={autoIncrement:!0}){if(this.idb.objectStoreNames.contains(e))throw new Error("Collection already exists");if(!this.collectionQueue.size&&!this.DBOpenRequest){let e=this.version+1;this.idb.close(),this.DBOpenRequest=self.indexedDB.open(this.idb.name,e)}return this.collectionQueue.add(e),new Promise((r,s)=>{this.DBOpenRequest.addEventListener("error",s),this.DBOpenRequest.addEventListener("upgradeneeded",s=>{let o=this.DBOpenRequest.result;this.idb=o;const i=o.createObjectStore(e,t);i.transaction.addEventListener("complete",t=>{let s=new n.Collection(i,this.idb);this.collectionQueue.delete(e),r(s)})}),this.DBOpenRequest.onsuccess=(e=>{if(this.collectionQueue.size||!this.DBOpenRequest)throw new Error("Not all collections were created");this.DBOpenRequest=null})})}collection(e){const t=this.idb.transaction(e).objectStore(e);return new n.Collection(t,this.idb)}close(){this.idb.close()}}t.Db=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),s=!0;t.Collection=class{constructor(e,t){this.store=e,this.idb=t}insertOne(e,t){return this.insertMany([e],t).then(e=>({insertedCount:1,insertedId:e.insertedIds[0]}))}insertMany(e,t){return new Promise((t,r)=>{let n=[],s=this.idb.transaction(this.store.name,"readwrite");s.oncomplete=(s=>{n.length===e.length?t({insertedCount:n.length,insertedIds:n}):r("No success")}),s.onerror=r;const o=s.objectStore(this.store.name);for(const t of e){const e=o.add(t);e.onerror=r,e.onsuccess=(t=>{n.push(e.result)})}})}getCursor(e,t=n.CursorOperation.READ,r=!1,s=null){const o=t==n.CursorOperation.READ?"readonly":"readwrite",i=this.idb.transaction(this.store.name,o).objectStore(this.store.name);return new n.Cursor(i,e,t,r,s)}find(e){return this.getCursor(e,n.CursorOperation.READ,!1)}delete(e,t,r){return this.getCursor(e,n.CursorOperation.DELETE,r).getResult().then(e=>({result:{ok:1,n:e.length},deletedCount:e.length}))}update(e,t,r,s){return this.getCursor(e,n.CursorOperation.UPDATE,s,t).getResult().then(e=>({result:{ok:1,n:e.length,nModified:e.length},connection:null,matchedCount:e.length,modifiedCount:e.length,upsertedCount:e.length,upsertedId:{_id:null}}))}deleteMany(e,t){return this.delete(e,t)}deleteOne(e,t){return this.delete(e,t,s)}updateMany(e,t,r){return this.update(e,t,r)}updateOne(e,t,r){return this.update(e,t,r,s)}}},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.DELETE=0]="DELETE",e[e.UPDATE=1]="UPDATE",e[e.READ=2]="READ"}(n=t.CursorOperation||(t.CursorOperation={}));t.Cursor=class{constructor(e,t,r=n.READ,s,o){let i=this.getRequest(e,r,t),u=!1;this.result=new Promise((e,n)=>{i.onerror=(e=>{n(i.error)}),i.onsuccess=(n=>{if(s&&u)return i.onsuccess=null,e(this._result);const l=i.result;return l&&l instanceof IDBCursorWithValue?(this._result=this._result||[],u=this.executeCursorOperation(r,l,t,o),void l.continue()):(this._result=this._result||[].concat(i.result),e(this._result))})})}getRequest(e,t,r){const s=e.keyPath,o=r&&r[s];switch(t){case n.DELETE:if(!r)return e.clear();if(o)return e.delete(o);break;case n.READ:if(!r)return e.getAll();if(o)return e.get(o)}return e.openCursor()}applyFilter(e,t){let r=Object.keys(t);for(const n of r){if(n.startsWith("$"))return;if(e[n]!=t[n])return}return e}executeCursorOperation(e,t,r,s){const o=r?this.applyFilter(t.value,r):t.value;if(!o)return!1;switch(this._result.push(o),e){case n.DELETE:t.delete();break;case n.UPDATE:const r=Object.assign(o,s);t.update(r)}return!0}getResult(){return this.result}toArray(){return this.result.then(e=>Array.from(e))}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9JbmRleGVkTW9uZ28vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vSW5kZXhlZE1vbmdvLy4vc3JjL2luZGV4LnRzIiwid2VicGFjazovL0luZGV4ZWRNb25nby8uL3NyYy9JbmRleGVkQ2xpZW50LnRzIiwid2VicGFjazovL0luZGV4ZWRNb25nby8uL3NyYy9EYi50cyIsIndlYnBhY2s6Ly9JbmRleGVkTW9uZ28vLi9zcmMvQ29sbGVjdGlvbi50cyIsIndlYnBhY2s6Ly9JbmRleGVkTW9uZ28vLi9zcmMvQ3Vyc29yLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiSW5kZXhlZENsaWVudF8xIiwiSW5kZXhlZENsaWVudCIsIkRiXzEiLCJbb2JqZWN0IE9iamVjdF0iLCJkYm5hbWUiLCJmb3JjZSIsIlByb21pc2UiLCJyZXNvbHZlIiwidGhpcyIsImRiIiwiY2xvc2UiLCJvcHRpb25zIiwiY2xpZW50IiwiRGIiLCJvcGVuIiwidGhlbiIsIkNvbGxlY3Rpb25fMSIsImlkYiIsImNvbGxlY3Rpb25RdWV1ZSIsIlNldCIsImNvbGxlY3Rpb25zIiwiREJPcGVuUmVxdWVzdCIsInNlbGYiLCJpbmRleGVkREIiLCJyZWplY3QiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJyZXN1bHQiLCJvbmJsb2NrZWQiLCJlIiwiY29uc29sZSIsImxvZyIsInZlcnNpb24iLCJhdXRvSW5jcmVtZW50Iiwib2JqZWN0U3RvcmVOYW1lcyIsImNvbnRhaW5zIiwiRXJyb3IiLCJzaXplIiwidiIsImFkZCIsInN0b3JlIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJ0cmFuc2FjdGlvbiIsImNvbGxlY3Rpb24iLCJDb2xsZWN0aW9uIiwiZGVsZXRlIiwib25zdWNjZXNzIiwib2JqZWN0U3RvcmUiLCJDdXJzb3JfMSIsIlNJTkdMRSIsImRvY3MiLCJpbnNlcnRNYW55IiwicmVzIiwiaW5zZXJ0ZWRDb3VudCIsImluc2VydGVkSWQiLCJpbnNlcnRlZElkcyIsIm9uY29tcGxldGUiLCJsZW5ndGgiLCJvbmVycm9yIiwiZG9jIiwib2JqZWN0U3RvcmVSZXF1ZXN0IiwicHVzaCIsInF1ZXJ5Iiwib3BlcmF0aW9uIiwiQ3Vyc29yT3BlcmF0aW9uIiwiUkVBRCIsInNpbmdsZSIsInVwZGF0ZSIsIkN1cnNvciIsImdldEN1cnNvciIsImZpbHRlciIsIkRFTEVURSIsImdldFJlc3VsdCIsImRlbGV0ZWQiLCJvayIsImRlbGV0ZWRDb3VudCIsIlVQREFURSIsInVwZGF0ZWQiLCJuTW9kaWZpZWQiLCJjb25uZWN0aW9uIiwibWF0Y2hlZENvdW50IiwibW9kaWZpZWRDb3VudCIsInVwc2VydGVkQ291bnQiLCJ1cHNlcnRlZElkIiwiX2lkIiwicmVxdWVzdCIsImdldFJlcXVlc3QiLCJleGVjdXRlZCIsImVycm9yIiwiX3Jlc3VsdCIsImN1cnNvciIsIklEQkN1cnNvcldpdGhWYWx1ZSIsImV4ZWN1dGVDdXJzb3JPcGVyYXRpb24iLCJjb250aW51ZSIsImNvbmNhdCIsImtleVBhdGgiLCJjbGVhciIsImdldEFsbCIsIm9wZW5DdXJzb3IiLCJmaWx0ZXJLZXlzIiwia2V5cyIsInN0YXJ0c1dpdGgiLCJhcHBseUZpbHRlciIsImFzc2lnbiIsIkFycmF5IiwiZnJvbSJdLCJtYXBwaW5ncyI6IjZCQUNBLElBQUFBLEtBR0EsU0FBQUMs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LFlBQVlaLEVBQU96RyxNQUFPcUYsR0FBVW9CLEVBQU96RyxNQUN2RSxJQUFLQSxFQUNELE9BQU8sRUFHWCxPQURBdUIsS0FBS2lGLFFBQVE1QixLQUFLNUUsR0FDVjhFLEdBQ0osS0FBS0MsRUFBZ0JPLE9BQ2pCbUIsRUFBTzdDLFNBQ1AsTUFDSixLQUFLbUIsRUFBZ0JZLE9BRWpCLE1BQU1DLEVBQVVuRyxPQUFPNkgsT0FBT3RILEVBQU9rRixHQUNyQ3VCLEVBQU92QixPQUFPVSxHQUd0QixPQUFPLEVBR1gxRSxZQUNJLE9BQU9LLEtBQUttQixPQW1GaEJ4QixVQUNJLE9BQU9LLEtBQUttQixPQUFPWixLQUFLWSxHQUNiNkUsTUFBTUMsS0FBSzlFIiwiZmlsZSI6ImluZGV4ZWQtbW9uZ28uanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJpbXBvcnQge0luZGV4ZWRDbGllbnR9IGZyb20gXCIuL0luZGV4ZWRDbGllbnRcIjtcblxuZXhwb3J0IHtJbmRleGVkQ2xpZW50fTsiLCJpbXBvcnQge0RiLCBJRGJ9IGZyb20gXCIuL0RiXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW5kZXhlZENsaWVudE9wdGlvbnMge1xuICAgIGNvbGxlY3Rpb25zPzogc3RyaW5nW11cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJbmRleGVkTW9uZ29DbGllbnRPcHRpb25zIHtcblxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEluZGV4ZWRNb25nb0NsaWVudFN0YXRpYyB7XG4gICAgLy9zdGF0aWMgY29ubmVjdCh1cmk6IHN0cmluZywgb3B0aW9ucz86IE1vbmdvQ2xpZW50T3B0aW9ucyk6IFByb21pc2U8TW9uZ29DbGllbnQ+O1xuICAgIGNvbm5lY3QgKHVyaTogc3RyaW5nLCBvcHRpb25zPzogSW5kZXhlZE1vbmdvQ2xpZW50T3B0aW9ucyk6IFByb21pc2U8SW5kZXhlZE1vbmdvQ2xpZW50PlxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEluZGV4ZWRNb25nb0NsaWVudCB7XG4gICAgZGI6IElEYjtcblxuICAgIGNsb3NlIChmb3JjZT86IGJvb2xlYW4pOiBQcm9taXNlPHZvaWQ+O1xufVxuXG5leHBvcnQgY29uc3QgSW5kZXhlZENsaWVudDogSW5kZXhlZE1vbmdvQ2xpZW50U3RhdGljID0gY2xhc3MgSW5kZXhlZENsaWVudCBpbXBsZW1lbnRzIEluZGV4ZWRNb25nb0NsaWVudCB7XG4gICAgcHVibGljIGRiOiBEYjtcblxuICAgIGNvbnN0cnVjdG9yIChkYm5hbWU6IHN0cmluZykge1xuICAgIH1cblxuICAgIGNsb3NlIChmb3JjZT86IGJvb2xlYW4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLmRiLmNsb3NlKCkpO1xuICAgIH1cblxuICAgIHN0YXRpYyBjb25uZWN0IChuYW1lOiBzdHJpbmcsIG9wdGlvbnM/OiBJbmRleGVkQ2xpZW50T3B0aW9ucyk6IFByb21pc2U8SW5kZXhlZE1vbmdvQ2xpZW50PiB7XG4gICAgICAgIC8vIElmIHRoZSB2ZXJzaW9uIGlzIG5vdCBwcm92aWRlZCBhbmQgdGhlIGRhdGFiYXNlIGV4aXN0cywgdGhlbiBhIGNvbm5lY3Rpb24gdG8gdGhlIGRhdGFiYXNlIHdpbGwgYmUgb3BlbmVkIHdpdGhvdXQgY2hhbmdpbmcgaXRzIHZlcnNpb24uIElmIHRoZSB2ZXJzaW9uIGlzIG5vdCBwcm92aWRlZCBhbmQgdGhlIGRhdGFiYXNlIGRvZXMgbm90IGV4aXN0LCB0aGVuIGl0IHdpbGwgYmUgY3JlYXRlZCB3aXRoIHZlcnNpb24gMS5cbiAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IEluZGV4ZWRDbGllbnQobmFtZSk7XG4gICAgICAgIHJldHVybiBEYi5vcGVuKG5hbWUpLnRoZW4oZGIgPT4ge1xuICAgICAgICAgICAgY2xpZW50LmRiID0gZGI7XG4gICAgICAgICAgICByZXR1cm4gY2xpZW50IGFzIEluZGV4ZWRNb25nb0NsaWVudDtcbiAgICAgICAgfSk7XG4gICAgfVxuXG59OyIsImltcG9ydCB7Q29sbGVjdGlvbiwgQ29sbGVjdGlvbkNyZWF0ZU9wdGlvbnN9IGZyb20gXCIuL0NvbGxlY3Rpb25cIjtcblxuZXhwb3J0IGludGVyZmFjZSBJRGIge1xuICAgIGNyZWF0ZUNvbGxlY3Rpb248VD4gKG5hbWU6IHN0cmluZywgb3B0aW9ucz86IENvbGxlY3Rpb25DcmVhdGVPcHRpb25zKTogUHJvbWlzZTxDb2xsZWN0aW9uPFQ+PjtcblxuICAgIGNvbGxlY3Rpb248VD4gKG5hbWU6IHN0cmluZyk6IENvbGxlY3Rpb248VD47XG59XG5cbmV4cG9ydCBjbGFzcyBEYiBpbXBsZW1lbnRzIElEYiB7XG4gICAgcHJpdmF0ZSBjb2xsZWN0aW9uUXVldWU6IFNldDxzdHJpbmc+ID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgcHJpdmF0ZSBEQk9wZW5SZXF1ZXN0OiBJREJPcGVuREJSZXF1ZXN0O1xuXG4gICAgc3RhdGljIG9wZW4gKG5hbWU6IHN0cmluZywgY29sbGVjdGlvbnM/OiBzdHJpbmdbXSk6IFByb21pc2U8RGI+IHtcblxuICAgICAgICBjb25zdCBEQk9wZW5SZXF1ZXN0ID0gc2VsZi5pbmRleGVkREIub3BlbihuYW1lKTtcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8RGI+KChyZXNvbHZlLCByZWplY3QpID0+IHtcblxuICAgICAgICAgICAgLy8gdGhlc2UgdHdvIGV2ZW50IGhhbmRsZXJzIGFjdCBvbiB0aGUgZGF0YWJhc2UgYmVpbmcgb3BlbmVkXG4gICAgICAgICAgICAvLyBzdWNjZXNzZnVsbHksIG9yIG5vdFxuICAgICAgICAgICAgREJPcGVuUmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIHJlamVjdCk7XG4gICAgICAgICAgICBEQk9wZW5SZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3N1Y2Nlc3MnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAvLyBzdG9yZSB0aGUgcmVzdWx0IG9mIG9wZW5pbmcgdGhlIGRhdGFiYXNlIGluIHRoZSBkYlxuICAgICAgICAgICAgICAgIC8vIHZhcmlhYmxlLiBUaGlzIGlzIHVzZWQgYSBsb3QgbGF0ZXIgb24sIGZvciBvcGVuaW5nXG4gICAgICAgICAgICAgICAgLy8gdHJhbnNhY3Rpb25zIGFuZCBzdWNobGlrZS5cbiAgICAgICAgICAgICAgICBsZXQgZGIgPSBuZXcgRGIoREJPcGVuUmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoZGIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBEQk9wZW5SZXF1ZXN0Lm9uYmxvY2tlZCA9IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Jsb2NrZWQnKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yIChwcml2YXRlIGlkYjogSURCRGF0YWJhc2UpIHtcbiAgICB9XG5cbiAgICBnZXQgdmVyc2lvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlkYiA/IHRoaXMuaWRiLnZlcnNpb24gOiAwO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIG5hbWVcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtICBPcHRpb25hbFxuICAgICAqIEFuIG9wdGlvbnMgb2JqZWN0IHdob3NlIGF0dHJpYnV0ZXMgYXJlIG9wdGlvbmFsIHBhcmFtZXRlcnMgdG8gdGhlIG1ldGhvZC4gSXQgaW5jbHVkZXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOlxuICAgICAqIHwgQXR0cmlidXRlICAgICAgICAgIHwgRGVzY3JpcHRpb24gICAgICAgfFxuICAgICAqIHwgLS0tLS0tLS0tLS0tLS0tLSB8IC0tLS0tLS0tLS0tLS0tLSAgIHxcbiAgICAgKiB8IGtleVBhdGggICAgICAgICAgfCBUaGUga2V5IHBhdGggdG8gYmUgdXNlZCBieSB0aGUgbmV3IG9iamVjdCBzdG9yZS4gSWYgZW1wdHkgb3Igbm90IHNwZWNpZmllZCwgdGhlIG9iamVjdCBzdG9yZSBpcyBjcmVhdGVkIHdpdGhvdXQgYSBrZXkgcGF0aCBhbmQgdXNlcyBvdXQtb2YtbGluZSBrZXlzLiBZb3UgY2FuIGFsc28gcGFzcyBpbiBhbiBhcnJheSBhcyBhIGtleVBhdGguIHxcbiAgICAgKiB8IGF1dG9JbmNyZW1lbnQgICAgfCBJZiB0cnVlLCB0aGUgb2JqZWN0IHN0b3JlIGhhcyBhIGtleSBnZW5lcmF0b3IuIERlZmF1bHRzIHRvIGZhbHNlLiB8XG4gICAgICogVW5rbm93biBwYXJhbWV0ZXJzIGFyZSBpZ25vcmVkLlxuICAgICAqL1xuICAgIGNyZWF0ZUNvbGxlY3Rpb248VD4gKG5hbWU6IHN0cmluZywgb3B0aW9uczogSURCT2JqZWN0U3RvcmVQYXJhbWV0ZXJzID0ge2F1dG9JbmNyZW1lbnQgOiB0cnVlfSk6IFByb21pc2U8Q29sbGVjdGlvbjxUPj4ge1xuICAgICAgICBpZiAodGhpcy5pZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhuYW1lKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ29sbGVjdGlvbiBhbHJlYWR5IGV4aXN0c1wiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuY29sbGVjdGlvblF1ZXVlLnNpemUgJiYgIXRoaXMuREJPcGVuUmVxdWVzdCkge1xuICAgICAgICAgICAgbGV0IHYgPSB0aGlzLnZlcnNpb24gKyAxO1xuICAgICAgICAgICAgdGhpcy5pZGIuY2xvc2UoKTtcbiAgICAgICAgICAgIHRoaXMuREJPcGVuUmVxdWVzdCA9IHNlbGYuaW5kZXhlZERCLm9wZW4odGhpcy5pZGIubmFtZSwgdik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uUXVldWUuYWRkKG5hbWUpO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8Q29sbGVjdGlvbjxUPj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgLy8gdGhlc2UgdHdvIGV2ZW50IGhhbmRsZXJzIGFjdCBvbiB0aGUgZGF0YWJhc2UgYmVpbmcgb3BlbmVkXG4gICAgICAgICAgICAvLyBzdWNjZXNzZnVsbHksIG9yIG5vdFxuICAgICAgICAgICAgdGhpcy5EQk9wZW5SZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgcmVqZWN0KTtcblxuICAgICAgICAgICAgdGhpcy5EQk9wZW5SZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3VwZ3JhZGVuZWVkZWQnLCBlID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgZGI6IElEQkRhdGFiYXNlID0gdGhpcy5EQk9wZW5SZXF1ZXN0LnJlc3VsdDtcbiAgICAgICAgICAgICAgICB0aGlzLmlkYiA9IGRiO1xuICAgICAgICAgICAgICAgIC8vVGhpcyBtZXRob2QgY2FuIGJlIGNhbGxlZCBvbmx5IHdpdGhpbiBhIHZlcnNpb25jaGFuZ2UgdHJhbnNhY3Rpb24uXG4gICAgICAgICAgICAgICAgY29uc3Qgc3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZShuYW1lLCBvcHRpb25zKTtcblxuICAgICAgICAgICAgICAgIC8vIFVzZSB0cmFuc2FjdGlvbiBvbmNvbXBsZXRlIHRvIG1ha2Ugc3VyZSB0aGUgb2JqZWN0U3RvcmUgY3JlYXRpb24gaXNcbiAgICAgICAgICAgICAgICAvLyBmaW5pc2hlZCBiZWZvcmUgYWRkaW5nIGRhdGEgaW50byBpdC5cbiAgICAgICAgICAgICAgICBsZXQgdHJhbnNhY3Rpb24gPSBzdG9yZS50cmFuc2FjdGlvbjtcbiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5hZGRFdmVudExpc3RlbmVyKCdjb21wbGV0ZScsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgY29sbGVjdGlvbiA9IG5ldyBDb2xsZWN0aW9uPFQ+KHN0b3JlLCB0aGlzLmlkYik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvblF1ZXVlLmRlbGV0ZShuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShjb2xsZWN0aW9uKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLkRCT3BlblJlcXVlc3Qub25zdWNjZXNzID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNvbGxlY3Rpb25RdWV1ZS5zaXplICYmIHRoaXMuREJPcGVuUmVxdWVzdCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkRCT3BlblJlcXVlc3QgPSBudWxsO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vdCBhbGwgY29sbGVjdGlvbnMgd2VyZSBjcmVhdGVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbGxlY3Rpb248VD4gKG5hbWU6IHN0cmluZyk6IENvbGxlY3Rpb248VD4ge1xuICAgICAgICBjb25zdCBzdG9yZSA9IHRoaXMuaWRiLnRyYW5zYWN0aW9uKG5hbWUpLm9iamVjdFN0b3JlKG5hbWUpO1xuICAgICAgICByZXR1cm4gbmV3IENvbGxlY3Rpb24oc3RvcmUsIHRoaXMuaWRiKTtcbiAgICB9XG5cbiAgICBjbG9zZSAoKSB7XG4gICAgICAgIHRoaXMuaWRiLmNsb3NlKCk7XG4gICAgfVxuXG59IiwiaW1wb3J0IHtDdXJzb3IsIEN1cnNvck9wZXJhdGlvbn0gZnJvbSBcIi4vQ3Vyc29yXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29sbGVjdGlvbkNyZWF0ZU9wdGlvbnMge1xuXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29sbGVjdGlvbkluc2VydE9uZU9wdGlvbnMge1xuXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW5zZXJ0T25lV3JpdGVPcFJlc3VsdCB7XG4gICAgaW5zZXJ0ZWRDb3VudDogbnVtYmVyO1xuICAgIGluc2VydGVkSWQ6IGFueTtcbn1cblxuaW50ZXJmYWNlIEluc2VydFdyaXRlT3BSZXN1bHQge1xuICAgIGluc2VydGVkQ291bnQ6IG51bWJlcjtcbiAgICBpbnNlcnRlZElkczogYW55W107XG59XG5cbi8vVE9ETzogYWRkIHN1cHBvcnQgZm9yIG9wZXJhdG9ycyBsaWtlICRlcVxuZXhwb3J0IHR5cGUgRmlsdGVyUXVlcnk8VD4gPSB7XG4gICAgW1AgaW4ga2V5b2YgVF0/OiBUW1BdIHwge1xuICAgICRlcT86IFRbUF07XG4gICAgJGd0PzogVFtQXTtcbiAgICAkZ3RlPzogVFtQXTtcbiAgICAkaW4/OiBUW1BdW107XG4gICAgJGx0PzogVFtQXTtcbiAgICAkbHRlPzogVFtQXTtcbiAgICAkbmU/OiBUW1BdO1xuICAgICRuaW4/OiBUW1BdW107XG4gICAgJGFuZD86IChGaWx0ZXJRdWVyeTxUW1BdPiB8IFRbUF0pW107XG4gICAgJG9yPzogKEZpbHRlclF1ZXJ5PFRbUF0+IHwgVFtQXSlbXTtcbiAgICAkbm90PzogKEZpbHRlclF1ZXJ5PFRbUF0+IHwgVFtQXSlbXSB8IFRbUF07XG4gICAgJGV4cHI/OiBhbnk7XG4gICAgJGpzb25TY2hlbWE/OiBhbnk7XG4gICAgJG1vZD86IFtudW1iZXIsIG51bWJlcl07XG4gICAgJHJlZ2V4PzogUmVnRXhwO1xuICAgICRvcHRpb25zPzogc3RyaW5nO1xuICAgICR0ZXh0Pzoge1xuICAgICAgICAkc2VhcmNoOiBzdHJpbmc7XG4gICAgICAgICRsYW5ndWFnZT86IHN0cmluZztcbiAgICAgICAgJGNhc2VTZW5zaXRpdmU/OiBib29sZWFuO1xuICAgICAgICAkZGlhY3JhdGljU2Vuc2l0aXZlPzogYm9vbGVhbjtcbiAgICB9O1xuICAgICR3aGVyZTogT2JqZWN0O1xuICAgICRnZW9JbnRlcnNlY3RzPzogT2JqZWN0O1xuICAgICRnZW9XaXRoaW4/OiBPYmplY3Q7XG4gICAgJG5lYXI/OiBPYmplY3Q7XG4gICAgJG5lYXJTcGhlcmU/OiBPYmplY3Q7XG4gICAgJGVsZW1NYXRjaD86IE9iamVjdDtcbiAgICAkc2l6ZT86IG51bWJlcjtcbiAgICAkYml0c0FsbENsZWFyPzogT2JqZWN0O1xuICAgICRiaXRzQWxsU2V0PzogT2JqZWN0O1xuICAgICRiaXRzQW55Q2xlYXI/OiBPYmplY3Q7XG4gICAgJGJpdHNBbnlTZXQ/OiBPYmplY3Q7XG4gICAgW2tleTogc3RyaW5nXTogYW55O1xufTtcbn0gfCB7IFtrZXk6IHN0cmluZ106IGFueSB9O1xuXG5pbnRlcmZhY2UgQ29tbW9uT3B0aW9ucyB7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVwbGFjZU9uZU9wdGlvbnMgZXh0ZW5kcyBDb21tb25PcHRpb25zIHtcbiAgICB1cHNlcnQ/OiBib29sZWFuO1xuICAgIGJ5cGFzc0RvY3VtZW50VmFsaWRhdGlvbj86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGVsZXRlV3JpdGVPcFJlc3VsdE9iamVjdCB7XG4gICAgLy9UaGUgcmF3IHJlc3VsdCByZXR1cm5lZCBmcm9tIE1vbmdvREIsIGZpZWxkIHdpbGwgdmFyeSBkZXBlbmRpbmcgb24gc2VydmVyIHZlcnNpb24uXG4gICAgcmVzdWx0OiB7XG4gICAgICAgIC8vSXMgMSBpZiB0aGUgY29tbWFuZCBleGVjdXRlZCBjb3JyZWN0bHkuXG4gICAgICAgIG9rPzogbnVtYmVyO1xuICAgICAgICAvL1RoZSB0b3RhbCBjb3VudCBvZiBkb2N1bWVudHMgZGVsZXRlZC5cbiAgICAgICAgbj86IG51bWJlcjtcbiAgICB9XG4gICAgLy9UaGUgbnVtYmVyIG9mIGRvY3VtZW50cyBkZWxldGVkLlxuICAgIGRlbGV0ZWRDb3VudD86IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVXcml0ZU9wUmVzdWx0IHtcbiAgICByZXN1bHQ6IHsgb2s6IG51bWJlciwgbjogbnVtYmVyLCBuTW9kaWZpZWQ6IG51bWJlciB9O1xuICAgIGNvbm5lY3Rpb246IGFueTtcbiAgICBtYXRjaGVkQ291bnQ6IG51bWJlcjtcbiAgICBtb2RpZmllZENvdW50OiBudW1iZXI7XG4gICAgdXBzZXJ0ZWRDb3VudDogbnVtYmVyO1xuICAgIHVwc2VydGVkSWQ6IHsgX2lkOiBhbnkgfTtcbn1cblxuZXhwb3J0IHR5cGUgVXBkYXRlUXVlcnk8VD4gPSB7XG4gICAgLy9UT0RPOiB1cGRhdGUgb3BlcmF0b3JzXG59XG5cbmNvbnN0IFNJTkdMRSA9IHRydWU7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUNvbGxlY3Rpb248VD4ge1xuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3NcbiAgICAgKiBAcGFyYW0gb3B0aW9uc1xuICAgICAqL1xuICAgIGluc2VydE9uZSAoZG9jczogT2JqZWN0LCBvcHRpb25zPzogQ29sbGVjdGlvbkluc2VydE9uZU9wdGlvbnMpOiBQcm9taXNlPEluc2VydE9uZVdyaXRlT3BSZXN1bHQ+O1xuXG4gICAgaW5zZXJ0TWFueSAoZG9jczogT2JqZWN0W10sIG9wdGlvbnM/OiBDb2xsZWN0aW9uSW5zZXJ0T25lT3B0aW9ucyk6IFByb21pc2U8SW5zZXJ0V3JpdGVPcFJlc3VsdD47XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBwYXJhbSBxdWVyeVtvcHRpb25hbF1cbiAgICAgKiBUaGUgZmluZCgpIG1ldGhvZCB3aXRoIG5vIHBhcmFtZXRlcnMgcmV0dXJucyBhbGwgZG9jdW1lbnRzIGZyb20gYSBjb2xsZWN0aW9uIGFuZCByZXR1cm5zIGFsbCBmaWVsZHMgZm9yIHRoZSBkb2N1bWVudHMuXG4gICAgICovXG4gICAgZmluZCAocXVlcnk/OiBGaWx0ZXJRdWVyeTxUPik6IEN1cnNvcjxUPjtcblxuICAgIC8vZmluZE9uZTxUPihmaWx0ZXI6IEZpbHRlclF1ZXJ5PFRTY2hlbWE+LCBvcHRpb25zPzogRmluZE9uZU9wdGlvbnMpOiBQcm9taXNlPFQgfCBudWxsPjtcblxuICAgIGRlbGV0ZU1hbnkgKGZpbHRlcjogRmlsdGVyUXVlcnk8VD4sIG9wdGlvbnM/OiBDb21tb25PcHRpb25zKTogUHJvbWlzZTxEZWxldGVXcml0ZU9wUmVzdWx0T2JqZWN0PjtcblxuICAgIGRlbGV0ZU9uZSAoZmlsdGVyOiBGaWx0ZXJRdWVyeTxUPiwgb3B0aW9ucz86IENvbW1vbk9wdGlvbnMpOiBQcm9taXNlPERlbGV0ZVdyaXRlT3BSZXN1bHRPYmplY3Q+O1xuXG4gICAgdXBkYXRlTWFueSAoZmlsdGVyOiBGaWx0ZXJRdWVyeTxUPiwgdXBkYXRlOiBVcGRhdGVRdWVyeTxUPiB8IFQsIG9wdGlvbnM/OiBSZXBsYWNlT25lT3B0aW9ucyk6IFByb21pc2U8VXBkYXRlV3JpdGVPcFJlc3VsdD47XG5cbiAgICB1cGRhdGVPbmUgKGZpbHRlcjogRmlsdGVyUXVlcnk8VD4sIHVwZGF0ZTogVXBkYXRlUXVlcnk8VD4gfCBULCBvcHRpb25zPzogUmVwbGFjZU9uZU9wdGlvbnMpOiBQcm9taXNlPFVwZGF0ZVdyaXRlT3BSZXN1bHQ+O1xufVxuXG5leHBvcnQgY2xhc3MgQ29sbGVjdGlvbjxUIGV4dGVuZHMgeyBba2V5OiBzdHJpbmddOiBhbnkgfT4gaW1wbGVtZW50cyBJQ29sbGVjdGlvbjxUPiB7XG4gICAgY29uc3RydWN0b3IgKHByaXZhdGUgc3RvcmU6IElEQk9iamVjdFN0b3JlLCBwcml2YXRlIGlkYjogSURCRGF0YWJhc2UpIHtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3NcbiAgICAgKiBAcGFyYW0gb3B0aW9uc1xuICAgICAqL1xuICAgIGluc2VydE9uZSAoZG9jczogT2JqZWN0LCBvcHRpb25zPzogQ29sbGVjdGlvbkluc2VydE9uZU9wdGlvbnMpOiBQcm9taXNlPEluc2VydE9uZVdyaXRlT3BSZXN1bHQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0TWFueShbZG9jc10sIG9wdGlvbnMpLnRoZW4ocmVzID0+ICh7aW5zZXJ0ZWRDb3VudCA6IDEsIGluc2VydGVkSWQgOiByZXMuaW5zZXJ0ZWRJZHNbMF19KSk7XG4gICAgfVxuXG4gICAgaW5zZXJ0TWFueSAoZG9jczogT2JqZWN0W10sIG9wdGlvbnM/OiBDb2xsZWN0aW9uSW5zZXJ0T25lT3B0aW9ucyk6IFByb21pc2U8SW5zZXJ0V3JpdGVPcFJlc3VsdD4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8SW5zZXJ0V3JpdGVPcFJlc3VsdD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IGluc2VydGVkSWRzOiBhbnlbXSA9IFtdO1xuICAgICAgICAgICAgbGV0IHRyYW5zYWN0aW9uID0gdGhpcy5pZGIudHJhbnNhY3Rpb24odGhpcy5zdG9yZS5uYW1lLCBcInJlYWR3cml0ZVwiKTtcblxuICAgICAgICAgICAgLy8gVG8gZGV0ZXJtaW5lIGlmIHRoZSBhZGQgb3BlcmF0aW9uIGhhcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LFxuICAgICAgICAgICAgLy8gbGlzdGVuIGZvciB0aGUgdHJhbnNhY3Rpb27igJlzIGNvbXBsZXRlIGV2ZW50IGluIGFkZGl0aW9uIHRvIHRoZVxuICAgICAgICAgICAgLy8gSURCT2JqZWN0U3RvcmUuYWRkIHJlcXVlc3TigJlzIHN1Y2Nlc3MgZXZlbnQsXG4gICAgICAgICAgICAvLyBiZWNhdXNlIHRoZSB0cmFuc2FjdGlvbiBtYXkgc3RpbGwgZmFpbCBhZnRlciB0aGUgc3VjY2VzcyBldmVudCBmaXJlcy5cbiAgICAgICAgICAgIHRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSBlID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaW5zZXJ0ZWRJZHMubGVuZ3RoID09PSBkb2NzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHtpbnNlcnRlZENvdW50IDogaW5zZXJ0ZWRJZHMubGVuZ3RoLCBpbnNlcnRlZElkc30pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIk5vIHN1Y2Nlc3NcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uLm9uZXJyb3IgPSByZWplY3Q7XG5cbiAgICAgICAgICAgIGNvbnN0IG9iamVjdFN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUodGhpcy5zdG9yZS5uYW1lKTtcblxuICAgICAgICAgICAgZm9yIChjb25zdCBkb2Mgb2YgZG9jcykge1xuICAgICAgICAgICAgICAgIC8vIE1ha2UgYSByZXF1ZXN0IHRvIGFkZCBkb2NzIG9iamVjdCB0byB0aGUgb2JqZWN0IHN0b3JlXG4gICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0U3RvcmVSZXF1ZXN0ID0gb2JqZWN0U3RvcmUuYWRkKGRvYyk7XG5cbiAgICAgICAgICAgICAgICBvYmplY3RTdG9yZVJlcXVlc3Qub25lcnJvciA9IHJlamVjdDtcbiAgICAgICAgICAgICAgICBvYmplY3RTdG9yZVJlcXVlc3Qub25zdWNjZXNzID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSByZXN1bHQgb2YgYSByZXF1ZXN0IGdlbmVyYXRlZCBmcm9tIGEgY2FsbCB0byBhZGQoKVxuICAgICAgICAgICAgICAgICAgICAvLyBpcyB0aGUga2V5IG9mIHRoZSB2YWx1ZSB0aGF0IHdhcyBhZGRlZC5cbiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0ZWRJZHMucHVzaChvYmplY3RTdG9yZVJlcXVlc3QucmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldEN1cnNvciAocXVlcnk6IEZpbHRlclF1ZXJ5PFQ+LCBvcGVyYXRpb246IEN1cnNvck9wZXJhdGlvbiA9IEN1cnNvck9wZXJhdGlvbi5SRUFELCBzaW5nbGU6IGJvb2xlYW4gPSBmYWxzZSwgdXBkYXRlOiBVcGRhdGVRdWVyeTxUPiB8IFQgPSBudWxsKTogQ3Vyc29yPFQ+IHtcbiAgICAgICAgY29uc3QgbW9kZSA9IG9wZXJhdGlvbiA9PSBDdXJzb3JPcGVyYXRpb24uUkVBRCA/IFwicmVhZG9ubHlcIiA6IFwicmVhZHdyaXRlXCI7XG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gdGhpcy5pZGIudHJhbnNhY3Rpb24odGhpcy5zdG9yZS5uYW1lLCBtb2RlKTtcbiAgICAgICAgY29uc3Qgb2JqZWN0U3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZSh0aGlzLnN0b3JlLm5hbWUpO1xuXG4gICAgICAgIHJldHVybiBuZXcgQ3Vyc29yKG9iamVjdFN0b3JlLCBxdWVyeSwgb3BlcmF0aW9uLCBzaW5nbGUsIHVwZGF0ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcXVlcnlbb3B0aW9uYWxdXG4gICAgICogVGhlIGZpbmQoKSBtZXRob2Qgd2l0aCBubyBwYXJhbWV0ZXJzIHJldHVybnMgYWxsIGRvY3VtZW50cyBmcm9tIGEgY29sbGVjdGlvbiBhbmQgcmV0dXJucyBhbGwgZmllbGRzIGZvciB0aGUgZG9jdW1lbnRzLlxuICAgICAqL1xuICAgIGZpbmQgKHF1ZXJ5PzogRmlsdGVyUXVlcnk8VD4pOiBDdXJzb3I8VD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRDdXJzb3IocXVlcnksIEN1cnNvck9wZXJhdGlvbi5SRUFELCBmYWxzZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkZWxldGUgKGZpbHRlcjogRmlsdGVyUXVlcnk8VD4sIG9wdGlvbnM/OiBDb21tb25PcHRpb25zLCBzaW5nbGU/OiBib29sZWFuKSB7XG4gICAgICAgIGxldCBjdXJzb3IgPSB0aGlzLmdldEN1cnNvcihmaWx0ZXIsIEN1cnNvck9wZXJhdGlvbi5ERUxFVEUsIHNpbmdsZSk7XG5cbiAgICAgICAgcmV0dXJuIGN1cnNvci5nZXRSZXN1bHQoKS50aGVuKGRlbGV0ZWQgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgOiB7XG4gICAgICAgICAgICAgICAgICAgIC8vSXMgMSBpZiB0aGUgY29tbWFuZCBleGVjdXRlZCBjb3JyZWN0bHkuXG4gICAgICAgICAgICAgICAgICAgIG9rIDogMSxcbiAgICAgICAgICAgICAgICAgICAgLy9UaGUgdG90YWwgY291bnQgb2YgZG9jdW1lbnRzIGRlbGV0ZWQuXG4gICAgICAgICAgICAgICAgICAgIG4gOiBkZWxldGVkLmxlbmd0aFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgLy9UaGUgbnVtYmVyIG9mIGRvY3VtZW50cyBkZWxldGVkLlxuICAgICAgICAgICAgICAgIGRlbGV0ZWRDb3VudCA6IGRlbGV0ZWQubGVuZ3RoXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgdXBkYXRlIChmaWx0ZXI6IEZpbHRlclF1ZXJ5PFQ+LCB1cGRhdGU6IFVwZGF0ZVF1ZXJ5PFQ+IHwgVCwgb3B0aW9ucz86IENvbW1vbk9wdGlvbnMsIHNpbmdsZT86IGJvb2xlYW4pIHtcbiAgICAgICAgbGV0IGN1cnNvciA9IHRoaXMuZ2V0Q3Vyc29yKGZpbHRlciwgQ3Vyc29yT3BlcmF0aW9uLlVQREFURSwgc2luZ2xlLCB1cGRhdGUpO1xuXG4gICAgICAgIHJldHVybiBjdXJzb3IuZ2V0UmVzdWx0KCkudGhlbih1cGRhdGVkID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcmVzdWx0IDoge29rIDogMSwgbiA6IHVwZGF0ZWQubGVuZ3RoLCBuTW9kaWZpZWQgOiB1cGRhdGVkLmxlbmd0aH0sXG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbiA6IG51bGwsXG4gICAgICAgICAgICAgICAgbWF0Y2hlZENvdW50IDogdXBkYXRlZC5sZW5ndGgsXG4gICAgICAgICAgICAgICAgbW9kaWZpZWRDb3VudCA6IHVwZGF0ZWQubGVuZ3RoLFxuICAgICAgICAgICAgICAgIHVwc2VydGVkQ291bnQgOiB1cGRhdGVkLmxlbmd0aCxcbiAgICAgICAgICAgICAgICB1cHNlcnRlZElkIDoge19pZCA6IG51bGx9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGRlbGV0ZU1hbnkgKGZpbHRlcjogRmlsdGVyUXVlcnk8VD4sIG9wdGlvbnM/OiBDb21tb25PcHRpb25zKTogUHJvbWlzZTxEZWxldGVXcml0ZU9wUmVzdWx0T2JqZWN0PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmRlbGV0ZShmaWx0ZXIsIG9wdGlvbnMpO1xuICAgIH1cblxuICAgIGRlbGV0ZU9uZSAoZmlsdGVyOiBGaWx0ZXJRdWVyeTxUPiwgb3B0aW9ucz86IENvbW1vbk9wdGlvbnMpOiBQcm9taXNlPERlbGV0ZVdyaXRlT3BSZXN1bHRPYmplY3Q+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVsZXRlKGZpbHRlciwgb3B0aW9ucywgU0lOR0xFKTtcbiAgICB9XG5cbiAgICB1cGRhdGVNYW55IChmaWx0ZXI6IEZpbHRlclF1ZXJ5PFQ+LCB1cGRhdGU6IFVwZGF0ZVF1ZXJ5PFQ+IHwgVCwgb3B0aW9ucz86IFJlcGxhY2VPbmVPcHRpb25zKTogUHJvbWlzZTxVcGRhdGVXcml0ZU9wUmVzdWx0PiB7XG4gICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZShmaWx0ZXIsIHVwZGF0ZSwgb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgdXBkYXRlT25lIChmaWx0ZXI6IEZpbHRlclF1ZXJ5PFQ+LCB1cGRhdGU6IFVwZGF0ZVF1ZXJ5PFQ+IHwgVCwgb3B0aW9ucz86IFJlcGxhY2VPbmVPcHRpb25zKTogUHJvbWlzZTxVcGRhdGVXcml0ZU9wUmVzdWx0PiB7XG4gICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZShmaWx0ZXIsIHVwZGF0ZSwgb3B0aW9ucywgU0lOR0xFKTtcbiAgICB9XG5cblxufSIsImltcG9ydCB7RmlsdGVyUXVlcnksIFVwZGF0ZVF1ZXJ5fSBmcm9tIFwiLi9Db2xsZWN0aW9uXCI7XG5cbmV4cG9ydCBlbnVtIEN1cnNvck9wZXJhdGlvbiB7XG4gICAgREVMRVRFLCBVUERBVEUsIFJFQURcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJQ3Vyc29yPFQ+IHtcbiAgICB0b0FycmF5ICgpOiBQcm9taXNlPFRbXT5cbn1cblxuLy9bUCBpbiBrZXlvZiBUXT86IFRbUF1cbmV4cG9ydCBjbGFzcyBDdXJzb3I8VCBleHRlbmRzIHsgW2tleTogc3RyaW5nXTogYW55IH0+IGltcGxlbWVudHMgSUN1cnNvcjxUPiB7XG4gICAgcHJpdmF0ZSByZXN1bHQ6IFByb21pc2U8VFtdPjtcbiAgICBwcml2YXRlIF9yZXN1bHQ6IFRbXTtcblxuICAgIGNvbnN0cnVjdG9yIChzdG9yZTogSURCT2JqZWN0U3RvcmUsIGZpbHRlcj86IEZpbHRlclF1ZXJ5PFQ+LCBvcGVyYXRpb246IEN1cnNvck9wZXJhdGlvbiA9IEN1cnNvck9wZXJhdGlvbi5SRUFELCBzaW5nbGU/OiBib29sZWFuLCB1cGRhdGU/OiBVcGRhdGVRdWVyeTxUPiB8IFQpIHtcblxuICAgICAgICBsZXQgcmVxdWVzdCA9IHRoaXMuZ2V0UmVxdWVzdChzdG9yZSwgb3BlcmF0aW9uLCBmaWx0ZXIpO1xuICAgICAgICBsZXQgZXhlY3V0ZWQgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLnJlc3VsdCA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblxuICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHNpbmdsZSAmJiBleGVjdXRlZCkge1xuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHRoaXMuX3Jlc3VsdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnNvciA9IHJlcXVlc3QucmVzdWx0O1xuICAgICAgICAgICAgICAgIGlmIChjdXJzb3IgJiYgY3Vyc29yIGluc3RhbmNlb2YgSURCQ3Vyc29yV2l0aFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc3VsdCA9IHRoaXMuX3Jlc3VsdCB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgLy8gY3Vyc29yLnZhbHVlIGNvbnRhaW5zIHRoZSBjdXJyZW50IHJlY29yZCBiZWluZyBpdGVyYXRlZCB0aHJvdWdoXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgd2hlcmUgeW91J2QgZG8gc29tZXRoaW5nIHdpdGggdGhlIHJlc3VsdFxuICAgICAgICAgICAgICAgICAgICBleGVjdXRlZCA9IHRoaXMuZXhlY3V0ZUN1cnNvck9wZXJhdGlvbihvcGVyYXRpb24sIGN1cnNvciwgZmlsdGVyLCB1cGRhdGUpO1xuICAgICAgICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc3VsdCA9IHRoaXMuX3Jlc3VsdCB8fCBbXS5jb25jYXQocmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZSh0aGlzLl9yZXN1bHQpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICB9KTtcblxuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRSZXF1ZXN0IChzdG9yZTogSURCT2JqZWN0U3RvcmUsIG9wZXJhdGlvbjogQ3Vyc29yT3BlcmF0aW9uLCBmaWx0ZXI/OiBGaWx0ZXJRdWVyeTxUPik6IElEQlJlcXVlc3Qge1xuICAgICAgICBjb25zdCBrZXlQYXRoID0gc3RvcmUua2V5UGF0aCBhcyBzdHJpbmc7XG4gICAgICAgIGNvbnN0IGtleSA9IGZpbHRlciAmJiBmaWx0ZXJba2V5UGF0aF07XG5cbiAgICAgICAgc3dpdGNoIChvcGVyYXRpb24pIHtcbiAgICAgICAgICAgIGNhc2UgQ3Vyc29yT3BlcmF0aW9uLkRFTEVURTpcbiAgICAgICAgICAgICAgICBpZiAoIWZpbHRlcikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RvcmUuY2xlYXIoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGtleSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RvcmUuZGVsZXRlKGtleSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBDdXJzb3JPcGVyYXRpb24uUkVBRDpcbiAgICAgICAgICAgICAgICBpZiAoIWZpbHRlcikge1xuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZ2V0QWxsKCkgbWV0aG9kIG9mIHRoZSBJREJPYmplY3RTdG9yZSBpbnRlcmZhY2UgcmV0dXJucyBhbiBJREJSZXF1ZXN0IG9iamVjdFxuICAgICAgICAgICAgICAgICAgICAvLyBjb250YWluaW5nIGFsbCBvYmplY3RzIGluIHRoZSBvYmplY3Qgc3RvcmUgbWF0Y2hpbmcgdGhlIHNwZWNpZmllZCBwYXJhbWV0ZXIgb3JcbiAgICAgICAgICAgICAgICAgICAgLy8gYWxsIG9iamVjdHMgaW4gdGhlIHN0b3JlIGlmIG5vIHBhcmFtZXRlcnMgYXJlIGdpdmVuLlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RvcmUuZ2V0QWxsKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmdldChrZXkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzdG9yZS5vcGVuQ3Vyc29yKCkgYXMgSURCUmVxdWVzdDxJREJDdXJzb3JXaXRoVmFsdWUgfCBudWxsPjtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFwcGx5RmlsdGVyICh2YWx1ZTogVCwgZmlsdGVyOiBGaWx0ZXJRdWVyeTxUPikge1xuICAgICAgICBsZXQgZmlsdGVyS2V5cyA9IE9iamVjdC5rZXlzKGZpbHRlcik7XG5cbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgZmlsdGVyS2V5cykge1xuICAgICAgICAgICAgaWYgKGtleS5zdGFydHNXaXRoKCckJykpIHtcbiAgICAgICAgICAgICAgICAvL1RPRE86IG9wZXJhdG9yc1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2YWx1ZVtrZXldICE9IGZpbHRlcltrZXldKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgZXhlY3V0ZUN1cnNvck9wZXJhdGlvbiAob3BlcmF0aW9uOiBDdXJzb3JPcGVyYXRpb24sIGN1cnNvcjogSURCQ3Vyc29yV2l0aFZhbHVlLCBmaWx0ZXI/OiBGaWx0ZXJRdWVyeTxUPiwgdXBkYXRlPzogVXBkYXRlUXVlcnk8VD4gfCBUKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gZmlsdGVyID8gdGhpcy5hcHBseUZpbHRlcihjdXJzb3IudmFsdWUsIGZpbHRlcikgOiBjdXJzb3IudmFsdWU7XG4gICAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9yZXN1bHQucHVzaCh2YWx1ZSk7XG4gICAgICAgIHN3aXRjaCAob3BlcmF0aW9uKSB7XG4gICAgICAgICAgICBjYXNlIEN1cnNvck9wZXJhdGlvbi5ERUxFVEU6XG4gICAgICAgICAgICAgICAgY3Vyc29yLmRlbGV0ZSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBDdXJzb3JPcGVyYXRpb24uVVBEQVRFOlxuICAgICAgICAgICAgICAgIC8vVE9ETzogaW1wbGVtZW50IFVwZGF0ZVF1ZXJ5XG4gICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZCA9IE9iamVjdC5hc3NpZ24odmFsdWUsIHVwZGF0ZSk7XG4gICAgICAgICAgICAgICAgY3Vyc29yLnVwZGF0ZSh1cGRhdGVkKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBnZXRSZXN1bHQgKCk6IFByb21pc2U8VFtdPiB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdDtcbiAgICB9XG5cblxuLy8gc29ydFZhbHVlOiBzdHJpbmc7XG4gICAgLy8gdGltZW91dDogYm9vbGVhbjtcbiAgICAvLyByZWFkUHJlZmVyZW5jZTogUmVhZFByZWZlcmVuY2U7XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjYWRkQ3Vyc29yRmxhZyAqL1xuICAgIC8vIGFkZEN1cnNvckZsYWcoZmxhZzogc3RyaW5nLCB2YWx1ZTogYm9vbGVhbik6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNhZGRRdWVyeU1vZGlmaWVyICovXG4gICAgLy8gYWRkUXVlcnlNb2RpZmllcihuYW1lOiBzdHJpbmcsIHZhbHVlOiBib29sZWFuKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2JhdGNoU2l6ZSAqL1xuICAgIC8vIGJhdGNoU2l6ZSh2YWx1ZTogbnVtYmVyKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2Nsb25lICovXG4gICAgLy8gY2xvbmUoKTogQ3Vyc29yPFQ+OyAvLyBzdGlsbCByZXR1cm5zIHRoZSBzYW1lIHR5cGVcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNjbG9zZSAqL1xuICAgIC8vIGNsb3NlKCk6IFByb21pc2U8Q3Vyc29yUmVzdWx0PjtcbiAgICAvLyBjbG9zZShjYWxsYmFjazogTW9uZ29DYWxsYmFjazxDdXJzb3JSZXN1bHQ+KTogdm9pZDtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNjb2xsYXRpb24gKi9cbiAgICAvLyBjb2xsYXRpb24odmFsdWU6IE9iamVjdCk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNjb21tZW50ICovXG4gICAgLy8gY29tbWVudCh2YWx1ZTogc3RyaW5nKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2NvdW50ICovXG4gICAgLy8gY291bnQoY2FsbGJhY2s6IE1vbmdvQ2FsbGJhY2s8bnVtYmVyPik6IHZvaWQ7XG4gICAgLy8gY291bnQoYXBwbHlTa2lwTGltaXQ6IGJvb2xlYW4sIGNhbGxiYWNrOiBNb25nb0NhbGxiYWNrPG51bWJlcj4pOiB2b2lkO1xuICAgIC8vIGNvdW50KG9wdGlvbnM6IEN1cnNvckNvbW1lbnRPcHRpb25zLCBjYWxsYmFjazogTW9uZ29DYWxsYmFjazxudW1iZXI+KTogdm9pZDtcbiAgICAvLyBjb3VudChhcHBseVNraXBMaW1pdDogYm9vbGVhbiwgb3B0aW9uczogQ3Vyc29yQ29tbWVudE9wdGlvbnMsIGNhbGxiYWNrOiBNb25nb0NhbGxiYWNrPG51bWJlcj4pOiB2b2lkO1xuICAgIC8vIGNvdW50KGFwcGx5U2tpcExpbWl0PzogYm9vbGVhbiwgb3B0aW9ucz86IEN1cnNvckNvbW1lbnRPcHRpb25zKTogUHJvbWlzZTxudW1iZXI+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2V4cGxhaW4gKi9cbiAgICAvLyBleHBsYWluKCk6IFByb21pc2U8Q3Vyc29yUmVzdWx0PjtcbiAgICAvLyBleHBsYWluKGNhbGxiYWNrOiBNb25nb0NhbGxiYWNrPEN1cnNvclJlc3VsdD4pOiB2b2lkO1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2ZpbHRlciAqL1xuICAgIC8vIGZpbHRlcihmaWx0ZXI6IE9iamVjdCk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNmb3JFYWNoICovXG4gICAgLy8gZm9yRWFjaChpdGVyYXRvcjogSXRlcmF0b3JDYWxsYmFjazxUPiwgY2FsbGJhY2s6IEVuZENhbGxiYWNrKTogdm9pZDtcbiAgICAvLyBmb3JFYWNoKGl0ZXJhdG9yOiBJdGVyYXRvckNhbGxiYWNrPFQ+KTogUHJvbWlzZTx2b2lkPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNoYXNOZXh0ICovXG4gICAgLy8gaGFzTmV4dCgpOiBQcm9taXNlPGJvb2xlYW4+O1xuICAgIC8vIGhhc05leHQoY2FsbGJhY2s6IE1vbmdvQ2FsbGJhY2s8Ym9vbGVhbj4pOiB2b2lkO1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2hpbnQgKi9cbiAgICAvLyBoaW50KGhpbnQ6IE9iamVjdCk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNpc0Nsb3NlZCAqL1xuICAgIC8vIGlzQ2xvc2VkKCk6IGJvb2xlYW47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjbGltaXQgKi9cbiAgICAvLyBsaW1pdCh2YWx1ZTogbnVtYmVyKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI21hcCAqL1xuICAgIC8vIG1hcDxVPih0cmFuc2Zvcm06IChkb2N1bWVudDogVCkgPT4gVSk6IEN1cnNvcjxVPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNtYXggKi9cbiAgICAvLyBtYXgobWF4OiBudW1iZXIpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjbWF4QXdhaXRUaW1lTVMgKi9cbiAgICAvLyBtYXhBd2FpdFRpbWVNUyh2YWx1ZTogbnVtYmVyKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI21heFNjYW4gKi9cbiAgICAvLyBtYXhTY2FuKG1heFNjYW46IE9iamVjdCk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNtYXhUaW1lTVMgKi9cbiAgICAvLyBtYXhUaW1lTVModmFsdWU6IG51bWJlcik6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNtaW4gKi9cbiAgICAvLyBtaW4obWluOiBudW1iZXIpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjbmV4dCAqL1xuICAgIC8vIG5leHQoKTogUHJvbWlzZTxUIHwgbnVsbD47XG4gICAgLy8gbmV4dChjYWxsYmFjazogTW9uZ29DYWxsYmFjazxUIHwgbnVsbD4pOiB2b2lkO1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI3Byb2plY3QgKi9cbiAgICAvLyBwcm9qZWN0KHZhbHVlOiBPYmplY3QpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjcmVhZCAqL1xuICAgIC8vIHJlYWQoc2l6ZTogbnVtYmVyKTogc3RyaW5nIHwgQnVmZmVyIHwgdm9pZDtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNuZXh0ICovXG4gICAgLy8gcmV0dXJuS2V5KHJldHVybktleTogT2JqZWN0KTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI3Jld2luZCAqL1xuICAgIC8vIHJld2luZCgpOiB2b2lkO1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI3NldEN1cnNvck9wdGlvbiAqL1xuICAgIC8vIHNldEN1cnNvck9wdGlvbihmaWVsZDogc3RyaW5nLCB2YWx1ZTogT2JqZWN0KTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI3NldFJlYWRQcmVmZXJlbmNlICovXG4gICAgLy8gc2V0UmVhZFByZWZlcmVuY2UocmVhZFByZWZlcmVuY2U6IHN0cmluZyB8IFJlYWRQcmVmZXJlbmNlKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI3Nob3dSZWNvcmRJZCAqL1xuICAgIC8vIHNob3dSZWNvcmRJZChzaG93UmVjb3JkSWQ6IE9iamVjdCk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNza2lwICovXG4gICAgLy8gc2tpcCh2YWx1ZTogbnVtYmVyKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI3NuYXBzaG90ICovXG4gICAgLy8gc25hcHNob3Qoc25hcHNob3Q6IE9iamVjdCk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNzb3J0ICovXG4gICAgLy8gc29ydChrZXlPckxpc3Q6IHN0cmluZyB8IE9iamVjdFtdIHwgT2JqZWN0LCBkaXJlY3Rpb24/OiBudW1iZXIpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjc3RyZWFtICovXG4gICAgLy8gc3RyZWFtKG9wdGlvbnM/OiB7IHRyYW5zZm9ybT86IEZ1bmN0aW9uIH0pOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjdG9BcnJheSAqL1xuICAgIHRvQXJyYXkgKCk6IFByb21pc2U8VFtdPiB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShyZXN1bHQpIGFzIFRbXTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjdW5zaGlmdCAqL1xuICAgIC8vIHVuc2hpZnQoc3RyZWFtOiBCdWZmZXIgfCBzdHJpbmcpOiB2b2lkO1xuXG5cbn0iXSwic291cmNlUm9vdCI6IiJ9