!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1);document.getElementById("output").innerHTML="",r.IndexedClient.connect("example").then(function(e){const t=e.db;function n(e){const n=t.collection("another_collection"),r=document.getElementById("output");n.find(e).toArray().then(e=>{console.log(e),r.innerHTML+=`<p>another_collection find {b : 2}: ${JSON.stringify(e)}</p>`}).then(()=>(r.innerHTML+="<p>another_collection delete all {b : 2}, delete one {c : 3}</p>",Promise.all([n.deleteMany(e),n.deleteOne({c:3})]).then(e=>{r.innerHTML+=`<p>${JSON.stringify(e)}</p>`}))).then(()=>{});const o=t.collection("a_simple_collection"),s=document.getElementById("output1");o.find({_id:"a"}).toArray().then(e=>{console.log(e),s.innerHTML+=`<p>a_simple_collection find {_id : "a"}: ${JSON.stringify(e)}</p>`})}document.getElementById("output").innerHTML+=`<p>DB version: ${t.version}</p>`,1==t.version?Promise.all([t.createCollection("a_simple_collection",{keyPath:"_id"}).then(function(e){e.insertOne({_id:"a",a:1}).then(function(e){console.log("a_simple_collection",e),document.getElementById("output").innerHTML+=`<p>a_simple_collection: ${JSON.stringify(e)}</p>`})}),t.createCollection("another_collection").then(function(e){e.insertMany([{b:2},{c:3},{c:3},{d:4},{b:2}]).then(function(e){console.log("another_collection",e),document.getElementById("output").innerHTML+=`<p>another_collection: ${JSON.stringify(e)}</p>`})})]).then(e=>{n({b:2})}):n({b:2})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2);t.IndexedClient=class e{constructor(e){}close(e){return Promise.resolve(this.db.close())}static connect(t,n){const o=new e(t);return r.Db.open(t).then(e=>(o.db=e,o))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3);class o{constructor(e){this.idb=e,this.collectionQueue=new Set}static open(e,t){const n=self.indexedDB.open(e);return new Promise((e,t)=>{n.addEventListener("error",t),n.addEventListener("success",function(t){let r=new o(n.result);e(r)}),n.onblocked=(e=>{console.log("blocked")})})}get version(){return this.idb?this.idb.version:0}createCollection(e,t={autoIncrement:!0}){if(this.idb.objectStoreNames.contains(e))throw new Error("Collection already exists");if(!this.collectionQueue.size&&!this.DBOpenRequest){let e=this.version+1;this.idb.close(),this.DBOpenRequest=self.indexedDB.open(this.idb.name,e)}return this.collectionQueue.add(e),new Promise((n,o)=>{this.DBOpenRequest.addEventListener("error",o),this.DBOpenRequest.addEventListener("upgradeneeded",o=>{let s=this.DBOpenRequest.result;this.idb=s;const i=s.createObjectStore(e,t);i.transaction.addEventListener("complete",t=>{let o=new r.Collection(i,this.idb);this.collectionQueue.delete(e),n(o)})}),this.DBOpenRequest.onsuccess=(e=>{if(this.collectionQueue.size||!this.DBOpenRequest)throw new Error("Not all collections were created");this.DBOpenRequest=null})})}collection(e){const t=this.idb.transaction(e).objectStore(e);return new r.Collection(t,this.idb)}close(){this.idb.close()}}t.Db=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(4),o=!0;t.Collection=class{constructor(e,t){this.store=e,this.idb=t}insertOne(e,t){return this.insertMany([e],t).then(e=>({insertedCount:1,insertedId:e.insertedIds[0]}))}insertMany(e,t){return new Promise((t,n)=>{let r=[],o=this.idb.transaction(this.store.name,"readwrite");o.oncomplete=(o=>{r.length===e.length?t({insertedCount:r.length,insertedIds:r}):n("No success")}),o.onerror=n;const s=o.objectStore(this.store.name);for(const t of e){const e=s.add(t);e.onerror=n,e.onsuccess=(t=>{r.push(e.result)})}})}getCursor(e,t=r.CursorOperation.READ,n=!1){const o=t==r.CursorOperation.READ?"readonly":"readwrite",s=this.idb.transaction(this.store.name,o).objectStore(this.store.name);return new r.Cursor(s,e,t,n)}find(e){return this.getCursor(e,r.CursorOperation.READ)}delete(e,t=r.CursorOperation.DELETE,n,o){return this.getCursor(e,t,o).getResult().then(e=>({result:{ok:1,n:e.length},deletedCount:e.length}))}deleteMany(e,t){return this.delete(e,r.CursorOperation.DELETE,t)}deleteOne(e,t){return this.delete(e,r.CursorOperation.DELETE,t,o)}}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.DELETE=0]="DELETE",e[e.UPDATE=1]="UPDATE",e[e.READ=2]="READ"}(r=t.CursorOperation||(t.CursorOperation={}));t.Cursor=class{constructor(e,t,n=r.READ,o){let s=this.getRequest(e,n,t),i=!1;this.result=new Promise((e,r)=>{s.onerror=(e=>{r(s.error)}),s.onsuccess=(r=>{if(o&&i)return s.onsuccess=null,e(this._result);const l=s.result;return l&&l instanceof IDBCursorWithValue?(this._result=this._result||[],i=this.executeCursorOperation(n,l,t),void l.continue()):(this._result=this._result||[].concat(s.result),e(this._result))})})}getRequest(e,t,n){const o=e.keyPath,s=n&&n[o];switch(t){case r.DELETE:if(!n)return e.clear();if(s)return e.delete(s);break;case r.READ:if(!n)return e.getAll();if(s)return e.get(s)}return e.openCursor()}applyFilter(e,t){let n=Object.keys(t);for(const r of n){if(r.startsWith("$"))return;if(e[r]!=t[r])return}return e}executeCursorOperation(e,t,n){const o=n?this.applyFilter(t.value,n):t.value;if(!o)return!1;switch(this._result.push(o),e){case r.DELETE:t.delete();break;case r.UPDATE:}return!0}getResult(){return this.result}toArray(){return this.result.then(e=>Array.from(e))}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2V4YW1wbGUvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL0luZGV4ZWRDbGllbnQudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL0RiLnRzIiwid2VicGFjazovLy8uL3NyYy9Db2xsZWN0aW9uLnRzIiwid2VicGFjazovLy8uL3NyYy9DdXJzb3IudHMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJJbmRleGVkQ2xpZW50XzEiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaW5uZXJIVE1MIiwiSW5kZXhlZENsaWVudCIsImNvbm5lY3QiLCJ0aGVuIiwiY2xpZW50IiwiZGIiLCJmaW5kIiwicSIsImNvbGxlY3Rpb24iLCJvdXRwdXQiLCJ0b0FycmF5IiwidmFsdWVzIiwiY29uc29sZSIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJQcm9taXNlIiwiYWxsIiwiZGVsZXRlTWFueSIsImRlbGV0ZU9uZSIsInJlcyIsImMxIiwib3V0cHV0MSIsIl9pZCIsInZlcnNpb24iLCJjcmVhdGVDb2xsZWN0aW9uIiwia2V5UGF0aCIsImluc2VydE9uZSIsImEiLCJpbnNlcnRNYW55IiwiYiIsIkRiXzEiLCJbb2JqZWN0IE9iamVjdF0iLCJkYm5hbWUiLCJmb3JjZSIsInJlc29sdmUiLCJ0aGlzIiwiY2xvc2UiLCJvcHRpb25zIiwiRGIiLCJvcGVuIiwiQ29sbGVjdGlvbl8xIiwiaWRiIiwiY29sbGVjdGlvblF1ZXVlIiwiU2V0IiwiY29sbGVjdGlvbnMiLCJEQk9wZW5SZXF1ZXN0Iiwic2VsZiIsImluZGV4ZWREQiIsInJlamVjdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInJlc3VsdCIsIm9uYmxvY2tlZCIsImUiLCJhdXRvSW5jcmVtZW50Iiwib2JqZWN0U3RvcmVOYW1lcyIsImNvbnRhaW5zIiwiRXJyb3IiLCJzaXplIiwidiIsImFkZCIsInN0b3JlIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJ0cmFuc2FjdGlvbiIsIkNvbGxlY3Rpb24iLCJkZWxldGUiLCJvbnN1Y2Nlc3MiLCJvYmplY3RTdG9yZSIsIkN1cnNvcl8xIiwiU0lOR0xFIiwiZG9jcyIsImluc2VydGVkQ291bnQiLCJpbnNlcnRlZElkIiwiaW5zZXJ0ZWRJZHMiLCJvbmNvbXBsZXRlIiwibGVuZ3RoIiwib25lcnJvciIsImRvYyIsIm9iamVjdFN0b3JlUmVxdWVzdCIsInB1c2giLCJxdWVyeSIsIm9wZXJhdGlvbiIsIkN1cnNvck9wZXJhdGlvbiIsIlJFQUQiLCJzaW5nbGUiLCJDdXJzb3IiLCJnZXRDdXJzb3IiLCJmaWx0ZXIiLCJERUxFVEUiLCJnZXRSZXN1bHQiLCJkZWxldGVkIiwib2siLCJkZWxldGVkQ291bnQiLCJyZXF1ZXN0IiwiZ2V0UmVxdWVzdCIsImV4ZWN1dGVkIiwiZXJyb3IiLCJfcmVzdWx0IiwiY3Vyc29yIiwiSURCQ3Vyc29yV2l0aFZhbHVlIiwiZXhlY3V0ZUN1cnNvck9wZXJhdGlvbiIsImNvbnRpbnVlIiwiY29uY2F0IiwiY2xlYXIiLCJnZXRBbGwiLCJvcGVuQ3Vyc29yIiwiZmlsdGVyS2V5cyIsImtleXMiLCJzdGFydHNXaXRoIiwiYXBwbHlGaWx0ZXIiLCJVUERBVEUiLCJBcnJheSIsImZyb20iXSwibWFwcGluZ3MiOiJhQUNBLElB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ZXhhbXBsZS9idW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJpbXBvcnQge0luZGV4ZWRDbGllbnR9IGZyb20gXCIuLi9JbmRleGVkQ2xpZW50XCI7XG5pbXBvcnQge0RifSBmcm9tIFwiLi4vRGJcIjtcbi8qXG4vLyBDb25uZWN0IHVzaW5nIE1vbmdvQ2xpZW50XG5Nb25nb0NsaWVudC5jb25uZWN0KHVybCwgZnVuY3Rpb24oZXJyLCBjbGllbnQpIHtcbiAgLy8gQ3JlYXRlIGEgY29sbGVjdGlvbiB3ZSB3YW50IHRvIGRyb3AgbGF0ZXJcbiAgY29uc3QgY29sID0gY2xpZW50LmRiKGRiTmFtZSkuY29sbGVjdGlvbignY3JlYXRlSW5kZXhFeGFtcGxlMScpO1xuICAvLyBTaG93IHRoYXQgZHVwbGljYXRlIHJlY29yZHMgZ290IGRyb3BwZWRcbiAgY29sLmZpbmQoe30pLnRvQXJyYXkoZnVuY3Rpb24oZXJyLCBpdGVtcykge1xuICAgIHRlc3QuZXF1YWwobnVsbCwgZXJyKTtcbiAgICB0ZXN0LmVxdWFsKDQsIGl0ZW1zLmxlbmd0aCk7XG4gICAgY2xpZW50LmNsb3NlKCk7XG4gIH0pO1xufSk7XG4qICovXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm91dHB1dFwiKS5pbm5lckhUTUwgPSBcIlwiO1xuSW5kZXhlZENsaWVudC5jb25uZWN0KFwiZXhhbXBsZVwiKS50aGVuKGZ1bmN0aW9uIChjbGllbnQpIHtcbiAgICBjb25zdCBkYiA9IGNsaWVudC5kYiBhcyBEYjtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm91dHB1dFwiKS5pbm5lckhUTUwgKz0gYDxwPkRCIHZlcnNpb246ICR7ZGIudmVyc2lvbn08L3A+YDtcbiAgICBpZiAoZGIudmVyc2lvbiA9PSAxKSB7XG4gICAgICAgIC8vIENyZWF0ZSBhIGNvbGxlY3Rpb25cbiAgICAgICAgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgZGIuY3JlYXRlQ29sbGVjdGlvbihcImFfc2ltcGxlX2NvbGxlY3Rpb25cIiwge2tleVBhdGggOiBcIl9pZFwifSkudGhlbihmdW5jdGlvbiAoY29sbGVjdGlvbikge1xuICAgICAgICAgICAgICAgIC8vIEluc2VydCBhIGRvY3VtZW50IGluIHRoZSBjb2xsZWN0aW9uXG4gICAgICAgICAgICAgICAgY29sbGVjdGlvbi5pbnNlcnRPbmUoe19pZCA6IFwiYVwiLCBhIDogMX0pLnRoZW4oZnVuY3Rpb24gKHI6IGFueSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBGaW5pc2ggdXAgdGVzdFxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImFfc2ltcGxlX2NvbGxlY3Rpb25cIiwgcik7XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3V0cHV0XCIpLmlubmVySFRNTCArPSBgPHA+YV9zaW1wbGVfY29sbGVjdGlvbjogJHtKU09OLnN0cmluZ2lmeShyKX08L3A+YDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgZGIuY3JlYXRlQ29sbGVjdGlvbihcImFub3RoZXJfY29sbGVjdGlvblwiKS50aGVuKGZ1bmN0aW9uIChjb2xsZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgLy8gSW5zZXJ0IGEgZG9jdW1lbnQgaW4gdGhlIGNvbGxlY3Rpb25cbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uLmluc2VydE1hbnkoW3tiIDogMn0sIHtjIDogM30sIHtjIDogM30sIHtkIDogNH0sIHtiIDogMn1dKS50aGVuKGZ1bmN0aW9uIChyOiBhbnkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRmluaXNoIHVwIHRlc3RcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJhbm90aGVyX2NvbGxlY3Rpb25cIiwgcik7XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3V0cHV0XCIpLmlubmVySFRNTCArPSBgPHA+YW5vdGhlcl9jb2xsZWN0aW9uOiAke0pTT04uc3RyaW5naWZ5KHIpfTwvcD5gO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSldKS50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICBmaW5kKHtiIDogMn0pXG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGZpbmQoe2IgOiAyfSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBmaW5kIChxPzogYW55KSB7XG4gICAgICAgIGNvbnN0IGMgPSBkYi5jb2xsZWN0aW9uKFwiYW5vdGhlcl9jb2xsZWN0aW9uXCIpO1xuICAgICAgICBjb25zdCBvdXRwdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm91dHB1dFwiKTtcbiAgICAgICAgYy5maW5kKHEpLnRvQXJyYXkoKS50aGVuKCh2YWx1ZXM6IGFueSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2codmFsdWVzKTtcbiAgICAgICAgICAgIG91dHB1dC5pbm5lckhUTUwgKz0gYDxwPmFub3RoZXJfY29sbGVjdGlvbiBmaW5kIHtiIDogMn06ICR7SlNPTi5zdHJpbmdpZnkodmFsdWVzKX08L3A+YDtcbiAgICAgICAgfSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBvdXRwdXQuaW5uZXJIVE1MICs9IGA8cD5hbm90aGVyX2NvbGxlY3Rpb24gZGVsZXRlIGFsbCB7YiA6IDJ9LCBkZWxldGUgb25lIHtjIDogM308L3A+YDtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbYy5kZWxldGVNYW55KHEpLCBjLmRlbGV0ZU9uZSh7YyA6IDN9KV0pLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICAgICAgICBvdXRwdXQuaW5uZXJIVE1MICs9IGA8cD4ke0pTT04uc3RyaW5naWZ5KHJlcyl9PC9wPmA7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIC8vIGNsaWVudC5jbG9zZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBjMSA9IGRiLmNvbGxlY3Rpb24oXCJhX3NpbXBsZV9jb2xsZWN0aW9uXCIpO1xuICAgICAgICBjb25zdCBvdXRwdXQxID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvdXRwdXQxXCIpO1xuICAgICAgICBjMS5maW5kKHtfaWQgOiBcImFcIn0pLnRvQXJyYXkoKS50aGVuKCh2YWx1ZXM6IGFueSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2codmFsdWVzKTtcbiAgICAgICAgICAgIG91dHB1dDEuaW5uZXJIVE1MICs9IGA8cD5hX3NpbXBsZV9jb2xsZWN0aW9uIGZpbmQge19pZCA6IFwiYVwifTogJHtKU09OLnN0cmluZ2lmeSh2YWx1ZXMpfTwvcD5gO1xuICAgICAgICB9KVxuICAgIH1cbn0pO1xuXG4iLCJpbXBvcnQge0RiLCBJRGJ9IGZyb20gXCIuL0RiXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW5kZXhlZENsaWVudE9wdGlvbnMge1xuICAgIGNvbGxlY3Rpb25zPzogc3RyaW5nW11cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJbmRleGVkTW9uZ29DbGllbnRPcHRpb25zIHtcblxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEluZGV4ZWRNb25nb0NsaWVudFN0YXRpYyB7XG4gICAgLy9zdGF0aWMgY29ubmVjdCh1cmk6IHN0cmluZywgb3B0aW9ucz86IE1vbmdvQ2xpZW50T3B0aW9ucyk6IFByb21pc2U8TW9uZ29DbGllbnQ+O1xuICAgIGNvbm5lY3QgKHVyaTogc3RyaW5nLCBvcHRpb25zPzogSW5kZXhlZE1vbmdvQ2xpZW50T3B0aW9ucyk6IFByb21pc2U8SW5kZXhlZE1vbmdvQ2xpZW50PlxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEluZGV4ZWRNb25nb0NsaWVudCB7XG4gICAgZGI6IElEYjtcblxuICAgIGNsb3NlIChmb3JjZT86IGJvb2xlYW4pOiBQcm9taXNlPHZvaWQ+O1xufVxuXG5leHBvcnQgY29uc3QgSW5kZXhlZENsaWVudDogSW5kZXhlZE1vbmdvQ2xpZW50U3RhdGljID0gY2xhc3MgSW5kZXhlZENsaWVudCBpbXBsZW1lbnRzIEluZGV4ZWRNb25nb0NsaWVudCB7XG4gICAgcHVibGljIGRiOiBEYjtcblxuICAgIGNvbnN0cnVjdG9yIChkYm5hbWU6IHN0cmluZykge1xuICAgIH1cblxuICAgIGNsb3NlIChmb3JjZT86IGJvb2xlYW4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLmRiLmNsb3NlKCkpO1xuICAgIH1cblxuICAgIHN0YXRpYyBjb25uZWN0IChuYW1lOiBzdHJpbmcsIG9wdGlvbnM/OiBJbmRleGVkQ2xpZW50T3B0aW9ucyk6IFByb21pc2U8SW5kZXhlZE1vbmdvQ2xpZW50PiB7XG4gICAgICAgIC8vIElmIHRoZSB2ZXJzaW9uIGlzIG5vdCBwcm92aWRlZCBhbmQgdGhlIGRhdGFiYXNlIGV4aXN0cywgdGhlbiBhIGNvbm5lY3Rpb24gdG8gdGhlIGRhdGFiYXNlIHdpbGwgYmUgb3BlbmVkIHdpdGhvdXQgY2hhbmdpbmcgaXRzIHZlcnNpb24uIElmIHRoZSB2ZXJzaW9uIGlzIG5vdCBwcm92aWRlZCBhbmQgdGhlIGRhdGFiYXNlIGRvZXMgbm90IGV4aXN0LCB0aGVuIGl0IHdpbGwgYmUgY3JlYXRlZCB3aXRoIHZlcnNpb24gMS5cbiAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IEluZGV4ZWRDbGllbnQobmFtZSk7XG4gICAgICAgIHJldHVybiBEYi5vcGVuKG5hbWUpLnRoZW4oZGIgPT4ge1xuICAgICAgICAgICAgY2xpZW50LmRiID0gZGI7XG4gICAgICAgICAgICByZXR1cm4gY2xpZW50IGFzIEluZGV4ZWRNb25nb0NsaWVudDtcbiAgICAgICAgfSk7XG4gICAgfVxuXG59OyIsImltcG9ydCB7Q29sbGVjdGlvbiwgQ29sbGVjdGlvbkNyZWF0ZU9wdGlvbnN9IGZyb20gXCIuL0NvbGxlY3Rpb25cIjtcblxuZXhwb3J0IGludGVyZmFjZSBJRGIge1xuICAgIGNyZWF0ZUNvbGxlY3Rpb248VD4gKG5hbWU6IHN0cmluZywgb3B0aW9ucz86IENvbGxlY3Rpb25DcmVhdGVPcHRpb25zKTogUHJvbWlzZTxDb2xsZWN0aW9uPFQ+PjtcblxuICAgIGNvbGxlY3Rpb248VD4gKG5hbWU6IHN0cmluZyk6IENvbGxlY3Rpb248VD47XG59XG5cbmV4cG9ydCBjbGFzcyBEYiBpbXBsZW1lbnRzIElEYiB7XG4gICAgcHJpdmF0ZSBjb2xsZWN0aW9uUXVldWU6IFNldDxzdHJpbmc+ID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgcHJpdmF0ZSBEQk9wZW5SZXF1ZXN0OiBJREJPcGVuREJSZXF1ZXN0O1xuXG4gICAgc3RhdGljIG9wZW4gKG5hbWU6IHN0cmluZywgY29sbGVjdGlvbnM/OiBzdHJpbmdbXSk6IFByb21pc2U8RGI+IHtcblxuICAgICAgICBjb25zdCBEQk9wZW5SZXF1ZXN0ID0gc2VsZi5pbmRleGVkREIub3BlbihuYW1lKTtcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8RGI+KChyZXNvbHZlLCByZWplY3QpID0+IHtcblxuICAgICAgICAgICAgLy8gdGhlc2UgdHdvIGV2ZW50IGhhbmRsZXJzIGFjdCBvbiB0aGUgZGF0YWJhc2UgYmVpbmcgb3BlbmVkXG4gICAgICAgICAgICAvLyBzdWNjZXNzZnVsbHksIG9yIG5vdFxuICAgICAgICAgICAgREJPcGVuUmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIHJlamVjdCk7XG4gICAgICAgICAgICBEQk9wZW5SZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3N1Y2Nlc3MnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAvLyBzdG9yZSB0aGUgcmVzdWx0IG9mIG9wZW5pbmcgdGhlIGRhdGFiYXNlIGluIHRoZSBkYlxuICAgICAgICAgICAgICAgIC8vIHZhcmlhYmxlLiBUaGlzIGlzIHVzZWQgYSBsb3QgbGF0ZXIgb24sIGZvciBvcGVuaW5nXG4gICAgICAgICAgICAgICAgLy8gdHJhbnNhY3Rpb25zIGFuZCBzdWNobGlrZS5cbiAgICAgICAgICAgICAgICBsZXQgZGIgPSBuZXcgRGIoREJPcGVuUmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoZGIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBEQk9wZW5SZXF1ZXN0Lm9uYmxvY2tlZCA9IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Jsb2NrZWQnKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yIChwcml2YXRlIGlkYjogSURCRGF0YWJhc2UpIHtcbiAgICB9XG5cbiAgICBnZXQgdmVyc2lvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlkYiA/IHRoaXMuaWRiLnZlcnNpb24gOiAwO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIG5hbWVcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtICBPcHRpb25hbFxuICAgICAqIEFuIG9wdGlvbnMgb2JqZWN0IHdob3NlIGF0dHJpYnV0ZXMgYXJlIG9wdGlvbmFsIHBhcmFtZXRlcnMgdG8gdGhlIG1ldGhvZC4gSXQgaW5jbHVkZXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOlxuICAgICAqIHwgQXR0cmlidXRlICAgICAgICAgIHwgRGVzY3JpcHRpb24gICAgICAgfFxuICAgICAqIHwgLS0tLS0tLS0tLS0tLS0tLSB8IC0tLS0tLS0tLS0tLS0tLSAgIHxcbiAgICAgKiB8IGtleVBhdGggICAgICAgICAgfCBUaGUga2V5IHBhdGggdG8gYmUgdXNlZCBieSB0aGUgbmV3IG9iamVjdCBzdG9yZS4gSWYgZW1wdHkgb3Igbm90IHNwZWNpZmllZCwgdGhlIG9iamVjdCBzdG9yZSBpcyBjcmVhdGVkIHdpdGhvdXQgYSBrZXkgcGF0aCBhbmQgdXNlcyBvdXQtb2YtbGluZSBrZXlzLiBZb3UgY2FuIGFsc28gcGFzcyBpbiBhbiBhcnJheSBhcyBhIGtleVBhdGguIHxcbiAgICAgKiB8IGF1dG9JbmNyZW1lbnQgICAgfCBJZiB0cnVlLCB0aGUgb2JqZWN0IHN0b3JlIGhhcyBhIGtleSBnZW5lcmF0b3IuIERlZmF1bHRzIHRvIGZhbHNlLiB8XG4gICAgICogVW5rbm93biBwYXJhbWV0ZXJzIGFyZSBpZ25vcmVkLlxuICAgICAqL1xuICAgIGNyZWF0ZUNvbGxlY3Rpb248VD4gKG5hbWU6IHN0cmluZywgb3B0aW9uczogSURCT2JqZWN0U3RvcmVQYXJhbWV0ZXJzID0ge2F1dG9JbmNyZW1lbnQgOiB0cnVlfSk6IFByb21pc2U8Q29sbGVjdGlvbjxUPj4ge1xuICAgICAgICBpZiAodGhpcy5pZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhuYW1lKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ29sbGVjdGlvbiBhbHJlYWR5IGV4aXN0c1wiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuY29sbGVjdGlvblF1ZXVlLnNpemUgJiYgIXRoaXMuREJPcGVuUmVxdWVzdCkge1xuICAgICAgICAgICAgbGV0IHYgPSB0aGlzLnZlcnNpb24gKyAxO1xuICAgICAgICAgICAgdGhpcy5pZGIuY2xvc2UoKTtcbiAgICAgICAgICAgIHRoaXMuREJPcGVuUmVxdWVzdCA9IHNlbGYuaW5kZXhlZERCLm9wZW4odGhpcy5pZGIubmFtZSwgdik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uUXVldWUuYWRkKG5hbWUpO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8Q29sbGVjdGlvbjxUPj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgLy8gdGhlc2UgdHdvIGV2ZW50IGhhbmRsZXJzIGFjdCBvbiB0aGUgZGF0YWJhc2UgYmVpbmcgb3BlbmVkXG4gICAgICAgICAgICAvLyBzdWNjZXNzZnVsbHksIG9yIG5vdFxuICAgICAgICAgICAgdGhpcy5EQk9wZW5SZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgcmVqZWN0KTtcblxuICAgICAgICAgICAgdGhpcy5EQk9wZW5SZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3VwZ3JhZGVuZWVkZWQnLCBlID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgZGI6IElEQkRhdGFiYXNlID0gdGhpcy5EQk9wZW5SZXF1ZXN0LnJlc3VsdDtcbiAgICAgICAgICAgICAgICB0aGlzLmlkYiA9IGRiO1xuICAgICAgICAgICAgICAgIC8vVGhpcyBtZXRob2QgY2FuIGJlIGNhbGxlZCBvbmx5IHdpdGhpbiBhIHZlcnNpb25jaGFuZ2UgdHJhbnNhY3Rpb24uXG4gICAgICAgICAgICAgICAgY29uc3Qgc3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZShuYW1lLCBvcHRpb25zKTtcblxuICAgICAgICAgICAgICAgIC8vIFVzZSB0cmFuc2FjdGlvbiBvbmNvbXBsZXRlIHRvIG1ha2Ugc3VyZSB0aGUgb2JqZWN0U3RvcmUgY3JlYXRpb24gaXNcbiAgICAgICAgICAgICAgICAvLyBmaW5pc2hlZCBiZWZvcmUgYWRkaW5nIGRhdGEgaW50byBpdC5cbiAgICAgICAgICAgICAgICBsZXQgdHJhbnNhY3Rpb24gPSBzdG9yZS50cmFuc2FjdGlvbjtcbiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5hZGRFdmVudExpc3RlbmVyKCdjb21wbGV0ZScsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgY29sbGVjdGlvbiA9IG5ldyBDb2xsZWN0aW9uPFQ+KHN0b3JlLCB0aGlzLmlkYik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvblF1ZXVlLmRlbGV0ZShuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShjb2xsZWN0aW9uKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLkRCT3BlblJlcXVlc3Qub25zdWNjZXNzID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNvbGxlY3Rpb25RdWV1ZS5zaXplICYmIHRoaXMuREJPcGVuUmVxdWVzdCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkRCT3BlblJlcXVlc3QgPSBudWxsO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vdCBhbGwgY29sbGVjdGlvbnMgd2VyZSBjcmVhdGVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbGxlY3Rpb248VD4gKG5hbWU6IHN0cmluZyk6IENvbGxlY3Rpb248VD4ge1xuICAgICAgICBjb25zdCBzdG9yZSA9IHRoaXMuaWRiLnRyYW5zYWN0aW9uKG5hbWUpLm9iamVjdFN0b3JlKG5hbWUpO1xuICAgICAgICByZXR1cm4gbmV3IENvbGxlY3Rpb24oc3RvcmUsIHRoaXMuaWRiKTtcbiAgICB9XG5cbiAgICBjbG9zZSAoKSB7XG4gICAgICAgIHRoaXMuaWRiLmNsb3NlKCk7XG4gICAgfVxuXG59IiwiaW1wb3J0IHtDdXJzb3IsIEN1cnNvck9wZXJhdGlvbn0gZnJvbSBcIi4vQ3Vyc29yXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29sbGVjdGlvbkNyZWF0ZU9wdGlvbnMge1xuXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29sbGVjdGlvbkluc2VydE9uZU9wdGlvbnMge1xuXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW5zZXJ0T25lV3JpdGVPcFJlc3VsdCB7XG4gICAgaW5zZXJ0ZWRDb3VudDogbnVtYmVyO1xuICAgIGluc2VydGVkSWQ6IGFueTtcbn1cblxuaW50ZXJmYWNlIEluc2VydFdyaXRlT3BSZXN1bHQge1xuICAgIGluc2VydGVkQ291bnQ6IG51bWJlcjtcbiAgICBpbnNlcnRlZElkczogYW55W107XG59XG5cbi8vVE9ETzogYWRkIHN1cHBvcnQgZm9yIG9wZXJhdG9ycyBsaWtlICRlcVxuZXhwb3J0IHR5cGUgRmlsdGVyUXVlcnk8VD4gPSB7XG4gICAgW1AgaW4ga2V5b2YgVF0/OiBUW1BdIHwge1xuICAgICRlcT86IFRbUF07XG4gICAgJGd0PzogVFtQXTtcbiAgICAkZ3RlPzogVFtQXTtcbiAgICAkaW4/OiBUW1BdW107XG4gICAgJGx0PzogVFtQXTtcbiAgICAkbHRlPzogVFtQXTtcbiAgICAkbmU/OiBUW1BdO1xuICAgICRuaW4/OiBUW1BdW107XG4gICAgJGFuZD86IChGaWx0ZXJRdWVyeTxUW1BdPiB8IFRbUF0pW107XG4gICAgJG9yPzogKEZpbHRlclF1ZXJ5PFRbUF0+IHwgVFtQXSlbXTtcbiAgICAkbm90PzogKEZpbHRlclF1ZXJ5PFRbUF0+IHwgVFtQXSlbXSB8IFRbUF07XG4gICAgJGV4cHI/OiBhbnk7XG4gICAgJGpzb25TY2hlbWE/OiBhbnk7XG4gICAgJG1vZD86IFtudW1iZXIsIG51bWJlcl07XG4gICAgJHJlZ2V4PzogUmVnRXhwO1xuICAgICRvcHRpb25zPzogc3RyaW5nO1xuICAgICR0ZXh0Pzoge1xuICAgICAgICAkc2VhcmNoOiBzdHJpbmc7XG4gICAgICAgICRsYW5ndWFnZT86IHN0cmluZztcbiAgICAgICAgJGNhc2VTZW5zaXRpdmU/OiBib29sZWFuO1xuICAgICAgICAkZGlhY3JhdGljU2Vuc2l0aXZlPzogYm9vbGVhbjtcbiAgICB9O1xuICAgICR3aGVyZTogT2JqZWN0O1xuICAgICRnZW9JbnRlcnNlY3RzPzogT2JqZWN0O1xuICAgICRnZW9XaXRoaW4/OiBPYmplY3Q7XG4gICAgJG5lYXI/OiBPYmplY3Q7XG4gICAgJG5lYXJTcGhlcmU/OiBPYmplY3Q7XG4gICAgJGVsZW1NYXRjaD86IE9iamVjdDtcbiAgICAkc2l6ZT86IG51bWJlcjtcbiAgICAkYml0c0FsbENsZWFyPzogT2JqZWN0O1xuICAgICRiaXRzQWxsU2V0PzogT2JqZWN0O1xuICAgICRiaXRzQW55Q2xlYXI/OiBPYmplY3Q7XG4gICAgJGJpdHNBbnlTZXQ/OiBPYmplY3Q7XG4gICAgW2tleTogc3RyaW5nXTogYW55O1xufTtcbn0gfCB7IFtrZXk6IHN0cmluZ106IGFueSB9O1xuXG5pbnRlcmZhY2UgQ29tbW9uT3B0aW9ucyB7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGVsZXRlV3JpdGVPcFJlc3VsdE9iamVjdCB7XG4gICAgLy9UaGUgcmF3IHJlc3VsdCByZXR1cm5lZCBmcm9tIE1vbmdvREIsIGZpZWxkIHdpbGwgdmFyeSBkZXBlbmRpbmcgb24gc2VydmVyIHZlcnNpb24uXG4gICAgcmVzdWx0OiB7XG4gICAgICAgIC8vSXMgMSBpZiB0aGUgY29tbWFuZCBleGVjdXRlZCBjb3JyZWN0bHkuXG4gICAgICAgIG9rPzogbnVtYmVyO1xuICAgICAgICAvL1RoZSB0b3RhbCBjb3VudCBvZiBkb2N1bWVudHMgZGVsZXRlZC5cbiAgICAgICAgbj86IG51bWJlcjtcbiAgICB9XG4gICAgLy9UaGUgbnVtYmVyIG9mIGRvY3VtZW50cyBkZWxldGVkLlxuICAgIGRlbGV0ZWRDb3VudD86IG51bWJlcjtcbn1cblxuY29uc3QgU0lOR0xFID0gdHJ1ZTtcblxuZXhwb3J0IGludGVyZmFjZSBJQ29sbGVjdGlvbjxUPiB7XG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jc1xuICAgICAqIEBwYXJhbSBvcHRpb25zXG4gICAgICovXG4gICAgaW5zZXJ0T25lIChkb2NzOiBPYmplY3QsIG9wdGlvbnM/OiBDb2xsZWN0aW9uSW5zZXJ0T25lT3B0aW9ucyk6IFByb21pc2U8SW5zZXJ0T25lV3JpdGVPcFJlc3VsdD47XG5cbiAgICBpbnNlcnRNYW55IChkb2NzOiBPYmplY3RbXSwgb3B0aW9ucz86IENvbGxlY3Rpb25JbnNlcnRPbmVPcHRpb25zKTogUHJvbWlzZTxJbnNlcnRXcml0ZU9wUmVzdWx0PjtcblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIHF1ZXJ5W29wdGlvbmFsXVxuICAgICAqIFRoZSBmaW5kKCkgbWV0aG9kIHdpdGggbm8gcGFyYW1ldGVycyByZXR1cm5zIGFsbCBkb2N1bWVudHMgZnJvbSBhIGNvbGxlY3Rpb24gYW5kIHJldHVybnMgYWxsIGZpZWxkcyBmb3IgdGhlIGRvY3VtZW50cy5cbiAgICAgKi9cbiAgICBmaW5kIChxdWVyeT86IEZpbHRlclF1ZXJ5PFQ+KTogQ3Vyc29yPFQ+O1xuXG4gICAgLy9maW5kT25lPFQ+KGZpbHRlcjogRmlsdGVyUXVlcnk8VFNjaGVtYT4sIG9wdGlvbnM/OiBGaW5kT25lT3B0aW9ucyk6IFByb21pc2U8VCB8IG51bGw+O1xuXG4gICAgZGVsZXRlTWFueSAoZmlsdGVyOiBGaWx0ZXJRdWVyeTxUPiwgb3B0aW9ucz86IENvbW1vbk9wdGlvbnMpOiBQcm9taXNlPERlbGV0ZVdyaXRlT3BSZXN1bHRPYmplY3Q+O1xuXG4gICAgZGVsZXRlT25lIChmaWx0ZXI6IEZpbHRlclF1ZXJ5PFQ+LCBvcHRpb25zPzogQ29tbW9uT3B0aW9ucyk6IFByb21pc2U8RGVsZXRlV3JpdGVPcFJlc3VsdE9iamVjdD47XG59XG5cbmV4cG9ydCBjbGFzcyBDb2xsZWN0aW9uPFQgZXh0ZW5kcyB7IFtrZXk6IHN0cmluZ106IGFueSB9PiBpbXBsZW1lbnRzIElDb2xsZWN0aW9uPFQ+IHtcbiAgICBjb25zdHJ1Y3RvciAocHJpdmF0ZSBzdG9yZTogSURCT2JqZWN0U3RvcmUsIHByaXZhdGUgaWRiOiBJREJEYXRhYmFzZSkge1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jc1xuICAgICAqIEBwYXJhbSBvcHRpb25zXG4gICAgICovXG4gICAgaW5zZXJ0T25lIChkb2NzOiBPYmplY3QsIG9wdGlvbnM/OiBDb2xsZWN0aW9uSW5zZXJ0T25lT3B0aW9ucyk6IFByb21pc2U8SW5zZXJ0T25lV3JpdGVPcFJlc3VsdD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5pbnNlcnRNYW55KFtkb2NzXSwgb3B0aW9ucykudGhlbihyZXMgPT4gKHtpbnNlcnRlZENvdW50IDogMSwgaW5zZXJ0ZWRJZCA6IHJlcy5pbnNlcnRlZElkc1swXX0pKTtcbiAgICB9XG5cbiAgICBpbnNlcnRNYW55IChkb2NzOiBPYmplY3RbXSwgb3B0aW9ucz86IENvbGxlY3Rpb25JbnNlcnRPbmVPcHRpb25zKTogUHJvbWlzZTxJbnNlcnRXcml0ZU9wUmVzdWx0PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxJbnNlcnRXcml0ZU9wUmVzdWx0PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgaW5zZXJ0ZWRJZHM6IGFueVtdID0gW107XG4gICAgICAgICAgICBsZXQgdHJhbnNhY3Rpb24gPSB0aGlzLmlkYi50cmFuc2FjdGlvbih0aGlzLnN0b3JlLm5hbWUsIFwicmVhZHdyaXRlXCIpO1xuXG4gICAgICAgICAgICAvLyBUbyBkZXRlcm1pbmUgaWYgdGhlIGFkZCBvcGVyYXRpb24gaGFzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHksXG4gICAgICAgICAgICAvLyBsaXN0ZW4gZm9yIHRoZSB0cmFuc2FjdGlvbuKAmXMgY29tcGxldGUgZXZlbnQgaW4gYWRkaXRpb24gdG8gdGhlXG4gICAgICAgICAgICAvLyBJREJPYmplY3RTdG9yZS5hZGQgcmVxdWVzdOKAmXMgc3VjY2VzcyBldmVudCxcbiAgICAgICAgICAgIC8vIGJlY2F1c2UgdGhlIHRyYW5zYWN0aW9uIG1heSBzdGlsbCBmYWlsIGFmdGVyIHRoZSBzdWNjZXNzIGV2ZW50IGZpcmVzLlxuICAgICAgICAgICAgdHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpbnNlcnRlZElkcy5sZW5ndGggPT09IGRvY3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoe2luc2VydGVkQ291bnQgOiBpbnNlcnRlZElkcy5sZW5ndGgsIGluc2VydGVkSWRzfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiTm8gc3VjY2Vzc1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdHJhbnNhY3Rpb24ub25lcnJvciA9IHJlamVjdDtcblxuICAgICAgICAgICAgY29uc3Qgb2JqZWN0U3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZSh0aGlzLnN0b3JlLm5hbWUpO1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGRvYyBvZiBkb2NzKSB7XG4gICAgICAgICAgICAgICAgLy8gTWFrZSBhIHJlcXVlc3QgdG8gYWRkIGRvY3Mgb2JqZWN0IHRvIHRoZSBvYmplY3Qgc3RvcmVcbiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RTdG9yZVJlcXVlc3QgPSBvYmplY3RTdG9yZS5hZGQoZG9jKTtcblxuICAgICAgICAgICAgICAgIG9iamVjdFN0b3JlUmVxdWVzdC5vbmVycm9yID0gcmVqZWN0O1xuICAgICAgICAgICAgICAgIG9iamVjdFN0b3JlUmVxdWVzdC5vbnN1Y2Nlc3MgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHJlc3VsdCBvZiBhIHJlcXVlc3QgZ2VuZXJhdGVkIGZyb20gYSBjYWxsIHRvIGFkZCgpXG4gICAgICAgICAgICAgICAgICAgIC8vIGlzIHRoZSBrZXkgb2YgdGhlIHZhbHVlIHRoYXQgd2FzIGFkZGVkLlxuICAgICAgICAgICAgICAgICAgICBpbnNlcnRlZElkcy5wdXNoKG9iamVjdFN0b3JlUmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0Q3Vyc29yIChxdWVyeTogRmlsdGVyUXVlcnk8VD4sIG9wZXJhdGlvbjogQ3Vyc29yT3BlcmF0aW9uID0gQ3Vyc29yT3BlcmF0aW9uLlJFQUQsIHNpbmdsZTogYm9vbGVhbiA9IGZhbHNlKTogQ3Vyc29yPFQ+IHtcbiAgICAgICAgY29uc3QgbW9kZSA9IG9wZXJhdGlvbiA9PSBDdXJzb3JPcGVyYXRpb24uUkVBRCA/IFwicmVhZG9ubHlcIiA6IFwicmVhZHdyaXRlXCI7XG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gdGhpcy5pZGIudHJhbnNhY3Rpb24odGhpcy5zdG9yZS5uYW1lLCBtb2RlKTtcbiAgICAgICAgY29uc3Qgb2JqZWN0U3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZSh0aGlzLnN0b3JlLm5hbWUpO1xuXG4gICAgICAgIHJldHVybiBuZXcgQ3Vyc29yKG9iamVjdFN0b3JlLCBxdWVyeSwgb3BlcmF0aW9uLCBzaW5nbGUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIHF1ZXJ5W29wdGlvbmFsXVxuICAgICAqIFRoZSBmaW5kKCkgbWV0aG9kIHdpdGggbm8gcGFyYW1ldGVycyByZXR1cm5zIGFsbCBkb2N1bWVudHMgZnJvbSBhIGNvbGxlY3Rpb24gYW5kIHJldHVybnMgYWxsIGZpZWxkcyBmb3IgdGhlIGRvY3VtZW50cy5cbiAgICAgKi9cbiAgICBmaW5kIChxdWVyeT86IEZpbHRlclF1ZXJ5PFQ+KTogQ3Vyc29yPFQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q3Vyc29yKHF1ZXJ5LCBDdXJzb3JPcGVyYXRpb24uUkVBRCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkZWxldGUgKGZpbHRlcjogRmlsdGVyUXVlcnk8VD4sIG9wZXJhdGlvbjogQ3Vyc29yT3BlcmF0aW9uID0gQ3Vyc29yT3BlcmF0aW9uLkRFTEVURSwgb3B0aW9ucz86IENvbW1vbk9wdGlvbnMsIHNpbmdsZT86IGJvb2xlYW4pIHtcbiAgICAgICAgbGV0IGN1cnNvciA9IHRoaXMuZ2V0Q3Vyc29yKGZpbHRlciwgb3BlcmF0aW9uLCBzaW5nbGUpO1xuXG4gICAgICAgIHJldHVybiBjdXJzb3IuZ2V0UmVzdWx0KCkudGhlbihkZWxldGVkID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcmVzdWx0IDoge1xuICAgICAgICAgICAgICAgICAgICAvL0lzIDEgaWYgdGhlIGNvbW1hbmQgZXhlY3V0ZWQgY29ycmVjdGx5LlxuICAgICAgICAgICAgICAgICAgICBvayA6IDEsXG4gICAgICAgICAgICAgICAgICAgIC8vVGhlIHRvdGFsIGNvdW50IG9mIGRvY3VtZW50cyBkZWxldGVkLlxuICAgICAgICAgICAgICAgICAgICBuIDogZGVsZXRlZC5sZW5ndGhcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC8vVGhlIG51bWJlciBvZiBkb2N1bWVudHMgZGVsZXRlZC5cbiAgICAgICAgICAgICAgICBkZWxldGVkQ291bnQgOiBkZWxldGVkLmxlbmd0aFxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBkZWxldGVNYW55IChmaWx0ZXI6IEZpbHRlclF1ZXJ5PFQ+LCBvcHRpb25zPzogQ29tbW9uT3B0aW9ucyk6IFByb21pc2U8RGVsZXRlV3JpdGVPcFJlc3VsdE9iamVjdD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5kZWxldGUoZmlsdGVyLCBDdXJzb3JPcGVyYXRpb24uREVMRVRFLCBvcHRpb25zKTtcbiAgICB9XG5cbiAgICBkZWxldGVPbmUgKGZpbHRlcjogRmlsdGVyUXVlcnk8VD4sIG9wdGlvbnM/OiBDb21tb25PcHRpb25zKTogUHJvbWlzZTxEZWxldGVXcml0ZU9wUmVzdWx0T2JqZWN0PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmRlbGV0ZShmaWx0ZXIsIEN1cnNvck9wZXJhdGlvbi5ERUxFVEUsIG9wdGlvbnMsIFNJTkdMRSk7XG4gICAgfVxuXG5cbn0iLCJpbXBvcnQge0ZpbHRlclF1ZXJ5fSBmcm9tIFwiLi9Db2xsZWN0aW9uXCI7XG5cbmV4cG9ydCBlbnVtIEN1cnNvck9wZXJhdGlvbiB7XG4gICAgREVMRVRFLCBVUERBVEUsIFJFQURcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJQ3Vyc29yPFQ+IHtcbiAgICB0b0FycmF5ICgpOiBQcm9taXNlPFRbXT5cbn1cblxuLy9bUCBpbiBrZXlvZiBUXT86IFRbUF1cbmV4cG9ydCBjbGFzcyBDdXJzb3I8VCBleHRlbmRzIHsgW2tleTogc3RyaW5nXTogYW55IH0+IGltcGxlbWVudHMgSUN1cnNvcjxUPiB7XG4gICAgcHJpdmF0ZSByZXN1bHQ6IFByb21pc2U8VFtdPjtcbiAgICBwcml2YXRlIF9yZXN1bHQ6IFRbXTtcblxuICAgIGNvbnN0cnVjdG9yIChzdG9yZTogSURCT2JqZWN0U3RvcmUsIGZpbHRlcj86IEZpbHRlclF1ZXJ5PFQ+LCBvcGVyYXRpb246IEN1cnNvck9wZXJhdGlvbiA9IEN1cnNvck9wZXJhdGlvbi5SRUFELCBzaW5nbGU/OiBib29sZWFuKSB7XG4gICAgICAgIC8vVE9ETzogcHJvY2VzcyB0aGUgcXVlcnlcbiAgICAgICAgLy8gVGhlIGdldEFsbCgpIG1ldGhvZCBvZiB0aGUgSURCT2JqZWN0U3RvcmUgaW50ZXJmYWNlIHJldHVybnMgYW4gSURCUmVxdWVzdCBvYmplY3RcbiAgICAgICAgLy8gY29udGFpbmluZyBhbGwgb2JqZWN0cyBpbiB0aGUgb2JqZWN0IHN0b3JlIG1hdGNoaW5nIHRoZSBzcGVjaWZpZWQgcGFyYW1ldGVyIG9yXG4gICAgICAgIC8vIGFsbCBvYmplY3RzIGluIHRoZSBzdG9yZSBpZiBubyBwYXJhbWV0ZXJzIGFyZSBnaXZlbi5cbiAgICAgICAgbGV0IHJlcXVlc3QgPSB0aGlzLmdldFJlcXVlc3Qoc3RvcmUsIG9wZXJhdGlvbiwgZmlsdGVyKTtcbiAgICAgICAgbGV0IGV4ZWN1dGVkID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5yZXN1bHQgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cbiAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChzaW5nbGUgJiYgZXhlY3V0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZSh0aGlzLl9yZXN1bHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBjdXJzb3IgPSByZXF1ZXN0LnJlc3VsdDtcbiAgICAgICAgICAgICAgICBpZiAoY3Vyc29yICYmIGN1cnNvciBpbnN0YW5jZW9mIElEQkN1cnNvcldpdGhWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXN1bHQgPSB0aGlzLl9yZXN1bHQgfHwgW107XG4gICAgICAgICAgICAgICAgICAgIC8vIGN1cnNvci52YWx1ZSBjb250YWlucyB0aGUgY3VycmVudCByZWNvcmQgYmVpbmcgaXRlcmF0ZWQgdGhyb3VnaFxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIHdoZXJlIHlvdSdkIGRvIHNvbWV0aGluZyB3aXRoIHRoZSByZXN1bHRcbiAgICAgICAgICAgICAgICAgICAgZXhlY3V0ZWQgPSB0aGlzLmV4ZWN1dGVDdXJzb3JPcGVyYXRpb24ob3BlcmF0aW9uLCBjdXJzb3IsIGZpbHRlcik7XG4gICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzdWx0ID0gdGhpcy5fcmVzdWx0IHx8IFtdLmNvbmNhdChyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHRoaXMuX3Jlc3VsdCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIH0pO1xuXG5cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFJlcXVlc3QgKHN0b3JlOiBJREJPYmplY3RTdG9yZSwgb3BlcmF0aW9uOiBDdXJzb3JPcGVyYXRpb24sIGZpbHRlcj86IEZpbHRlclF1ZXJ5PFQ+KTogSURCUmVxdWVzdCB7XG4gICAgICAgIGNvbnN0IGtleVBhdGggPSBzdG9yZS5rZXlQYXRoIGFzIHN0cmluZztcbiAgICAgICAgY29uc3Qga2V5ID0gZmlsdGVyICYmIGZpbHRlcltrZXlQYXRoXTtcblxuICAgICAgICBzd2l0Y2ggKG9wZXJhdGlvbikge1xuICAgICAgICAgICAgY2FzZSBDdXJzb3JPcGVyYXRpb24uREVMRVRFOlxuICAgICAgICAgICAgICAgIGlmICghZmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdG9yZS5jbGVhcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoa2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdG9yZS5kZWxldGUoa2V5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEN1cnNvck9wZXJhdGlvbi5SRUFEOlxuICAgICAgICAgICAgICAgIGlmICghZmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdG9yZS5nZXRBbGwoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGtleSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RvcmUuZ2V0KGtleSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgLy9UT0RPOiB1cGRhdGVcbiAgICAgICAgICAgIC8vIGNhc2UgQ3Vyc29yT3BlcmF0aW9uLlVQREFURTpcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzdG9yZS5vcGVuQ3Vyc29yKCkgYXMgSURCUmVxdWVzdDxJREJDdXJzb3JXaXRoVmFsdWUgfCBudWxsPjtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFwcGx5RmlsdGVyICh2YWx1ZTogVCwgZmlsdGVyOiBGaWx0ZXJRdWVyeTxUPikge1xuICAgICAgICBsZXQgZmlsdGVyS2V5cyA9IE9iamVjdC5rZXlzKGZpbHRlcik7XG5cbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgZmlsdGVyS2V5cykge1xuICAgICAgICAgICAgaWYgKGtleS5zdGFydHNXaXRoKCckJykpIHtcbiAgICAgICAgICAgICAgICAvL1RPRE86IG9wZXJhdG9yc1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2YWx1ZVtrZXldICE9IGZpbHRlcltrZXldKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgZXhlY3V0ZUN1cnNvck9wZXJhdGlvbiAob3BlcmF0aW9uOiBDdXJzb3JPcGVyYXRpb24sIGN1cnNvcjogSURCQ3Vyc29yV2l0aFZhbHVlLCBmaWx0ZXI/OiBGaWx0ZXJRdWVyeTxUPik6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGZpbHRlciA/IHRoaXMuYXBwbHlGaWx0ZXIoY3Vyc29yLnZhbHVlLCBmaWx0ZXIpIDogY3Vyc29yLnZhbHVlO1xuICAgICAgICBpZiAoIXZhbHVlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcmVzdWx0LnB1c2godmFsdWUpO1xuICAgICAgICBzd2l0Y2ggKG9wZXJhdGlvbikge1xuICAgICAgICAgICAgY2FzZSBDdXJzb3JPcGVyYXRpb24uREVMRVRFOlxuICAgICAgICAgICAgICAgIGN1cnNvci5kZWxldGUoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgQ3Vyc29yT3BlcmF0aW9uLlVQREFURTpcbiAgICAgICAgICAgICAgICAvL1RPRE86IFVwZGF0ZVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGdldFJlc3VsdCAoKTogUHJvbWlzZTxUW10+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVzdWx0O1xuICAgIH1cblxuXG4vLyBzb3J0VmFsdWU6IHN0cmluZztcbiAgICAvLyB0aW1lb3V0OiBib29sZWFuO1xuICAgIC8vIHJlYWRQcmVmZXJlbmNlOiBSZWFkUHJlZmVyZW5jZTtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNhZGRDdXJzb3JGbGFnICovXG4gICAgLy8gYWRkQ3Vyc29yRmxhZyhmbGFnOiBzdHJpbmcsIHZhbHVlOiBib29sZWFuKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2FkZFF1ZXJ5TW9kaWZpZXIgKi9cbiAgICAvLyBhZGRRdWVyeU1vZGlmaWVyKG5hbWU6IHN0cmluZywgdmFsdWU6IGJvb2xlYW4pOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjYmF0Y2hTaXplICovXG4gICAgLy8gYmF0Y2hTaXplKHZhbHVlOiBudW1iZXIpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjY2xvbmUgKi9cbiAgICAvLyBjbG9uZSgpOiBDdXJzb3I8VD47IC8vIHN0aWxsIHJldHVybnMgdGhlIHNhbWUgdHlwZVxuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2Nsb3NlICovXG4gICAgLy8gY2xvc2UoKTogUHJvbWlzZTxDdXJzb3JSZXN1bHQ+O1xuICAgIC8vIGNsb3NlKGNhbGxiYWNrOiBNb25nb0NhbGxiYWNrPEN1cnNvclJlc3VsdD4pOiB2b2lkO1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2NvbGxhdGlvbiAqL1xuICAgIC8vIGNvbGxhdGlvbih2YWx1ZTogT2JqZWN0KTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2NvbW1lbnQgKi9cbiAgICAvLyBjb21tZW50KHZhbHVlOiBzdHJpbmcpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjY291bnQgKi9cbiAgICAvLyBjb3VudChjYWxsYmFjazogTW9uZ29DYWxsYmFjazxudW1iZXI+KTogdm9pZDtcbiAgICAvLyBjb3VudChhcHBseVNraXBMaW1pdDogYm9vbGVhbiwgY2FsbGJhY2s6IE1vbmdvQ2FsbGJhY2s8bnVtYmVyPik6IHZvaWQ7XG4gICAgLy8gY291bnQob3B0aW9uczogQ3Vyc29yQ29tbWVudE9wdGlvbnMsIGNhbGxiYWNrOiBNb25nb0NhbGxiYWNrPG51bWJlcj4pOiB2b2lkO1xuICAgIC8vIGNvdW50KGFwcGx5U2tpcExpbWl0OiBib29sZWFuLCBvcHRpb25zOiBDdXJzb3JDb21tZW50T3B0aW9ucywgY2FsbGJhY2s6IE1vbmdvQ2FsbGJhY2s8bnVtYmVyPik6IHZvaWQ7XG4gICAgLy8gY291bnQoYXBwbHlTa2lwTGltaXQ/OiBib29sZWFuLCBvcHRpb25zPzogQ3Vyc29yQ29tbWVudE9wdGlvbnMpOiBQcm9taXNlPG51bWJlcj47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjZXhwbGFpbiAqL1xuICAgIC8vIGV4cGxhaW4oKTogUHJvbWlzZTxDdXJzb3JSZXN1bHQ+O1xuICAgIC8vIGV4cGxhaW4oY2FsbGJhY2s6IE1vbmdvQ2FsbGJhY2s8Q3Vyc29yUmVzdWx0Pik6IHZvaWQ7XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjZmlsdGVyICovXG4gICAgLy8gZmlsdGVyKGZpbHRlcjogT2JqZWN0KTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2ZvckVhY2ggKi9cbiAgICAvLyBmb3JFYWNoKGl0ZXJhdG9yOiBJdGVyYXRvckNhbGxiYWNrPFQ+LCBjYWxsYmFjazogRW5kQ2FsbGJhY2spOiB2b2lkO1xuICAgIC8vIGZvckVhY2goaXRlcmF0b3I6IEl0ZXJhdG9yQ2FsbGJhY2s8VD4pOiBQcm9taXNlPHZvaWQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2hhc05leHQgKi9cbiAgICAvLyBoYXNOZXh0KCk6IFByb21pc2U8Ym9vbGVhbj47XG4gICAgLy8gaGFzTmV4dChjYWxsYmFjazogTW9uZ29DYWxsYmFjazxib29sZWFuPik6IHZvaWQ7XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjaGludCAqL1xuICAgIC8vIGhpbnQoaGludDogT2JqZWN0KTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2lzQ2xvc2VkICovXG4gICAgLy8gaXNDbG9zZWQoKTogYm9vbGVhbjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNsaW1pdCAqL1xuICAgIC8vIGxpbWl0KHZhbHVlOiBudW1iZXIpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjbWFwICovXG4gICAgLy8gbWFwPFU+KHRyYW5zZm9ybTogKGRvY3VtZW50OiBUKSA9PiBVKTogQ3Vyc29yPFU+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI21heCAqL1xuICAgIC8vIG1heChtYXg6IG51bWJlcik6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNtYXhBd2FpdFRpbWVNUyAqL1xuICAgIC8vIG1heEF3YWl0VGltZU1TKHZhbHVlOiBudW1iZXIpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjbWF4U2NhbiAqL1xuICAgIC8vIG1heFNjYW4obWF4U2NhbjogT2JqZWN0KTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI21heFRpbWVNUyAqL1xuICAgIC8vIG1heFRpbWVNUyh2YWx1ZTogbnVtYmVyKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI21pbiAqL1xuICAgIC8vIG1pbihtaW46IG51bWJlcik6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNuZXh0ICovXG4gICAgLy8gbmV4dCgpOiBQcm9taXNlPFQgfCBudWxsPjtcbiAgICAvLyBuZXh0KGNhbGxiYWNrOiBNb25nb0NhbGxiYWNrPFQgfCBudWxsPik6IHZvaWQ7XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjcHJvamVjdCAqL1xuICAgIC8vIHByb2plY3QodmFsdWU6IE9iamVjdCk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNyZWFkICovXG4gICAgLy8gcmVhZChzaXplOiBudW1iZXIpOiBzdHJpbmcgfCBCdWZmZXIgfCB2b2lkO1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI25leHQgKi9cbiAgICAvLyByZXR1cm5LZXkocmV0dXJuS2V5OiBPYmplY3QpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjcmV3aW5kICovXG4gICAgLy8gcmV3aW5kKCk6IHZvaWQ7XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjc2V0Q3Vyc29yT3B0aW9uICovXG4gICAgLy8gc2V0Q3Vyc29yT3B0aW9uKGZpZWxkOiBzdHJpbmcsIHZhbHVlOiBPYmplY3QpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjc2V0UmVhZFByZWZlcmVuY2UgKi9cbiAgICAvLyBzZXRSZWFkUHJlZmVyZW5jZShyZWFkUHJlZmVyZW5jZTogc3RyaW5nIHwgUmVhZFByZWZlcmVuY2UpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjc2hvd1JlY29yZElkICovXG4gICAgLy8gc2hvd1JlY29yZElkKHNob3dSZWNvcmRJZDogT2JqZWN0KTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI3NraXAgKi9cbiAgICAvLyBza2lwKHZhbHVlOiBudW1iZXIpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjc25hcHNob3QgKi9cbiAgICAvLyBzbmFwc2hvdChzbmFwc2hvdDogT2JqZWN0KTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI3NvcnQgKi9cbiAgICAvLyBzb3J0KGtleU9yTGlzdDogc3RyaW5nIHwgT2JqZWN0W10gfCBPYmplY3QsIGRpcmVjdGlvbj86IG51bWJlcik6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNzdHJlYW0gKi9cbiAgICAvLyBzdHJlYW0ob3B0aW9ucz86IHsgdHJhbnNmb3JtPzogRnVuY3Rpb24gfSk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCN0b0FycmF5ICovXG4gICAgdG9BcnJheSAoKTogUHJvbWlzZTxUW10+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVzdWx0LnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgIHJldHVybiBBcnJheS5mcm9tKHJlc3VsdCkgYXMgVFtdO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCN1bnNoaWZ0ICovXG4gICAgLy8gdW5zaGlmdChzdHJlYW06IEJ1ZmZlciB8IHN0cmluZyk6IHZvaWQ7XG5cblxufSJdLCJzb3VyY2VSb290IjoiIn0=