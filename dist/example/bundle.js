!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1);document.getElementById("output").innerHTML="",o.IndexedClient.connect("example").then(function(e){const t=e.db;function n(n){t.collection("another_collection").find(n).toArray().then(t=>{console.log(t),document.getElementById("output").innerHTML+=`<p>another_collection find {b : 2}: ${JSON.stringify(t)}</p>`,e.close()})}document.getElementById("output").innerHTML+=`<p>DB version: ${t.version}</p>`,1==t.version?Promise.all([t.createCollection("a_simple_collection").then(function(e){e.insertOne({a:1}).then(function(e){console.log("a_simple_collection",e),document.getElementById("output").innerHTML+=`<p>a_simple_collection: ${JSON.stringify(e)}</p>`})}),t.createCollection("another_collection").then(function(e){e.insertMany([{b:2},{c:3},{d:4},{b:2}]).then(function(e){console.log("another_collection",e),document.getElementById("output").innerHTML+=`<p>another_collection: ${JSON.stringify(e)}</p>`})})]).then(e=>{n({b:2})}):n({b:2})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2);t.IndexedClient=class e{constructor(e){}close(e){return Promise.resolve(this.db.close())}static connect(t,n){const r=new e(t);return o.Db.open(t).then(e=>(r.db=e,r))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(3);class r{constructor(e){this.idb=e,this.collectionQueue=new Set}static open(e,t){const n=self.indexedDB.open(e);return new Promise((e,t)=>{n.addEventListener("error",t),n.addEventListener("success",function(t){let o=new r(n.result);e(o)}),n.onblocked=(e=>{console.log("blocked")})})}get version(){return this.idb?this.idb.version:0}createCollection(e,t={autoIncrement:!0}){if(this.idb.objectStoreNames.contains(e))throw new Error("Collection already exists");if(!this.collectionQueue.size&&!this.DBOpenRequest){let e=this.version+1;this.idb.close(),this.DBOpenRequest=self.indexedDB.open(this.idb.name,e)}return this.collectionQueue.add(e),new Promise((n,r)=>{this.DBOpenRequest.addEventListener("error",r),this.DBOpenRequest.addEventListener("upgradeneeded",r=>{let s=this.DBOpenRequest.result;this.idb=s;const i=s.createObjectStore(e,t);i.transaction.addEventListener("complete",t=>{let r=new o.Collection(i,this.idb);this.collectionQueue.delete(e),n(r)})}),this.DBOpenRequest.onsuccess=(e=>{if(this.collectionQueue.size||!this.DBOpenRequest)throw new Error("Not all collections were created");this.DBOpenRequest=null})})}collection(e){const t=this.idb.transaction(e).objectStore(e);return new o.Collection(t,this.idb)}close(){this.idb.close()}}t.Db=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(4);t.Collection=class{constructor(e,t){this.store=e,this.idb=t}insertOne(e,t){return this.insertMany([e],t).then(e=>({insertedCount:1,insertedId:e.insertedIds[0]}))}insertMany(e,t){return new Promise((t,n)=>{let o=[],r=this.idb.transaction(this.store.name,"readwrite");r.oncomplete=(r=>{o.length===e.length?t({insertedCount:o.length,insertedIds:o}):n("No success")}),r.onerror=n;const s=r.objectStore(this.store.name);for(const t of e){const e=s.add(t);e.onerror=n,e.onsuccess=(t=>{o.push(e.result)})}})}find(e){const t=this.idb.transaction(this.store.name).objectStore(this.store.name);let n;return n=e?t.openCursor():t.getAll(),new o.Cursor(n,e)}}},function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.DELETE=0]="DELETE",e[e.UPDATE=1]="UPDATE",e[e.READ=2]="READ"}(o=t.CursorOperation||(t.CursorOperation={}));t.Cursor=class{constructor(e,t,n=o.READ){this.request=e,this.result=new Promise((o,r)=>{this.request.onerror=(e=>{r(this.request.error)}),this.request.onsuccess=(r=>{const s=e.result;if(s&&s instanceof IDBCursorWithValue)return this._result=this._result||[],this.executeCursorOperation(n,s,t),void s.continue();this._result=this._result||this.request.result,o(this._result)})})}applyFilter(e,t){let n=Object.keys(t);for(const o of n){if(o.startsWith("$"))return;if(e[o]!=t[o])return}return e}executeCursorOperation(e,t,n){const r=n?this.applyFilter(t.value,n):t.value;if(r)switch(e){case o.DELETE:t.delete();break;case o.UPDATE:break;default:this._result.push(r)}}toArray(){return this.result.then(e=>Array.from(e))}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2V4YW1wbGUvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL0luZGV4ZWRDbGllbnQudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL0RiLnRzIiwid2VicGFjazovLy8uL3NyYy9Db2xsZWN0aW9uLnRzIiwid2VicGFjazovLy8uL3NyYy9DdXJzb3IudHMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJJbmRleGVkQ2xpZW50XzEiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaW5uZXJIVE1MIiwiSW5kZXhlZENsaWVudCIsImNvbm5lY3QiLCJ0aGVuIiwiY2xpZW50IiwiZGIiLCJmaW5kIiwicSIsImNvbGxlY3Rpb24iLCJ0b0FycmF5IiwidmFsdWVzIiwiY29uc29sZSIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJjbG9zZSIsInZlcnNpb24iLCJQcm9taXNlIiwiYWxsIiwiY3JlYXRlQ29sbGVjdGlvbiIsImluc2VydE9uZSIsImEiLCJpbnNlcnRNYW55IiwiYiIsInJlcyIsIkRiXzEiLCJbb2JqZWN0IE9iamVjdF0iLCJkYm5hbWUiLCJmb3JjZSIsInJlc29sdmUiLCJ0aGlzIiwib3B0aW9ucyIsIkRiIiwib3BlbiIsIkNvbGxlY3Rpb25fMSIsImlkYiIsImNvbGxlY3Rpb25RdWV1ZSIsIlNldCIsImNvbGxlY3Rpb25zIiwiREJPcGVuUmVxdWVzdCIsInNlbGYiLCJpbmRleGVkREIiLCJyZWplY3QiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJyZXN1bHQiLCJvbmJsb2NrZWQiLCJlIiwiYXV0b0luY3JlbWVudCIsIm9iamVjdFN0b3JlTmFtZXMiLCJjb250YWlucyIsIkVycm9yIiwic2l6ZSIsInYiLCJhZGQiLCJzdG9yZSIsImNyZWF0ZU9iamVjdFN0b3JlIiwidHJhbnNhY3Rpb24iLCJDb2xsZWN0aW9uIiwiZGVsZXRlIiwib25zdWNjZXNzIiwib2JqZWN0U3RvcmUiLCJDdXJzb3JfMSIsImRvY3MiLCJpbnNlcnRlZENvdW50IiwiaW5zZXJ0ZWRJZCIsImluc2VydGVkSWRzIiwib25jb21wbGV0ZSIsImxlbmd0aCIsIm9uZXJyb3IiLCJkb2MiLCJvYmplY3RTdG9yZVJlcXVlc3QiLCJwdXNoIiwicXVlcnkiLCJyZXF1ZXN0Iiwib3BlbkN1cnNvciIsImdldEFsbCIsIkN1cnNvciIsIkN1cnNvck9wZXJhdGlvbiIsImZpbHRlciIsIm9wZXJhdGlvbiIsIlJFQUQiLCJlcnJvciIsImN1cnNvciIsIklEQkN1cnNvcldpdGhWYWx1ZSIsIl9yZXN1bHQiLCJleGVjdXRlQ3Vyc29yT3BlcmF0aW9uIiwiY29udGludWUiLCJmaWx0ZXJLZXlzIiwia2V5cyIsInN0YXJ0c1dpdGgiLCJhcHBseUZpbHRlciIsIkRFTEVURSIsIlVQREFURSIsIkFycmF5IiwiZnJvbSJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsS0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxJQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFlBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUs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cEcsRUFBSXNHLFdBQVcsS0FFZixPQUVKLEdBQUk1RyxFQUFNTSxJQUFRMkYsRUFBTzNGLEdBQ3JCLE9BR1IsT0FBT04sRUFJSDRDLHVCQUF3QnNELEVBQTRCRyxFQUE0QkosR0FDcEYsTUFBTWpHLEVBQVFpRyxFQUFTakQsS0FBSzZELFlBQVlSLEVBQU9yRyxNQUFPaUcsR0FBVUksRUFBT3JHLE1BQ3ZFLEdBQUtBLEVBR0wsT0FBUWtHLEdBQ0osS0FBS0YsRUFBZ0JjLE9BQ2pCVCxFQUFPeEIsU0FDUCxNQUNKLEtBQUttQixFQUFnQmUsT0FHakIsTUFDSixRQUNJL0QsS0FBS3VELFFBQVFiLEtBQUsxRixJQW1GOUI0QyxVQUNJLE9BQU9JLEtBQUtlLE9BQU8xQyxLQUFLMEMsR0FBVWlELE1BQU1DLEtBQUtsRCIsImZpbGUiOiJleGFtcGxlL2J1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImltcG9ydCB7SW5kZXhlZENsaWVudH0gZnJvbSBcIi4uL0luZGV4ZWRDbGllbnRcIjtcbmltcG9ydCB7RGJ9IGZyb20gXCIuLi9EYlwiO1xuLypcbi8vIENvbm5lY3QgdXNpbmcgTW9uZ29DbGllbnRcbk1vbmdvQ2xpZW50LmNvbm5lY3QodXJsLCBmdW5jdGlvbihlcnIsIGNsaWVudCkge1xuICAvLyBDcmVhdGUgYSBjb2xsZWN0aW9uIHdlIHdhbnQgdG8gZHJvcCBsYXRlclxuICBjb25zdCBjb2wgPSBjbGllbnQuZGIoZGJOYW1lKS5jb2xsZWN0aW9uKCdjcmVhdGVJbmRleEV4YW1wbGUxJyk7XG4gIC8vIFNob3cgdGhhdCBkdXBsaWNhdGUgcmVjb3JkcyBnb3QgZHJvcHBlZFxuICBjb2wuZmluZCh7fSkudG9BcnJheShmdW5jdGlvbihlcnIsIGl0ZW1zKSB7XG4gICAgdGVzdC5lcXVhbChudWxsLCBlcnIpO1xuICAgIHRlc3QuZXF1YWwoNCwgaXRlbXMubGVuZ3RoKTtcbiAgICBjbGllbnQuY2xvc2UoKTtcbiAgfSk7XG59KTtcbiogKi9cbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3V0cHV0XCIpLmlubmVySFRNTCA9IFwiXCI7XG5JbmRleGVkQ2xpZW50LmNvbm5lY3QoXCJleGFtcGxlXCIpLnRoZW4oZnVuY3Rpb24gKGNsaWVudCkge1xuICAgIGNvbnN0IGRiID0gY2xpZW50LmRiIGFzIERiO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3V0cHV0XCIpLmlubmVySFRNTCArPSBgPHA+REIgdmVyc2lvbjogJHtkYi52ZXJzaW9ufTwvcD5gO1xuICAgIGlmIChkYi52ZXJzaW9uID09IDEpIHtcbiAgICAgICAgLy8gQ3JlYXRlIGEgY29sbGVjdGlvblxuICAgICAgICBQcm9taXNlLmFsbChbXG4gICAgICAgICAgICBkYi5jcmVhdGVDb2xsZWN0aW9uKFwiYV9zaW1wbGVfY29sbGVjdGlvblwiKS50aGVuKGZ1bmN0aW9uIChjb2xsZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgLy8gSW5zZXJ0IGEgZG9jdW1lbnQgaW4gdGhlIGNvbGxlY3Rpb25cbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uLmluc2VydE9uZSh7YSA6IDF9KS50aGVuKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEZpbmlzaCB1cCB0ZXN0XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiYV9zaW1wbGVfY29sbGVjdGlvblwiLCByKTtcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvdXRwdXRcIikuaW5uZXJIVE1MICs9IGA8cD5hX3NpbXBsZV9jb2xsZWN0aW9uOiAke0pTT04uc3RyaW5naWZ5KHIpfTwvcD5gO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBkYi5jcmVhdGVDb2xsZWN0aW9uKFwiYW5vdGhlcl9jb2xsZWN0aW9uXCIpLnRoZW4oZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAvLyBJbnNlcnQgYSBkb2N1bWVudCBpbiB0aGUgY29sbGVjdGlvblxuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb24uaW5zZXJ0TWFueShbe2IgOiAyfSwge2MgOiAzfSwge2QgOiA0fSwge2IgOiAyfV0pLnRoZW4oZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRmluaXNoIHVwIHRlc3RcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJhbm90aGVyX2NvbGxlY3Rpb25cIiwgcik7XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3V0cHV0XCIpLmlubmVySFRNTCArPSBgPHA+YW5vdGhlcl9jb2xsZWN0aW9uOiAke0pTT04uc3RyaW5naWZ5KHIpfTwvcD5gO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSldKS50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICBmaW5kKHtiIDogMn0pXG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGZpbmQoe2IgOiAyfSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBmaW5kIChxPzogYW55KSB7XG4gICAgICAgIGNvbnN0IGMgPSBkYi5jb2xsZWN0aW9uKFwiYW5vdGhlcl9jb2xsZWN0aW9uXCIpO1xuICAgICAgICBjLmZpbmQocSkudG9BcnJheSgpLnRoZW4odmFsdWVzID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHZhbHVlcyk7XG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm91dHB1dFwiKS5pbm5lckhUTUwgKz0gYDxwPmFub3RoZXJfY29sbGVjdGlvbiBmaW5kIHtiIDogMn06ICR7SlNPTi5zdHJpbmdpZnkodmFsdWVzKX08L3A+YDtcbiAgICAgICAgICAgIGNsaWVudC5jbG9zZSgpO1xuICAgICAgICB9KVxuICAgIH1cbn0pO1xuXG4iLCJpbXBvcnQge0RiLCBJRGJ9IGZyb20gXCIuL0RiXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW5kZXhlZENsaWVudE9wdGlvbnMge1xuICAgIGNvbGxlY3Rpb25zPzogc3RyaW5nW11cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJbmRleGVkTW9uZ29DbGllbnRPcHRpb25zIHtcblxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEluZGV4ZWRNb25nb0NsaWVudFN0YXRpYyB7XG4gICAgLy9zdGF0aWMgY29ubmVjdCh1cmk6IHN0cmluZywgb3B0aW9ucz86IE1vbmdvQ2xpZW50T3B0aW9ucyk6IFByb21pc2U8TW9uZ29DbGllbnQ+O1xuICAgIGNvbm5lY3QgKHVyaTogc3RyaW5nLCBvcHRpb25zPzogSW5kZXhlZE1vbmdvQ2xpZW50T3B0aW9ucyk6IFByb21pc2U8SW5kZXhlZE1vbmdvQ2xpZW50PlxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEluZGV4ZWRNb25nb0NsaWVudCB7XG4gICAgZGI6IElEYjtcblxuICAgIGNsb3NlIChmb3JjZT86IGJvb2xlYW4pOiBQcm9taXNlPHZvaWQ+O1xufVxuXG5leHBvcnQgY29uc3QgSW5kZXhlZENsaWVudDogSW5kZXhlZE1vbmdvQ2xpZW50U3RhdGljID0gY2xhc3MgSW5kZXhlZENsaWVudCBpbXBsZW1lbnRzIEluZGV4ZWRNb25nb0NsaWVudCB7XG4gICAgcHVibGljIGRiOiBEYjtcblxuICAgIGNvbnN0cnVjdG9yIChkYm5hbWU6IHN0cmluZykge1xuICAgIH1cblxuICAgIGNsb3NlIChmb3JjZT86IGJvb2xlYW4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLmRiLmNsb3NlKCkpO1xuICAgIH1cblxuICAgIHN0YXRpYyBjb25uZWN0IChuYW1lOiBzdHJpbmcsIG9wdGlvbnM/OiBJbmRleGVkQ2xpZW50T3B0aW9ucyk6IFByb21pc2U8SW5kZXhlZE1vbmdvQ2xpZW50PiB7XG4gICAgICAgIC8vIElmIHRoZSB2ZXJzaW9uIGlzIG5vdCBwcm92aWRlZCBhbmQgdGhlIGRhdGFiYXNlIGV4aXN0cywgdGhlbiBhIGNvbm5lY3Rpb24gdG8gdGhlIGRhdGFiYXNlIHdpbGwgYmUgb3BlbmVkIHdpdGhvdXQgY2hhbmdpbmcgaXRzIHZlcnNpb24uIElmIHRoZSB2ZXJzaW9uIGlzIG5vdCBwcm92aWRlZCBhbmQgdGhlIGRhdGFiYXNlIGRvZXMgbm90IGV4aXN0LCB0aGVuIGl0IHdpbGwgYmUgY3JlYXRlZCB3aXRoIHZlcnNpb24gMS5cbiAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IEluZGV4ZWRDbGllbnQobmFtZSk7XG4gICAgICAgIHJldHVybiBEYi5vcGVuKG5hbWUpLnRoZW4oZGIgPT4ge1xuICAgICAgICAgICAgY2xpZW50LmRiID0gZGI7XG4gICAgICAgICAgICByZXR1cm4gY2xpZW50IGFzIEluZGV4ZWRNb25nb0NsaWVudDtcbiAgICAgICAgfSk7XG4gICAgfVxuXG59OyIsImltcG9ydCB7Q29sbGVjdGlvbiwgQ29sbGVjdGlvbkNyZWF0ZU9wdGlvbnN9IGZyb20gXCIuL0NvbGxlY3Rpb25cIjtcblxuZXhwb3J0IGludGVyZmFjZSBJRGIge1xuICAgIGNyZWF0ZUNvbGxlY3Rpb24gKG5hbWU6IHN0cmluZywgb3B0aW9ucz86IENvbGxlY3Rpb25DcmVhdGVPcHRpb25zKTogUHJvbWlzZTxDb2xsZWN0aW9uPjtcbiAgICBjb2xsZWN0aW9uIChuYW1lOiBzdHJpbmcpOiBDb2xsZWN0aW9uO1xufVxuXG5leHBvcnQgY2xhc3MgRGIgaW1wbGVtZW50cyBJRGIge1xuICAgIHByaXZhdGUgY29sbGVjdGlvblF1ZXVlOiBTZXQ8c3RyaW5nPiA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICAgIHByaXZhdGUgREJPcGVuUmVxdWVzdDogSURCT3BlbkRCUmVxdWVzdDtcblxuICAgIHN0YXRpYyBvcGVuIChuYW1lOiBzdHJpbmcsIGNvbGxlY3Rpb25zPzogc3RyaW5nW10pOiBQcm9taXNlPERiPiB7XG5cbiAgICAgICAgY29uc3QgREJPcGVuUmVxdWVzdCA9IHNlbGYuaW5kZXhlZERCLm9wZW4obmFtZSk7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPERiPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cbiAgICAgICAgICAgIC8vIHRoZXNlIHR3byBldmVudCBoYW5kbGVycyBhY3Qgb24gdGhlIGRhdGFiYXNlIGJlaW5nIG9wZW5lZFxuICAgICAgICAgICAgLy8gc3VjY2Vzc2Z1bGx5LCBvciBub3RcbiAgICAgICAgICAgIERCT3BlblJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCByZWplY3QpO1xuICAgICAgICAgICAgREJPcGVuUmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdzdWNjZXNzJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgLy8gc3RvcmUgdGhlIHJlc3VsdCBvZiBvcGVuaW5nIHRoZSBkYXRhYmFzZSBpbiB0aGUgZGJcbiAgICAgICAgICAgICAgICAvLyB2YXJpYWJsZS4gVGhpcyBpcyB1c2VkIGEgbG90IGxhdGVyIG9uLCBmb3Igb3BlbmluZ1xuICAgICAgICAgICAgICAgIC8vIHRyYW5zYWN0aW9ucyBhbmQgc3VjaGxpa2UuXG4gICAgICAgICAgICAgICAgbGV0IGRiID0gbmV3IERiKERCT3BlblJlcXVlc3QucmVzdWx0KTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKGRiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgREJPcGVuUmVxdWVzdC5vbmJsb2NrZWQgPSAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdibG9ja2VkJylcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvL1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3RvciAocHJpdmF0ZSBpZGI6IElEQkRhdGFiYXNlKSB7XG4gICAgfVxuXG4gICAgZ2V0IHZlcnNpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pZGIgPyB0aGlzLmlkYi52ZXJzaW9uIDogMDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBwYXJhbSBuYW1lXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSAgT3B0aW9uYWxcbiAgICAgKiBBbiBvcHRpb25zIG9iamVjdCB3aG9zZSBhdHRyaWJ1dGVzIGFyZSBvcHRpb25hbCBwYXJhbWV0ZXJzIHRvIHRoZSBtZXRob2QuIEl0IGluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczpcbiAgICAgKiB8IEF0dHJpYnV0ZSAgICAgICAgICB8IERlc2NyaXB0aW9uICAgICAgIHxcbiAgICAgKiB8IC0tLS0tLS0tLS0tLS0tLS0gfCAtLS0tLS0tLS0tLS0tLS0gICB8XG4gICAgICogfCBrZXlQYXRoICAgICAgICAgIHwgVGhlIGtleSBwYXRoIHRvIGJlIHVzZWQgYnkgdGhlIG5ldyBvYmplY3Qgc3RvcmUuIElmIGVtcHR5IG9yIG5vdCBzcGVjaWZpZWQsIHRoZSBvYmplY3Qgc3RvcmUgaXMgY3JlYXRlZCB3aXRob3V0IGEga2V5IHBhdGggYW5kIHVzZXMgb3V0LW9mLWxpbmUga2V5cy4gWW91IGNhbiBhbHNvIHBhc3MgaW4gYW4gYXJyYXkgYXMgYSBrZXlQYXRoLiB8XG4gICAgICogfCBhdXRvSW5jcmVtZW50ICAgIHwgSWYgdHJ1ZSwgdGhlIG9iamVjdCBzdG9yZSBoYXMgYSBrZXkgZ2VuZXJhdG9yLiBEZWZhdWx0cyB0byBmYWxzZS4gfFxuICAgICAqIFVua25vd24gcGFyYW1ldGVycyBhcmUgaWdub3JlZC5cbiAgICAgKi9cbiAgICBjcmVhdGVDb2xsZWN0aW9uIChuYW1lOiBzdHJpbmcsIG9wdGlvbnM6IElEQk9iamVjdFN0b3JlUGFyYW1ldGVycyA9IHthdXRvSW5jcmVtZW50IDogdHJ1ZX0pOiBQcm9taXNlPENvbGxlY3Rpb24+IHtcbiAgICAgICAgaWYgKHRoaXMuaWRiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMobmFtZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNvbGxlY3Rpb24gYWxyZWFkeSBleGlzdHNcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLmNvbGxlY3Rpb25RdWV1ZS5zaXplICYmICF0aGlzLkRCT3BlblJlcXVlc3QpIHtcbiAgICAgICAgICAgIGxldCB2ID0gdGhpcy52ZXJzaW9uICsgMTtcbiAgICAgICAgICAgIHRoaXMuaWRiLmNsb3NlKCk7XG4gICAgICAgICAgICB0aGlzLkRCT3BlblJlcXVlc3QgPSBzZWxmLmluZGV4ZWREQi5vcGVuKHRoaXMuaWRiLm5hbWUsIHYpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29sbGVjdGlvblF1ZXVlLmFkZChuYW1lKTtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPENvbGxlY3Rpb24+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIC8vIHRoZXNlIHR3byBldmVudCBoYW5kbGVycyBhY3Qgb24gdGhlIGRhdGFiYXNlIGJlaW5nIG9wZW5lZFxuICAgICAgICAgICAgLy8gc3VjY2Vzc2Z1bGx5LCBvciBub3RcbiAgICAgICAgICAgIHRoaXMuREJPcGVuUmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIHJlamVjdCk7XG5cbiAgICAgICAgICAgIHRoaXMuREJPcGVuUmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCd1cGdyYWRlbmVlZGVkJywgZSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGRiOiBJREJEYXRhYmFzZSA9IHRoaXMuREJPcGVuUmVxdWVzdC5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgdGhpcy5pZGIgPSBkYjtcbiAgICAgICAgICAgICAgICAvL1RoaXMgbWV0aG9kIGNhbiBiZSBjYWxsZWQgb25seSB3aXRoaW4gYSB2ZXJzaW9uY2hhbmdlIHRyYW5zYWN0aW9uLlxuICAgICAgICAgICAgICAgIGNvbnN0IHN0b3JlID0gZGIuY3JlYXRlT2JqZWN0U3RvcmUobmFtZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgICAgICAgICAvLyBVc2UgdHJhbnNhY3Rpb24gb25jb21wbGV0ZSB0byBtYWtlIHN1cmUgdGhlIG9iamVjdFN0b3JlIGNyZWF0aW9uIGlzXG4gICAgICAgICAgICAgICAgLy8gZmluaXNoZWQgYmVmb3JlIGFkZGluZyBkYXRhIGludG8gaXQuXG4gICAgICAgICAgICAgICAgbGV0IHRyYW5zYWN0aW9uID0gc3RvcmUudHJhbnNhY3Rpb247XG4gICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcignY29tcGxldGUnLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGNvbGxlY3Rpb24gPSBuZXcgQ29sbGVjdGlvbihzdG9yZSwgdGhpcy5pZGIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb25RdWV1ZS5kZWxldGUobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoY29sbGVjdGlvbik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5EQk9wZW5SZXF1ZXN0Lm9uc3VjY2VzcyA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5jb2xsZWN0aW9uUXVldWUuc2l6ZSAmJiB0aGlzLkRCT3BlblJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5EQk9wZW5SZXF1ZXN0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOb3QgYWxsIGNvbGxlY3Rpb25zIHdlcmUgY3JlYXRlZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjb2xsZWN0aW9uIChuYW1lOiBzdHJpbmcpOiBDb2xsZWN0aW9uIHtcbiAgICAgICAgY29uc3Qgc3RvcmUgPSB0aGlzLmlkYi50cmFuc2FjdGlvbihuYW1lKS5vYmplY3RTdG9yZShuYW1lKTtcbiAgICAgICAgcmV0dXJuIG5ldyBDb2xsZWN0aW9uKHN0b3JlLCB0aGlzLmlkYik7XG4gICAgfVxuXG4gICAgY2xvc2UgKCkge1xuICAgICAgICB0aGlzLmlkYi5jbG9zZSgpO1xuICAgIH1cblxufSIsImltcG9ydCB7Q3Vyc29yfSBmcm9tIFwiLi9DdXJzb3JcIjtcblxuZXhwb3J0IGludGVyZmFjZSBDb2xsZWN0aW9uQ3JlYXRlT3B0aW9ucyB7XG5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb2xsZWN0aW9uSW5zZXJ0T25lT3B0aW9ucyB7XG5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJbnNlcnRPbmVXcml0ZU9wUmVzdWx0IHtcbiAgICBpbnNlcnRlZENvdW50OiBudW1iZXI7XG4gICAgaW5zZXJ0ZWRJZDogYW55O1xufVxuXG5pbnRlcmZhY2UgSW5zZXJ0V3JpdGVPcFJlc3VsdCB7XG4gICAgaW5zZXJ0ZWRDb3VudDogbnVtYmVyO1xuICAgIGluc2VydGVkSWRzOiBhbnlbXTtcbn1cblxuLy9UT0RPOiBhZGQgc3VwcG9ydCBmb3Igb3BlcmF0b3JzIGxpa2UgJGVxXG5leHBvcnQgdHlwZSBGaWx0ZXJRdWVyeTxUPiA9IHtcbiAgICBbUCBpbiBrZXlvZiBUXT86IFRbUF0gfCB7XG4gICAgJGVxPzogVFtQXTtcbiAgICAkZ3Q/OiBUW1BdO1xuICAgICRndGU/OiBUW1BdO1xuICAgICRpbj86IFRbUF1bXTtcbiAgICAkbHQ/OiBUW1BdO1xuICAgICRsdGU/OiBUW1BdO1xuICAgICRuZT86IFRbUF07XG4gICAgJG5pbj86IFRbUF1bXTtcbiAgICAkYW5kPzogKEZpbHRlclF1ZXJ5PFRbUF0+IHwgVFtQXSlbXTtcbiAgICAkb3I/OiAoRmlsdGVyUXVlcnk8VFtQXT4gfCBUW1BdKVtdO1xuICAgICRub3Q/OiAoRmlsdGVyUXVlcnk8VFtQXT4gfCBUW1BdKVtdIHwgVFtQXTtcbiAgICAkZXhwcj86IGFueTtcbiAgICAkanNvblNjaGVtYT86IGFueTtcbiAgICAkbW9kPzogW251bWJlciwgbnVtYmVyXTtcbiAgICAkcmVnZXg/OiBSZWdFeHA7XG4gICAgJG9wdGlvbnM/OiBzdHJpbmc7XG4gICAgJHRleHQ/OiB7XG4gICAgICAgICRzZWFyY2g6IHN0cmluZztcbiAgICAgICAgJGxhbmd1YWdlPzogc3RyaW5nO1xuICAgICAgICAkY2FzZVNlbnNpdGl2ZT86IGJvb2xlYW47XG4gICAgICAgICRkaWFjcmF0aWNTZW5zaXRpdmU/OiBib29sZWFuO1xuICAgIH07XG4gICAgJHdoZXJlOiBPYmplY3Q7XG4gICAgJGdlb0ludGVyc2VjdHM/OiBPYmplY3Q7XG4gICAgJGdlb1dpdGhpbj86IE9iamVjdDtcbiAgICAkbmVhcj86IE9iamVjdDtcbiAgICAkbmVhclNwaGVyZT86IE9iamVjdDtcbiAgICAkZWxlbU1hdGNoPzogT2JqZWN0O1xuICAgICRzaXplPzogbnVtYmVyO1xuICAgICRiaXRzQWxsQ2xlYXI/OiBPYmplY3Q7XG4gICAgJGJpdHNBbGxTZXQ/OiBPYmplY3Q7XG4gICAgJGJpdHNBbnlDbGVhcj86IE9iamVjdDtcbiAgICAkYml0c0FueVNldD86IE9iamVjdDtcbiAgICBba2V5OiBzdHJpbmddOiBhbnk7XG59O1xufSB8IHsgW2tleTogc3RyaW5nXTogYW55IH07XG5cbmludGVyZmFjZSBDb21tb25PcHRpb25zIHtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBEZWxldGVXcml0ZU9wUmVzdWx0T2JqZWN0IHtcbiAgICAvL1RoZSByYXcgcmVzdWx0IHJldHVybmVkIGZyb20gTW9uZ29EQiwgZmllbGQgd2lsbCB2YXJ5IGRlcGVuZGluZyBvbiBzZXJ2ZXIgdmVyc2lvbi5cbiAgICByZXN1bHQ6IHtcbiAgICAgICAgLy9JcyAxIGlmIHRoZSBjb21tYW5kIGV4ZWN1dGVkIGNvcnJlY3RseS5cbiAgICAgICAgb2s/OiBudW1iZXI7XG4gICAgICAgIC8vVGhlIHRvdGFsIGNvdW50IG9mIGRvY3VtZW50cyBkZWxldGVkLlxuICAgICAgICBuPzogbnVtYmVyO1xuICAgIH1cbiAgICAvL1RoZSBudW1iZXIgb2YgZG9jdW1lbnRzIGRlbGV0ZWQuXG4gICAgZGVsZXRlZENvdW50PzogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgQ29sbGVjdGlvbiB7XG4gICAgY29uc3RydWN0b3IgKHByaXZhdGUgc3RvcmU6IElEQk9iamVjdFN0b3JlLCBwcml2YXRlIGlkYjogSURCRGF0YWJhc2UpIHtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3NcbiAgICAgKiBAcGFyYW0gb3B0aW9uc1xuICAgICAqL1xuICAgIGluc2VydE9uZSAoZG9jczogT2JqZWN0LCBvcHRpb25zPzogQ29sbGVjdGlvbkluc2VydE9uZU9wdGlvbnMpOiBQcm9taXNlPEluc2VydE9uZVdyaXRlT3BSZXN1bHQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0TWFueShbZG9jc10sIG9wdGlvbnMpLnRoZW4ocmVzID0+ICh7aW5zZXJ0ZWRDb3VudCA6IDEsIGluc2VydGVkSWQgOiByZXMuaW5zZXJ0ZWRJZHNbMF19KSk7XG4gICAgfVxuXG4gICAgaW5zZXJ0TWFueSAoZG9jczogT2JqZWN0W10sIG9wdGlvbnM/OiBDb2xsZWN0aW9uSW5zZXJ0T25lT3B0aW9ucyk6IFByb21pc2U8SW5zZXJ0V3JpdGVPcFJlc3VsdD4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8SW5zZXJ0V3JpdGVPcFJlc3VsdD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IGluc2VydGVkSWRzOiBhbnlbXSA9IFtdO1xuICAgICAgICAgICAgbGV0IHRyYW5zYWN0aW9uID0gdGhpcy5pZGIudHJhbnNhY3Rpb24odGhpcy5zdG9yZS5uYW1lLCBcInJlYWR3cml0ZVwiKTtcblxuICAgICAgICAgICAgLy8gVG8gZGV0ZXJtaW5lIGlmIHRoZSBhZGQgb3BlcmF0aW9uIGhhcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LFxuICAgICAgICAgICAgLy8gbGlzdGVuIGZvciB0aGUgdHJhbnNhY3Rpb27igJlzIGNvbXBsZXRlIGV2ZW50IGluIGFkZGl0aW9uIHRvIHRoZVxuICAgICAgICAgICAgLy8gSURCT2JqZWN0U3RvcmUuYWRkIHJlcXVlc3TigJlzIHN1Y2Nlc3MgZXZlbnQsXG4gICAgICAgICAgICAvLyBiZWNhdXNlIHRoZSB0cmFuc2FjdGlvbiBtYXkgc3RpbGwgZmFpbCBhZnRlciB0aGUgc3VjY2VzcyBldmVudCBmaXJlcy5cbiAgICAgICAgICAgIHRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSBlID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaW5zZXJ0ZWRJZHMubGVuZ3RoID09PSBkb2NzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHtpbnNlcnRlZENvdW50IDogaW5zZXJ0ZWRJZHMubGVuZ3RoLCBpbnNlcnRlZElkc30pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIk5vIHN1Y2Nlc3NcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uLm9uZXJyb3IgPSByZWplY3Q7XG5cbiAgICAgICAgICAgIGNvbnN0IG9iamVjdFN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUodGhpcy5zdG9yZS5uYW1lKTtcblxuICAgICAgICAgICAgZm9yIChjb25zdCBkb2Mgb2YgZG9jcykge1xuICAgICAgICAgICAgICAgIC8vIE1ha2UgYSByZXF1ZXN0IHRvIGFkZCBkb2NzIG9iamVjdCB0byB0aGUgb2JqZWN0IHN0b3JlXG4gICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0U3RvcmVSZXF1ZXN0ID0gb2JqZWN0U3RvcmUuYWRkKGRvYyk7XG5cbiAgICAgICAgICAgICAgICBvYmplY3RTdG9yZVJlcXVlc3Qub25lcnJvciA9IHJlamVjdDtcbiAgICAgICAgICAgICAgICBvYmplY3RTdG9yZVJlcXVlc3Qub25zdWNjZXNzID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSByZXN1bHQgb2YgYSByZXF1ZXN0IGdlbmVyYXRlZCBmcm9tIGEgY2FsbCB0byBhZGQoKVxuICAgICAgICAgICAgICAgICAgICAvLyBpcyB0aGUga2V5IG9mIHRoZSB2YWx1ZSB0aGF0IHdhcyBhZGRlZC5cbiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0ZWRJZHMucHVzaChvYmplY3RTdG9yZVJlcXVlc3QucmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBwYXJhbSBxdWVyeVtvcHRpb25hbF1cbiAgICAgKiBUaGUgZmluZCgpIG1ldGhvZCB3aXRoIG5vIHBhcmFtZXRlcnMgcmV0dXJucyBhbGwgZG9jdW1lbnRzIGZyb20gYSBjb2xsZWN0aW9uIGFuZCByZXR1cm5zIGFsbCBmaWVsZHMgZm9yIHRoZSBkb2N1bWVudHMuXG4gICAgICovXG4gICAgZmluZDxUPiAocXVlcnk/OiBGaWx0ZXJRdWVyeTxUPik6IEN1cnNvcjxUPiB7XG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gdGhpcy5pZGIudHJhbnNhY3Rpb24odGhpcy5zdG9yZS5uYW1lKTtcbiAgICAgICAgY29uc3Qgb2JqZWN0U3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZSh0aGlzLnN0b3JlLm5hbWUpO1xuICAgICAgICAvL1RPRE86IHByb2Nlc3MgdGhlIHF1ZXJ5XG4gICAgICAgIC8vIFRoZSBnZXRBbGwoKSBtZXRob2Qgb2YgdGhlIElEQk9iamVjdFN0b3JlIGludGVyZmFjZSByZXR1cm5zIGFuIElEQlJlcXVlc3Qgb2JqZWN0XG4gICAgICAgIC8vIGNvbnRhaW5pbmcgYWxsIG9iamVjdHMgaW4gdGhlIG9iamVjdCBzdG9yZSBtYXRjaGluZyB0aGUgc3BlY2lmaWVkIHBhcmFtZXRlciBvclxuICAgICAgICAvLyBhbGwgb2JqZWN0cyBpbiB0aGUgc3RvcmUgaWYgbm8gcGFyYW1ldGVycyBhcmUgZ2l2ZW4uXG4gICAgICAgIGxldCByZXF1ZXN0OiBhbnk7XG4gICAgICAgIGlmICghcXVlcnkpIHtcbiAgICAgICAgICAgIHJlcXVlc3QgPSBvYmplY3RTdG9yZS5nZXRBbGwoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlcXVlc3QgPSBvYmplY3RTdG9yZS5vcGVuQ3Vyc29yKCkgYXMgSURCUmVxdWVzdDxJREJDdXJzb3JXaXRoVmFsdWUgfCBudWxsPjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IEN1cnNvcihyZXF1ZXN0LCBxdWVyeSk7XG4gICAgfVxuXG4gICAgLy8gZGVsZXRlTWFueTxUPiAoZmlsdGVyOiBGaWx0ZXJRdWVyeTxUPiwgb3B0aW9ucz86IENvbW1vbk9wdGlvbnMpOiBQcm9taXNlPERlbGV0ZVdyaXRlT3BSZXN1bHRPYmplY3Q+IHtcbiAgICAvL1xuICAgIC8vIH1cbiAgICAvL1xuICAgIC8vIGN1cnNvcjxUPiAoKTogQ3Vyc29yPFQ+IHtcbiAgICAvLyAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSB0aGlzLmlkYi50cmFuc2FjdGlvbih0aGlzLnN0b3JlLm5hbWUsIFwicmVhZG9ubHlcIik7XG4gICAgLy8gICAgIGNvbnN0IG9iamVjdFN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUodGhpcy5zdG9yZS5uYW1lKTtcbiAgICAvLyAgICAgY29uc3QgcmVxdWVzdDogSURCUmVxdWVzdDxJREJDdXJzb3JXaXRoVmFsdWUgfCBudWxsPiA9IG9iamVjdFN0b3JlLm9wZW5DdXJzb3IoKTtcbiAgICAvL1xuICAgIC8vIH1cbn0iLCJpbXBvcnQge0ZpbHRlclF1ZXJ5fSBmcm9tIFwiLi9Db2xsZWN0aW9uXCI7XG5cbmV4cG9ydCBlbnVtIEN1cnNvck9wZXJhdGlvbiB7XG4gICAgREVMRVRFLCBVUERBVEUsIFJFQURcbn1cblxuLy9bUCBpbiBrZXlvZiBUXT86IFRbUF1cbmV4cG9ydCBjbGFzcyBDdXJzb3I8VCBleHRlbmRzIHsgW2tleTogc3RyaW5nXTogYW55IH0+IHtcbiAgICBwcml2YXRlIHJlc3VsdDogUHJvbWlzZTxhbnk+O1xuICAgIHByaXZhdGUgX3Jlc3VsdDogVFtdO1xuXG4gICAgY29uc3RydWN0b3IgKHByaXZhdGUgcmVxdWVzdDogSURCUmVxdWVzdCwgZmlsdGVyPzogRmlsdGVyUXVlcnk8VD4sIG9wZXJhdGlvbjogQ3Vyc29yT3BlcmF0aW9uID0gQ3Vyc29yT3BlcmF0aW9uLlJFQUQpIHtcbiAgICAgICAgdGhpcy5yZXN1bHQgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cbiAgICAgICAgICAgIHRoaXMucmVxdWVzdC5vbmVycm9yID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KHRoaXMucmVxdWVzdC5lcnJvcik7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5yZXF1ZXN0Lm9uc3VjY2VzcyA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIERvIHNvbWV0aGluZyB3aXRoIHRoZSByZXF1ZXN0LnJlc3VsdCFcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJzb3IgPSByZXF1ZXN0LnJlc3VsdDtcbiAgICAgICAgICAgICAgICBpZiAoY3Vyc29yICYmIGN1cnNvciBpbnN0YW5jZW9mIElEQkN1cnNvcldpdGhWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXN1bHQgPSB0aGlzLl9yZXN1bHQgfHwgW107XG4gICAgICAgICAgICAgICAgICAgIC8vIGN1cnNvci52YWx1ZSBjb250YWlucyB0aGUgY3VycmVudCByZWNvcmQgYmVpbmcgaXRlcmF0ZWQgdGhyb3VnaFxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIHdoZXJlIHlvdSdkIGRvIHNvbWV0aGluZyB3aXRoIHRoZSByZXN1bHRcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leGVjdXRlQ3Vyc29yT3BlcmF0aW9uKG9wZXJhdGlvbiwgY3Vyc29yLCBmaWx0ZXIpO1xuICAgICAgICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc3VsdCA9IHRoaXMuX3Jlc3VsdCB8fCB0aGlzLnJlcXVlc3QucmVzdWx0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNvbHZlKHRoaXMuX3Jlc3VsdCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIH0pO1xuXG5cbiAgICB9XG5cbiAgICBwcml2YXRlIGFwcGx5RmlsdGVyICh2YWx1ZTogVCwgZmlsdGVyOiBGaWx0ZXJRdWVyeTxUPikge1xuICAgICAgICBsZXQgZmlsdGVyS2V5cyA9IE9iamVjdC5rZXlzKGZpbHRlcik7XG5cbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgZmlsdGVyS2V5cykge1xuICAgICAgICAgICAgaWYgKGtleS5zdGFydHNXaXRoKCckJykpIHtcbiAgICAgICAgICAgICAgICAvL1RPRE86IG9wZXJhdG9yc1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2YWx1ZVtrZXldICE9IGZpbHRlcltrZXldKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgZXhlY3V0ZUN1cnNvck9wZXJhdGlvbiAob3BlcmF0aW9uOiBDdXJzb3JPcGVyYXRpb24sIGN1cnNvcjogSURCQ3Vyc29yV2l0aFZhbHVlLCBmaWx0ZXI/OiBGaWx0ZXJRdWVyeTxUPikge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGZpbHRlciA/IHRoaXMuYXBwbHlGaWx0ZXIoY3Vyc29yLnZhbHVlLCBmaWx0ZXIpIDogY3Vyc29yLnZhbHVlO1xuICAgICAgICBpZiAoIXZhbHVlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoIChvcGVyYXRpb24pIHtcbiAgICAgICAgICAgIGNhc2UgQ3Vyc29yT3BlcmF0aW9uLkRFTEVURTpcbiAgICAgICAgICAgICAgICBjdXJzb3IuZGVsZXRlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEN1cnNvck9wZXJhdGlvbi5VUERBVEU6XG4gICAgICAgICAgICAgICAgLy9UT0RPOiBVcGRhdGVcbiAgICAgICAgICAgICAgICAvLyA/Pz8gY3Vyc29yLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aGlzLl9yZXN1bHQucHVzaCh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbi8vIHNvcnRWYWx1ZTogc3RyaW5nO1xuICAgIC8vIHRpbWVvdXQ6IGJvb2xlYW47XG4gICAgLy8gcmVhZFByZWZlcmVuY2U6IFJlYWRQcmVmZXJlbmNlO1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2FkZEN1cnNvckZsYWcgKi9cbiAgICAvLyBhZGRDdXJzb3JGbGFnKGZsYWc6IHN0cmluZywgdmFsdWU6IGJvb2xlYW4pOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjYWRkUXVlcnlNb2RpZmllciAqL1xuICAgIC8vIGFkZFF1ZXJ5TW9kaWZpZXIobmFtZTogc3RyaW5nLCB2YWx1ZTogYm9vbGVhbik6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNiYXRjaFNpemUgKi9cbiAgICAvLyBiYXRjaFNpemUodmFsdWU6IG51bWJlcik6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNjbG9uZSAqL1xuICAgIC8vIGNsb25lKCk6IEN1cnNvcjxUPjsgLy8gc3RpbGwgcmV0dXJucyB0aGUgc2FtZSB0eXBlXG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjY2xvc2UgKi9cbiAgICAvLyBjbG9zZSgpOiBQcm9taXNlPEN1cnNvclJlc3VsdD47XG4gICAgLy8gY2xvc2UoY2FsbGJhY2s6IE1vbmdvQ2FsbGJhY2s8Q3Vyc29yUmVzdWx0Pik6IHZvaWQ7XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjY29sbGF0aW9uICovXG4gICAgLy8gY29sbGF0aW9uKHZhbHVlOiBPYmplY3QpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjY29tbWVudCAqL1xuICAgIC8vIGNvbW1lbnQodmFsdWU6IHN0cmluZyk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNjb3VudCAqL1xuICAgIC8vIGNvdW50KGNhbGxiYWNrOiBNb25nb0NhbGxiYWNrPG51bWJlcj4pOiB2b2lkO1xuICAgIC8vIGNvdW50KGFwcGx5U2tpcExpbWl0OiBib29sZWFuLCBjYWxsYmFjazogTW9uZ29DYWxsYmFjazxudW1iZXI+KTogdm9pZDtcbiAgICAvLyBjb3VudChvcHRpb25zOiBDdXJzb3JDb21tZW50T3B0aW9ucywgY2FsbGJhY2s6IE1vbmdvQ2FsbGJhY2s8bnVtYmVyPik6IHZvaWQ7XG4gICAgLy8gY291bnQoYXBwbHlTa2lwTGltaXQ6IGJvb2xlYW4sIG9wdGlvbnM6IEN1cnNvckNvbW1lbnRPcHRpb25zLCBjYWxsYmFjazogTW9uZ29DYWxsYmFjazxudW1iZXI+KTogdm9pZDtcbiAgICAvLyBjb3VudChhcHBseVNraXBMaW1pdD86IGJvb2xlYW4sIG9wdGlvbnM/OiBDdXJzb3JDb21tZW50T3B0aW9ucyk6IFByb21pc2U8bnVtYmVyPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNleHBsYWluICovXG4gICAgLy8gZXhwbGFpbigpOiBQcm9taXNlPEN1cnNvclJlc3VsdD47XG4gICAgLy8gZXhwbGFpbihjYWxsYmFjazogTW9uZ29DYWxsYmFjazxDdXJzb3JSZXN1bHQ+KTogdm9pZDtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNmaWx0ZXIgKi9cbiAgICAvLyBmaWx0ZXIoZmlsdGVyOiBPYmplY3QpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjZm9yRWFjaCAqL1xuICAgIC8vIGZvckVhY2goaXRlcmF0b3I6IEl0ZXJhdG9yQ2FsbGJhY2s8VD4sIGNhbGxiYWNrOiBFbmRDYWxsYmFjayk6IHZvaWQ7XG4gICAgLy8gZm9yRWFjaChpdGVyYXRvcjogSXRlcmF0b3JDYWxsYmFjazxUPik6IFByb21pc2U8dm9pZD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjaGFzTmV4dCAqL1xuICAgIC8vIGhhc05leHQoKTogUHJvbWlzZTxib29sZWFuPjtcbiAgICAvLyBoYXNOZXh0KGNhbGxiYWNrOiBNb25nb0NhbGxiYWNrPGJvb2xlYW4+KTogdm9pZDtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNoaW50ICovXG4gICAgLy8gaGludChoaW50OiBPYmplY3QpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjaXNDbG9zZWQgKi9cbiAgICAvLyBpc0Nsb3NlZCgpOiBib29sZWFuO1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2xpbWl0ICovXG4gICAgLy8gbGltaXQodmFsdWU6IG51bWJlcik6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNtYXAgKi9cbiAgICAvLyBtYXA8VT4odHJhbnNmb3JtOiAoZG9jdW1lbnQ6IFQpID0+IFUpOiBDdXJzb3I8VT47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjbWF4ICovXG4gICAgLy8gbWF4KG1heDogbnVtYmVyKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI21heEF3YWl0VGltZU1TICovXG4gICAgLy8gbWF4QXdhaXRUaW1lTVModmFsdWU6IG51bWJlcik6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNtYXhTY2FuICovXG4gICAgLy8gbWF4U2NhbihtYXhTY2FuOiBPYmplY3QpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjbWF4VGltZU1TICovXG4gICAgLy8gbWF4VGltZU1TKHZhbHVlOiBudW1iZXIpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjbWluICovXG4gICAgLy8gbWluKG1pbjogbnVtYmVyKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI25leHQgKi9cbiAgICAvLyBuZXh0KCk6IFByb21pc2U8VCB8IG51bGw+O1xuICAgIC8vIG5leHQoY2FsbGJhY2s6IE1vbmdvQ2FsbGJhY2s8VCB8IG51bGw+KTogdm9pZDtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNwcm9qZWN0ICovXG4gICAgLy8gcHJvamVjdCh2YWx1ZTogT2JqZWN0KTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI3JlYWQgKi9cbiAgICAvLyByZWFkKHNpemU6IG51bWJlcik6IHN0cmluZyB8IEJ1ZmZlciB8IHZvaWQ7XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjbmV4dCAqL1xuICAgIC8vIHJldHVybktleShyZXR1cm5LZXk6IE9iamVjdCk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNyZXdpbmQgKi9cbiAgICAvLyByZXdpbmQoKTogdm9pZDtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNzZXRDdXJzb3JPcHRpb24gKi9cbiAgICAvLyBzZXRDdXJzb3JPcHRpb24oZmllbGQ6IHN0cmluZywgdmFsdWU6IE9iamVjdCk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNzZXRSZWFkUHJlZmVyZW5jZSAqL1xuICAgIC8vIHNldFJlYWRQcmVmZXJlbmNlKHJlYWRQcmVmZXJlbmNlOiBzdHJpbmcgfCBSZWFkUHJlZmVyZW5jZSk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNzaG93UmVjb3JkSWQgKi9cbiAgICAvLyBzaG93UmVjb3JkSWQoc2hvd1JlY29yZElkOiBPYmplY3QpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjc2tpcCAqL1xuICAgIC8vIHNraXAodmFsdWU6IG51bWJlcik6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNzbmFwc2hvdCAqL1xuICAgIC8vIHNuYXBzaG90KHNuYXBzaG90OiBPYmplY3QpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjc29ydCAqL1xuICAgIC8vIHNvcnQoa2V5T3JMaXN0OiBzdHJpbmcgfCBPYmplY3RbXSB8IE9iamVjdCwgZGlyZWN0aW9uPzogbnVtYmVyKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI3N0cmVhbSAqL1xuICAgIC8vIHN0cmVhbShvcHRpb25zPzogeyB0cmFuc2Zvcm0/OiBGdW5jdGlvbiB9KTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI3RvQXJyYXkgKi9cbiAgICB0b0FycmF5ICgpOiBQcm9taXNlPFRbXT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHQudGhlbihyZXN1bHQgPT4gQXJyYXkuZnJvbShyZXN1bHQpIGFzIFRbXSk7XG4gICAgfVxuXG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjdW5zaGlmdCAqL1xuICAgIC8vIHVuc2hpZnQoc3RyZWFtOiBCdWZmZXIgfCBzdHJpbmcpOiB2b2lkO1xuXG59Il0sInNvdXJjZVJvb3QiOiIifQ==