!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1);document.getElementById("output").innerHTML="",o.IndexedClient.connect("example").then(function(e){const t=e.db;if(document.getElementById("output").innerHTML+=`<p>DB version: ${t.version}</p>`,1==t.version)Promise.all([t.createCollection("a_simple_collection").then(function(e){e.insertOne({a:1}).then(function(e){console.log("a_simple_collection",e),document.getElementById("output").innerHTML+=`<p>a_simple_collection: ${JSON.stringify(e)}</p>`})}),t.createCollection("another_collection").then(function(e){e.insertMany([{b:2},{c:3},{d:4}]).then(function(e){console.log("another_collection",e),document.getElementById("output").innerHTML+=`<p>another_collection: ${JSON.stringify(e)}</p>`})})]).then(n=>{t.collection("another_collection").find().toArray().then(t=>{console.log(t),document.getElementById("output").innerHTML+=`<p>another_collection find all: ${JSON.stringify(t)}</p>`,e.close()})});else{t.collection("another_collection").find().toArray().then(t=>{console.log(t),document.getElementById("output").innerHTML+=`<p>another_collection find all: ${JSON.stringify(t)}</p>`,e.close()})}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2);t.IndexedClient=class e{constructor(e){}close(e){return Promise.resolve(this.db.close())}static connect(t,n){const r=new e(t);return o.Db.open(t).then(e=>(r.db=e,r))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(3);class r{constructor(e){this.idb=e,this.collectionQueue=new Set}static open(e,t){const n=self.indexedDB.open(e);return new Promise((e,t)=>{n.addEventListener("error",t),n.addEventListener("success",function(t){let o=new r(n.result);e(o)}),n.onblocked=(e=>{console.log("blocked")})})}get version(){return this.idb?this.idb.version:0}createCollection(e,t={autoIncrement:!0}){if(this.idb.objectStoreNames.contains(e))throw new Error("Collection already exists");if(!this.collectionQueue.size&&!this.DBOpenRequest){let e=this.version+1;this.idb.close(),this.DBOpenRequest=self.indexedDB.open(this.idb.name,e)}return this.collectionQueue.add(e),new Promise((n,r)=>{this.DBOpenRequest.addEventListener("error",r),this.DBOpenRequest.addEventListener("upgradeneeded",r=>{let s=this.DBOpenRequest.result;this.idb=s;const i=s.createObjectStore(e,t);i.transaction.addEventListener("complete",t=>{let r=new o.Collection(i,this.idb);this.collectionQueue.delete(e),n(r)})}),this.DBOpenRequest.onsuccess=(e=>{if(this.collectionQueue.size||!this.DBOpenRequest)throw new Error("Not all collections were created");this.DBOpenRequest=null})})}collection(e){const t=this.idb.transaction(e).objectStore(e);return new o.Collection(t,this.idb)}close(){this.idb.close()}}t.Db=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(4);t.Collection=class{constructor(e,t){this.store=e,this.idb=t}insertOne(e,t){return this.insertMany([e],t).then(e=>({insertedCount:1,insertedId:e.insertedIds[0]}))}insertMany(e,t){return new Promise((t,n)=>{let o=[],r=this.idb.transaction(this.store.name,"readwrite");r.oncomplete=(r=>{o.length===e.length?t({insertedCount:o.length,insertedIds:o}):n("No success")}),r.onerror=n;const s=r.objectStore(this.store.name);for(const t of e){const e=s.add(t);e.onerror=n,e.onsuccess=(t=>{o.push(e.result)})}})}find(e){const t=this.idb.transaction(this.store.name).objectStore(this.store.name).getAll();return new o.Cursor(t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Cursor=class{constructor(e){this.request=e}toArray(){return new Promise((e,t)=>{this.request.onerror=t,this.request.onsuccess=(t=>{e(this.request.result)})})}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2V4YW1wbGUvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL0luZGV4ZWRDbGllbnQudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL0RiLnRzIiwid2VicGFjazovLy8uL3NyYy9Db2xsZWN0aW9uLnRzIiwid2VicGFjazovLy8uL3NyYy9DdXJzb3IudHMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJJbmRleGVkQ2xpZW50XzEiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaW5uZXJIVE1MIiwiSW5kZXhlZENsaWVudCIsImNvbm5lY3QiLCJ0aGVuIiwiY2xpZW50IiwiZGIiLCJ2ZXJzaW9uIiwiUHJvbWlzZSIsImFsbCIsImNyZWF0ZUNvbGxlY3Rpb24iLCJjb2xsZWN0aW9uIiwiaW5zZXJ0T25lIiwiYSIsImNvbnNvbGUiLCJsb2ciLCJKU09OIiwic3RyaW5naWZ5IiwiaW5zZXJ0TWFueSIsImIiLCJyZXMiLCJmaW5kIiwidG9BcnJheSIsInZhbHVlcyIsImNsb3NlIiwiRGJfMSIsIltvYmplY3QgT2JqZWN0XSIsImRibmFtZSIsImZvcmNlIiwicmVzb2x2ZSIsInRoaXMiLCJvcHRpb25zIiwiRGIiLCJvcGVuIiwiQ29sbGVjdGlvbl8xIiwiaWRiIiwiY29sbGVjdGlvblF1ZXVlIiwiU2V0IiwiY29sbGVjdGlvbnMiLCJEQk9wZW5SZXF1ZXN0Iiwic2VsZiIsImluZGV4ZWREQiIsInJlamVjdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInJlc3VsdCIsIm9uYmxvY2tlZCIsImUiLCJhdXRvSW5jcmVtZW50Iiwib2JqZWN0U3RvcmVOYW1lcyIsImNvbnRhaW5zIiwiRXJyb3IiLCJzaXplIiwidiIsImFkZCIsInN0b3JlIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJ0cmFuc2FjdGlvbiIsIkNvbGxlY3Rpb24iLCJkZWxldGUiLCJvbnN1Y2Nlc3MiLCJvYmplY3RTdG9yZSIsIkN1cnNvcl8xIiwiZG9jcyIsImluc2VydGVkQ291bnQiLCJpbnNlcnRlZElkIiwiaW5zZXJ0ZWRJZHMiLCJvbmNvbXBsZXRlIiwibGVuZ3RoIiwib25lcnJvciIsImRvYyIsIm9iamVjdFN0b3JlUmVxdWVzdCIsInB1c2giLCJxdWVyeSIsInJlcXVlc3QiLCJnZXRBbGwiLCJDdXJzb3IiXSwibWFwcGluZ3MiOiJhQUNBLElBQUFBLEtBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsSUFDQUcsRUFBQUgsRUFDQUksR0FBQSxFQUNBSCxZQVVBLE9BTkFJLEVBQUFMLEdBQUFNLEtBQUFKLEVBQUFELFFBQUFDLElBQUFELFFBQUFGLEdBR0FHLEVBQUFFLEdBQUEsRUFHQUYsRUFBQUQsUUFLQUYsRUFBQVEsRUFBQUYsRUFHQU4sRUFBQVMsRUFBQVYsRUFHQUMsRUFBQVUsRUFBQSxTQUFBUixFQUFBUyxFQUFBQyxHQUNBWixFQUFBYSxFQUFBWCxFQUFBUyxJQUNBRyxPQUFBQyxlQUFBYixFQUFBUyxHQUEwQ0ssWUFBQSxFQUFBQyxJQUFBTCxLQUsxQ1osRUFBQWtCLEVBQUEsU0FBQWhCLEdBQ0Esb0JBQUFpQixlQUFBQyxhQUNBTixPQUFBQyxlQUFBYixFQUFB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QUFJc0IsWUFBWTNCLEtBQUt5QixNQUFNbEYsTUFDcEJ3RixZQUFZL0IsS0FBS3lCLE1BQU1sRixNQUszQnNHLFNBQzVCLE9BQU8sSUFBSWIsRUFBQWMsT0FBT0Ysb0ZDeEgxQjlHLEVBQUFnSCxhQUNJbEQsWUFBcUJnRCxHQUFBNUMsS0FBQTRDLFVBbUZyQmhELFVBQ0ksT0FBTyxJQUFJbEIsUUFBYSxDQUFDcUIsRUFBU2EsS0FDOUJaLEtBQUs0QyxRQUFRTCxRQUFVM0IsRUFDdkJaLEtBQUs0QyxRQUFRZCxVQUFZLENBQUNoQixJQUV0QmYsRUFBUUMsS0FBSzRDLFFBQVE3QiIsImZpbGUiOiJleGFtcGxlL2J1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImltcG9ydCB7SW5kZXhlZENsaWVudH0gZnJvbSBcIi4uL0luZGV4ZWRDbGllbnRcIjtcbmltcG9ydCB7RGJ9IGZyb20gXCIuLi9EYlwiO1xuLypcbi8vIENvbm5lY3QgdXNpbmcgTW9uZ29DbGllbnRcbk1vbmdvQ2xpZW50LmNvbm5lY3QodXJsLCBmdW5jdGlvbihlcnIsIGNsaWVudCkge1xuICAvLyBDcmVhdGUgYSBjb2xsZWN0aW9uIHdlIHdhbnQgdG8gZHJvcCBsYXRlclxuICBjb25zdCBjb2wgPSBjbGllbnQuZGIoZGJOYW1lKS5jb2xsZWN0aW9uKCdjcmVhdGVJbmRleEV4YW1wbGUxJyk7XG4gIC8vIFNob3cgdGhhdCBkdXBsaWNhdGUgcmVjb3JkcyBnb3QgZHJvcHBlZFxuICBjb2wuZmluZCh7fSkudG9BcnJheShmdW5jdGlvbihlcnIsIGl0ZW1zKSB7XG4gICAgdGVzdC5lcXVhbChudWxsLCBlcnIpO1xuICAgIHRlc3QuZXF1YWwoNCwgaXRlbXMubGVuZ3RoKTtcbiAgICBjbGllbnQuY2xvc2UoKTtcbiAgfSk7XG59KTtcbiogKi9cbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3V0cHV0XCIpLmlubmVySFRNTCA9IFwiXCI7XG5JbmRleGVkQ2xpZW50LmNvbm5lY3QoXCJleGFtcGxlXCIpLnRoZW4oZnVuY3Rpb24gKGNsaWVudCkge1xuICAgIGNvbnN0IGRiID0gY2xpZW50LmRiIGFzIERiO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3V0cHV0XCIpLmlubmVySFRNTCArPSBgPHA+REIgdmVyc2lvbjogJHtkYi52ZXJzaW9ufTwvcD5gO1xuICAgIGlmIChkYi52ZXJzaW9uID09IDEpIHtcbiAgICAgICAgLy8gQ3JlYXRlIGEgY29sbGVjdGlvblxuICAgICAgICBQcm9taXNlLmFsbChbXG4gICAgICAgICAgICBkYi5jcmVhdGVDb2xsZWN0aW9uKFwiYV9zaW1wbGVfY29sbGVjdGlvblwiKS50aGVuKGZ1bmN0aW9uIChjb2xsZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgLy8gSW5zZXJ0IGEgZG9jdW1lbnQgaW4gdGhlIGNvbGxlY3Rpb25cbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uLmluc2VydE9uZSh7YSA6IDF9KS50aGVuKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEZpbmlzaCB1cCB0ZXN0XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiYV9zaW1wbGVfY29sbGVjdGlvblwiLCByKTtcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvdXRwdXRcIikuaW5uZXJIVE1MICs9IGA8cD5hX3NpbXBsZV9jb2xsZWN0aW9uOiAke0pTT04uc3RyaW5naWZ5KHIpfTwvcD5gO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBkYi5jcmVhdGVDb2xsZWN0aW9uKFwiYW5vdGhlcl9jb2xsZWN0aW9uXCIpLnRoZW4oZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAvLyBJbnNlcnQgYSBkb2N1bWVudCBpbiB0aGUgY29sbGVjdGlvblxuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb24uaW5zZXJ0TWFueShbe2IgOiAyfSwge2MgOiAzfSwge2QgOiA0fV0pLnRoZW4oZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRmluaXNoIHVwIHRlc3RcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJhbm90aGVyX2NvbGxlY3Rpb25cIiwgcik7XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3V0cHV0XCIpLmlubmVySFRNTCArPSBgPHA+YW5vdGhlcl9jb2xsZWN0aW9uOiAke0pTT04uc3RyaW5naWZ5KHIpfTwvcD5gO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSldKS50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICBjb25zdCBjID0gZGIuY29sbGVjdGlvbihcImFub3RoZXJfY29sbGVjdGlvblwiKTtcbiAgICAgICAgICAgIGMuZmluZCgpLnRvQXJyYXkoKS50aGVuKHZhbHVlcyA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codmFsdWVzKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm91dHB1dFwiKS5pbm5lckhUTUwgKz0gYDxwPmFub3RoZXJfY29sbGVjdGlvbiBmaW5kIGFsbDogJHtKU09OLnN0cmluZ2lmeSh2YWx1ZXMpfTwvcD5gO1xuICAgICAgICAgICAgICAgIGNsaWVudC5jbG9zZSgpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgYyA9IGRiLmNvbGxlY3Rpb24oXCJhbm90aGVyX2NvbGxlY3Rpb25cIik7XG4gICAgICAgIGMuZmluZCgpLnRvQXJyYXkoKS50aGVuKHZhbHVlcyA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh2YWx1ZXMpO1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvdXRwdXRcIikuaW5uZXJIVE1MICs9IGA8cD5hbm90aGVyX2NvbGxlY3Rpb24gZmluZCBhbGw6ICR7SlNPTi5zdHJpbmdpZnkodmFsdWVzKX08L3A+YDtcbiAgICAgICAgICAgIGNsaWVudC5jbG9zZSgpO1xuICAgICAgICB9KVxuICAgIH1cbn0pOyIsImltcG9ydCB7RGIsIElEYn0gZnJvbSBcIi4vRGJcIjtcblxuZXhwb3J0IGludGVyZmFjZSBJbmRleGVkQ2xpZW50T3B0aW9ucyB7XG4gICAgY29sbGVjdGlvbnM/OiBzdHJpbmdbXVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEluZGV4ZWRNb25nb0NsaWVudE9wdGlvbnMge1xuXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW5kZXhlZE1vbmdvQ2xpZW50U3RhdGljIHtcbiAgICAvL3N0YXRpYyBjb25uZWN0KHVyaTogc3RyaW5nLCBvcHRpb25zPzogTW9uZ29DbGllbnRPcHRpb25zKTogUHJvbWlzZTxNb25nb0NsaWVudD47XG4gICAgY29ubmVjdCAodXJpOiBzdHJpbmcsIG9wdGlvbnM/OiBJbmRleGVkTW9uZ29DbGllbnRPcHRpb25zKTogUHJvbWlzZTxJbmRleGVkTW9uZ29DbGllbnQ+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW5kZXhlZE1vbmdvQ2xpZW50IHtcbiAgICBkYjogSURiO1xuXG4gICAgY2xvc2UgKGZvcmNlPzogYm9vbGVhbik6IFByb21pc2U8dm9pZD47XG59XG5cbmV4cG9ydCBjb25zdCBJbmRleGVkQ2xpZW50OiBJbmRleGVkTW9uZ29DbGllbnRTdGF0aWMgPSBjbGFzcyBJbmRleGVkQ2xpZW50IGltcGxlbWVudHMgSW5kZXhlZE1vbmdvQ2xpZW50IHtcbiAgICBwdWJsaWMgZGI6IERiO1xuXG4gICAgY29uc3RydWN0b3IgKGRibmFtZTogc3RyaW5nKSB7XG4gICAgfVxuXG4gICAgY2xvc2UgKGZvcmNlPzogYm9vbGVhbik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuZGIuY2xvc2UoKSk7XG4gICAgfVxuXG4gICAgc3RhdGljIGNvbm5lY3QgKG5hbWU6IHN0cmluZywgb3B0aW9ucz86IEluZGV4ZWRDbGllbnRPcHRpb25zKTogUHJvbWlzZTxJbmRleGVkTW9uZ29DbGllbnQ+IHtcbiAgICAgICAgLy8gSWYgdGhlIHZlcnNpb24gaXMgbm90IHByb3ZpZGVkIGFuZCB0aGUgZGF0YWJhc2UgZXhpc3RzLCB0aGVuIGEgY29ubmVjdGlvbiB0byB0aGUgZGF0YWJhc2Ugd2lsbCBiZSBvcGVuZWQgd2l0aG91dCBjaGFuZ2luZyBpdHMgdmVyc2lvbi4gSWYgdGhlIHZlcnNpb24gaXMgbm90IHByb3ZpZGVkIGFuZCB0aGUgZGF0YWJhc2UgZG9lcyBub3QgZXhpc3QsIHRoZW4gaXQgd2lsbCBiZSBjcmVhdGVkIHdpdGggdmVyc2lvbiAxLlxuICAgICAgICBjb25zdCBjbGllbnQgPSBuZXcgSW5kZXhlZENsaWVudChuYW1lKTtcbiAgICAgICAgcmV0dXJuIERiLm9wZW4obmFtZSkudGhlbihkYiA9PiB7XG4gICAgICAgICAgICBjbGllbnQuZGIgPSBkYjtcbiAgICAgICAgICAgIHJldHVybiBjbGllbnQgYXMgSW5kZXhlZE1vbmdvQ2xpZW50O1xuICAgICAgICB9KTtcbiAgICB9XG5cbn07IiwiaW1wb3J0IHtDb2xsZWN0aW9uLCBDb2xsZWN0aW9uQ3JlYXRlT3B0aW9uc30gZnJvbSBcIi4vQ29sbGVjdGlvblwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIElEYiB7XG4gICAgY3JlYXRlQ29sbGVjdGlvbiAobmFtZTogc3RyaW5nLCBvcHRpb25zPzogQ29sbGVjdGlvbkNyZWF0ZU9wdGlvbnMpOiBQcm9taXNlPENvbGxlY3Rpb24+O1xuICAgIGNvbGxlY3Rpb24gKG5hbWU6IHN0cmluZyk6IENvbGxlY3Rpb247XG59XG5cbmV4cG9ydCBjbGFzcyBEYiBpbXBsZW1lbnRzIElEYiB7XG4gICAgcHJpdmF0ZSBjb2xsZWN0aW9uUXVldWU6IFNldDxzdHJpbmc+ID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgcHJpdmF0ZSBEQk9wZW5SZXF1ZXN0OiBJREJPcGVuREJSZXF1ZXN0O1xuXG4gICAgc3RhdGljIG9wZW4gKG5hbWU6IHN0cmluZywgY29sbGVjdGlvbnM/OiBzdHJpbmdbXSk6IFByb21pc2U8RGI+IHtcblxuICAgICAgICBjb25zdCBEQk9wZW5SZXF1ZXN0ID0gc2VsZi5pbmRleGVkREIub3BlbihuYW1lKTtcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8RGI+KChyZXNvbHZlLCByZWplY3QpID0+IHtcblxuICAgICAgICAgICAgLy8gdGhlc2UgdHdvIGV2ZW50IGhhbmRsZXJzIGFjdCBvbiB0aGUgZGF0YWJhc2UgYmVpbmcgb3BlbmVkXG4gICAgICAgICAgICAvLyBzdWNjZXNzZnVsbHksIG9yIG5vdFxuICAgICAgICAgICAgREJPcGVuUmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIHJlamVjdCk7XG4gICAgICAgICAgICBEQk9wZW5SZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3N1Y2Nlc3MnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAvLyBzdG9yZSB0aGUgcmVzdWx0IG9mIG9wZW5pbmcgdGhlIGRhdGFiYXNlIGluIHRoZSBkYlxuICAgICAgICAgICAgICAgIC8vIHZhcmlhYmxlLiBUaGlzIGlzIHVzZWQgYSBsb3QgbGF0ZXIgb24sIGZvciBvcGVuaW5nXG4gICAgICAgICAgICAgICAgLy8gdHJhbnNhY3Rpb25zIGFuZCBzdWNobGlrZS5cbiAgICAgICAgICAgICAgICBsZXQgZGIgPSBuZXcgRGIoREJPcGVuUmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoZGIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBEQk9wZW5SZXF1ZXN0Lm9uYmxvY2tlZCA9IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Jsb2NrZWQnKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yIChwcml2YXRlIGlkYjogSURCRGF0YWJhc2UpIHtcbiAgICB9XG5cbiAgICBnZXQgdmVyc2lvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlkYiA/IHRoaXMuaWRiLnZlcnNpb24gOiAwO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIG5hbWVcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtICBPcHRpb25hbFxuICAgICAqIEFuIG9wdGlvbnMgb2JqZWN0IHdob3NlIGF0dHJpYnV0ZXMgYXJlIG9wdGlvbmFsIHBhcmFtZXRlcnMgdG8gdGhlIG1ldGhvZC4gSXQgaW5jbHVkZXMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOlxuICAgICAqIHwgQXR0cmlidXRlICAgICAgICAgIHwgRGVzY3JpcHRpb24gICAgICAgfFxuICAgICAqIHwgLS0tLS0tLS0tLS0tLS0tLSB8IC0tLS0tLS0tLS0tLS0tLSAgIHxcbiAgICAgKiB8IGtleVBhdGggICAgICAgICAgfCBUaGUga2V5IHBhdGggdG8gYmUgdXNlZCBieSB0aGUgbmV3IG9iamVjdCBzdG9yZS4gSWYgZW1wdHkgb3Igbm90IHNwZWNpZmllZCwgdGhlIG9iamVjdCBzdG9yZSBpcyBjcmVhdGVkIHdpdGhvdXQgYSBrZXkgcGF0aCBhbmQgdXNlcyBvdXQtb2YtbGluZSBrZXlzLiBZb3UgY2FuIGFsc28gcGFzcyBpbiBhbiBhcnJheSBhcyBhIGtleVBhdGguIHxcbiAgICAgKiB8IGF1dG9JbmNyZW1lbnQgICAgfCBJZiB0cnVlLCB0aGUgb2JqZWN0IHN0b3JlIGhhcyBhIGtleSBnZW5lcmF0b3IuIERlZmF1bHRzIHRvIGZhbHNlLiB8XG4gICAgICogVW5rbm93biBwYXJhbWV0ZXJzIGFyZSBpZ25vcmVkLlxuICAgICAqL1xuICAgIGNyZWF0ZUNvbGxlY3Rpb24gKG5hbWU6IHN0cmluZywgb3B0aW9uczogSURCT2JqZWN0U3RvcmVQYXJhbWV0ZXJzID0ge2F1dG9JbmNyZW1lbnQgOiB0cnVlfSk6IFByb21pc2U8Q29sbGVjdGlvbj4ge1xuICAgICAgICBpZiAodGhpcy5pZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhuYW1lKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ29sbGVjdGlvbiBhbHJlYWR5IGV4aXN0c1wiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuY29sbGVjdGlvblF1ZXVlLnNpemUgJiYgIXRoaXMuREJPcGVuUmVxdWVzdCkge1xuICAgICAgICAgICAgbGV0IHYgPSB0aGlzLnZlcnNpb24gKyAxO1xuICAgICAgICAgICAgdGhpcy5pZGIuY2xvc2UoKTtcbiAgICAgICAgICAgIHRoaXMuREJPcGVuUmVxdWVzdCA9IHNlbGYuaW5kZXhlZERCLm9wZW4odGhpcy5pZGIubmFtZSwgdik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uUXVldWUuYWRkKG5hbWUpO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8Q29sbGVjdGlvbj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgLy8gdGhlc2UgdHdvIGV2ZW50IGhhbmRsZXJzIGFjdCBvbiB0aGUgZGF0YWJhc2UgYmVpbmcgb3BlbmVkXG4gICAgICAgICAgICAvLyBzdWNjZXNzZnVsbHksIG9yIG5vdFxuICAgICAgICAgICAgdGhpcy5EQk9wZW5SZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgcmVqZWN0KTtcblxuICAgICAgICAgICAgdGhpcy5EQk9wZW5SZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3VwZ3JhZGVuZWVkZWQnLCBlID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgZGI6IElEQkRhdGFiYXNlID0gdGhpcy5EQk9wZW5SZXF1ZXN0LnJlc3VsdDtcbiAgICAgICAgICAgICAgICB0aGlzLmlkYiA9IGRiO1xuICAgICAgICAgICAgICAgIC8vVGhpcyBtZXRob2QgY2FuIGJlIGNhbGxlZCBvbmx5IHdpdGhpbiBhIHZlcnNpb25jaGFuZ2UgdHJhbnNhY3Rpb24uXG4gICAgICAgICAgICAgICAgY29uc3Qgc3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZShuYW1lLCBvcHRpb25zKTtcblxuICAgICAgICAgICAgICAgIC8vIFVzZSB0cmFuc2FjdGlvbiBvbmNvbXBsZXRlIHRvIG1ha2Ugc3VyZSB0aGUgb2JqZWN0U3RvcmUgY3JlYXRpb24gaXNcbiAgICAgICAgICAgICAgICAvLyBmaW5pc2hlZCBiZWZvcmUgYWRkaW5nIGRhdGEgaW50byBpdC5cbiAgICAgICAgICAgICAgICBsZXQgdHJhbnNhY3Rpb24gPSBzdG9yZS50cmFuc2FjdGlvbjtcbiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5hZGRFdmVudExpc3RlbmVyKCdjb21wbGV0ZScsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgY29sbGVjdGlvbiA9IG5ldyBDb2xsZWN0aW9uKHN0b3JlLCB0aGlzLmlkYik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvblF1ZXVlLmRlbGV0ZShuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShjb2xsZWN0aW9uKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLkRCT3BlblJlcXVlc3Qub25zdWNjZXNzID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNvbGxlY3Rpb25RdWV1ZS5zaXplICYmIHRoaXMuREJPcGVuUmVxdWVzdCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkRCT3BlblJlcXVlc3QgPSBudWxsO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vdCBhbGwgY29sbGVjdGlvbnMgd2VyZSBjcmVhdGVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbGxlY3Rpb24gKG5hbWU6IHN0cmluZyk6IENvbGxlY3Rpb24ge1xuICAgICAgICBjb25zdCBzdG9yZSA9IHRoaXMuaWRiLnRyYW5zYWN0aW9uKG5hbWUpLm9iamVjdFN0b3JlKG5hbWUpO1xuICAgICAgICByZXR1cm4gbmV3IENvbGxlY3Rpb24oc3RvcmUsIHRoaXMuaWRiKTtcbiAgICB9XG5cbiAgICBjbG9zZSAoKSB7XG4gICAgICAgIHRoaXMuaWRiLmNsb3NlKCk7XG4gICAgfVxuXG59IiwiaW1wb3J0IHtDdXJzb3J9IGZyb20gXCIuL0N1cnNvclwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbGxlY3Rpb25DcmVhdGVPcHRpb25zIHtcblxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbGxlY3Rpb25JbnNlcnRPbmVPcHRpb25zIHtcblxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEluc2VydE9uZVdyaXRlT3BSZXN1bHQge1xuICAgIGluc2VydGVkQ291bnQ6IG51bWJlcjtcbiAgICBpbnNlcnRlZElkOiBhbnk7XG59XG5cbmludGVyZmFjZSBJbnNlcnRXcml0ZU9wUmVzdWx0IHtcbiAgICBpbnNlcnRlZENvdW50OiBudW1iZXI7XG4gICAgaW5zZXJ0ZWRJZHM6IGFueVtdO1xufVxuXG5leHBvcnQgdHlwZSBGaWx0ZXJRdWVyeTxUPiA9IHtcbiAgICBbUCBpbiBrZXlvZiBUXT86IFRbUF0gfCB7XG4gICAgJGVxPzogVFtQXTtcbiAgICAkZ3Q/OiBUW1BdO1xuICAgICRndGU/OiBUW1BdO1xuICAgICRpbj86IFRbUF1bXTtcbiAgICAkbHQ/OiBUW1BdO1xuICAgICRsdGU/OiBUW1BdO1xuICAgICRuZT86IFRbUF07XG4gICAgJG5pbj86IFRbUF1bXTtcbiAgICAkYW5kPzogKEZpbHRlclF1ZXJ5PFRbUF0+IHwgVFtQXSlbXTtcbiAgICAkb3I/OiAoRmlsdGVyUXVlcnk8VFtQXT4gfCBUW1BdKVtdO1xuICAgICRub3Q/OiAoRmlsdGVyUXVlcnk8VFtQXT4gfCBUW1BdKVtdIHwgVFtQXTtcbiAgICAkZXhwcj86IGFueTtcbiAgICAkanNvblNjaGVtYT86IGFueTtcbiAgICAkbW9kPzogW251bWJlciwgbnVtYmVyXTtcbiAgICAkcmVnZXg/OiBSZWdFeHA7XG4gICAgJG9wdGlvbnM/OiBzdHJpbmc7XG4gICAgJHRleHQ/OiB7XG4gICAgICAgICRzZWFyY2g6IHN0cmluZztcbiAgICAgICAgJGxhbmd1YWdlPzogc3RyaW5nO1xuICAgICAgICAkY2FzZVNlbnNpdGl2ZT86IGJvb2xlYW47XG4gICAgICAgICRkaWFjcmF0aWNTZW5zaXRpdmU/OiBib29sZWFuO1xuICAgIH07XG4gICAgJHdoZXJlOiBPYmplY3Q7XG4gICAgJGdlb0ludGVyc2VjdHM/OiBPYmplY3Q7XG4gICAgJGdlb1dpdGhpbj86IE9iamVjdDtcbiAgICAkbmVhcj86IE9iamVjdDtcbiAgICAkbmVhclNwaGVyZT86IE9iamVjdDtcbiAgICAkZWxlbU1hdGNoPzogT2JqZWN0O1xuICAgICRzaXplPzogbnVtYmVyO1xuICAgICRiaXRzQWxsQ2xlYXI/OiBPYmplY3Q7XG4gICAgJGJpdHNBbGxTZXQ/OiBPYmplY3Q7XG4gICAgJGJpdHNBbnlDbGVhcj86IE9iamVjdDtcbiAgICAkYml0c0FueVNldD86IE9iamVjdDtcbiAgICBba2V5OiBzdHJpbmddOiBhbnk7XG59O1xufSB8IHsgW2tleTogc3RyaW5nXTogYW55IH07XG5cbmV4cG9ydCBjbGFzcyBDb2xsZWN0aW9uIHtcbiAgICBjb25zdHJ1Y3RvciAocHJpdmF0ZSBzdG9yZTogSURCT2JqZWN0U3RvcmUsIHByaXZhdGUgaWRiOiBJREJEYXRhYmFzZSkge1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jc1xuICAgICAqIEBwYXJhbSBvcHRpb25zXG4gICAgICovXG4gICAgaW5zZXJ0T25lIChkb2NzOiBPYmplY3QsIG9wdGlvbnM/OiBDb2xsZWN0aW9uSW5zZXJ0T25lT3B0aW9ucyk6IFByb21pc2U8SW5zZXJ0T25lV3JpdGVPcFJlc3VsdD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5pbnNlcnRNYW55KFtkb2NzXSwgb3B0aW9ucykudGhlbihyZXMgPT4gKHtpbnNlcnRlZENvdW50IDogMSwgaW5zZXJ0ZWRJZCA6IHJlcy5pbnNlcnRlZElkc1swXX0pKTtcbiAgICB9XG5cbiAgICBpbnNlcnRNYW55IChkb2NzOiBPYmplY3RbXSwgb3B0aW9ucz86IENvbGxlY3Rpb25JbnNlcnRPbmVPcHRpb25zKTogUHJvbWlzZTxJbnNlcnRXcml0ZU9wUmVzdWx0PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxJbnNlcnRXcml0ZU9wUmVzdWx0PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgaW5zZXJ0ZWRJZHM6IGFueVtdID0gW107XG4gICAgICAgICAgICBsZXQgdHJhbnNhY3Rpb24gPSB0aGlzLmlkYi50cmFuc2FjdGlvbih0aGlzLnN0b3JlLm5hbWUsIFwicmVhZHdyaXRlXCIpO1xuXG4gICAgICAgICAgICAvLyBUbyBkZXRlcm1pbmUgaWYgdGhlIGFkZCBvcGVyYXRpb24gaGFzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHksXG4gICAgICAgICAgICAvLyBsaXN0ZW4gZm9yIHRoZSB0cmFuc2FjdGlvbuKAmXMgY29tcGxldGUgZXZlbnQgaW4gYWRkaXRpb24gdG8gdGhlXG4gICAgICAgICAgICAvLyBJREJPYmplY3RTdG9yZS5hZGQgcmVxdWVzdOKAmXMgc3VjY2VzcyBldmVudCxcbiAgICAgICAgICAgIC8vIGJlY2F1c2UgdGhlIHRyYW5zYWN0aW9uIG1heSBzdGlsbCBmYWlsIGFmdGVyIHRoZSBzdWNjZXNzIGV2ZW50IGZpcmVzLlxuICAgICAgICAgICAgdHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpbnNlcnRlZElkcy5sZW5ndGggPT09IGRvY3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoe2luc2VydGVkQ291bnQgOiBpbnNlcnRlZElkcy5sZW5ndGgsIGluc2VydGVkSWRzfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiTm8gc3VjY2Vzc1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdHJhbnNhY3Rpb24ub25lcnJvciA9IHJlamVjdDtcblxuICAgICAgICAgICAgY29uc3Qgb2JqZWN0U3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZSh0aGlzLnN0b3JlLm5hbWUpO1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGRvYyBvZiBkb2NzKSB7XG4gICAgICAgICAgICAgICAgLy8gTWFrZSBhIHJlcXVlc3QgdG8gYWRkIGRvY3Mgb2JqZWN0IHRvIHRoZSBvYmplY3Qgc3RvcmVcbiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RTdG9yZVJlcXVlc3QgPSBvYmplY3RTdG9yZS5hZGQoZG9jKTtcblxuICAgICAgICAgICAgICAgIG9iamVjdFN0b3JlUmVxdWVzdC5vbmVycm9yID0gcmVqZWN0O1xuICAgICAgICAgICAgICAgIG9iamVjdFN0b3JlUmVxdWVzdC5vbnN1Y2Nlc3MgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHJlc3VsdCBvZiBhIHJlcXVlc3QgZ2VuZXJhdGVkIGZyb20gYSBjYWxsIHRvIGFkZCgpXG4gICAgICAgICAgICAgICAgICAgIC8vIGlzIHRoZSBrZXkgb2YgdGhlIHZhbHVlIHRoYXQgd2FzIGFkZGVkLlxuICAgICAgICAgICAgICAgICAgICBpbnNlcnRlZElkcy5wdXNoKG9iamVjdFN0b3JlUmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIHF1ZXJ5W29wdGlvbmFsXVxuICAgICAqIFRoZSBmaW5kKCkgbWV0aG9kIHdpdGggbm8gcGFyYW1ldGVycyByZXR1cm5zIGFsbCBkb2N1bWVudHMgZnJvbSBhIGNvbGxlY3Rpb24gYW5kIHJldHVybnMgYWxsIGZpZWxkcyBmb3IgdGhlIGRvY3VtZW50cy5cbiAgICAgKi9cbiAgICBmaW5kPFQ+IChxdWVyeT86IEZpbHRlclF1ZXJ5PFQ+KTogQ3Vyc29yPFQ+IHtcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSB0aGlzLmlkYi50cmFuc2FjdGlvbih0aGlzLnN0b3JlLm5hbWUpO1xuICAgICAgICBjb25zdCBvYmplY3RTdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHRoaXMuc3RvcmUubmFtZSk7XG4gICAgICAgIC8vVE9ETzogcHJvY2VzcyB0aGUgcXVlcnlcbiAgICAgICAgLy8gVGhlIGdldEFsbCgpIG1ldGhvZCBvZiB0aGUgSURCT2JqZWN0U3RvcmUgaW50ZXJmYWNlIHJldHVybnMgYW4gSURCUmVxdWVzdCBvYmplY3RcbiAgICAgICAgLy8gY29udGFpbmluZyBhbGwgb2JqZWN0cyBpbiB0aGUgb2JqZWN0IHN0b3JlIG1hdGNoaW5nIHRoZSBzcGVjaWZpZWQgcGFyYW1ldGVyIG9yXG4gICAgICAgIC8vIGFsbCBvYmplY3RzIGluIHRoZSBzdG9yZSBpZiBubyBwYXJhbWV0ZXJzIGFyZSBnaXZlbi5cbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IG9iamVjdFN0b3JlLmdldEFsbCgpO1xuICAgICAgICByZXR1cm4gbmV3IEN1cnNvcihyZXF1ZXN0KTtcbiAgICB9XG59IiwiZXhwb3J0IGNsYXNzIEN1cnNvcjxUPiB7XG4gICAgY29uc3RydWN0b3IgKHByaXZhdGUgcmVxdWVzdDogSURCUmVxdWVzdCkge1xuXG4gICAgfVxuXG4gICAgLy8gc29ydFZhbHVlOiBzdHJpbmc7XG4gICAgLy8gdGltZW91dDogYm9vbGVhbjtcbiAgICAvLyByZWFkUHJlZmVyZW5jZTogUmVhZFByZWZlcmVuY2U7XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjYWRkQ3Vyc29yRmxhZyAqL1xuICAgIC8vIGFkZEN1cnNvckZsYWcoZmxhZzogc3RyaW5nLCB2YWx1ZTogYm9vbGVhbik6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNhZGRRdWVyeU1vZGlmaWVyICovXG4gICAgLy8gYWRkUXVlcnlNb2RpZmllcihuYW1lOiBzdHJpbmcsIHZhbHVlOiBib29sZWFuKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2JhdGNoU2l6ZSAqL1xuICAgIC8vIGJhdGNoU2l6ZSh2YWx1ZTogbnVtYmVyKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2Nsb25lICovXG4gICAgLy8gY2xvbmUoKTogQ3Vyc29yPFQ+OyAvLyBzdGlsbCByZXR1cm5zIHRoZSBzYW1lIHR5cGVcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNjbG9zZSAqL1xuICAgIC8vIGNsb3NlKCk6IFByb21pc2U8Q3Vyc29yUmVzdWx0PjtcbiAgICAvLyBjbG9zZShjYWxsYmFjazogTW9uZ29DYWxsYmFjazxDdXJzb3JSZXN1bHQ+KTogdm9pZDtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNjb2xsYXRpb24gKi9cbiAgICAvLyBjb2xsYXRpb24odmFsdWU6IE9iamVjdCk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNjb21tZW50ICovXG4gICAgLy8gY29tbWVudCh2YWx1ZTogc3RyaW5nKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2NvdW50ICovXG4gICAgLy8gY291bnQoY2FsbGJhY2s6IE1vbmdvQ2FsbGJhY2s8bnVtYmVyPik6IHZvaWQ7XG4gICAgLy8gY291bnQoYXBwbHlTa2lwTGltaXQ6IGJvb2xlYW4sIGNhbGxiYWNrOiBNb25nb0NhbGxiYWNrPG51bWJlcj4pOiB2b2lkO1xuICAgIC8vIGNvdW50KG9wdGlvbnM6IEN1cnNvckNvbW1lbnRPcHRpb25zLCBjYWxsYmFjazogTW9uZ29DYWxsYmFjazxudW1iZXI+KTogdm9pZDtcbiAgICAvLyBjb3VudChhcHBseVNraXBMaW1pdDogYm9vbGVhbiwgb3B0aW9uczogQ3Vyc29yQ29tbWVudE9wdGlvbnMsIGNhbGxiYWNrOiBNb25nb0NhbGxiYWNrPG51bWJlcj4pOiB2b2lkO1xuICAgIC8vIGNvdW50KGFwcGx5U2tpcExpbWl0PzogYm9vbGVhbiwgb3B0aW9ucz86IEN1cnNvckNvbW1lbnRPcHRpb25zKTogUHJvbWlzZTxudW1iZXI+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2V4cGxhaW4gKi9cbiAgICAvLyBleHBsYWluKCk6IFByb21pc2U8Q3Vyc29yUmVzdWx0PjtcbiAgICAvLyBleHBsYWluKGNhbGxiYWNrOiBNb25nb0NhbGxiYWNrPEN1cnNvclJlc3VsdD4pOiB2b2lkO1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2ZpbHRlciAqL1xuICAgIC8vIGZpbHRlcihmaWx0ZXI6IE9iamVjdCk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNmb3JFYWNoICovXG4gICAgLy8gZm9yRWFjaChpdGVyYXRvcjogSXRlcmF0b3JDYWxsYmFjazxUPiwgY2FsbGJhY2s6IEVuZENhbGxiYWNrKTogdm9pZDtcbiAgICAvLyBmb3JFYWNoKGl0ZXJhdG9yOiBJdGVyYXRvckNhbGxiYWNrPFQ+KTogUHJvbWlzZTx2b2lkPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNoYXNOZXh0ICovXG4gICAgLy8gaGFzTmV4dCgpOiBQcm9taXNlPGJvb2xlYW4+O1xuICAgIC8vIGhhc05leHQoY2FsbGJhY2s6IE1vbmdvQ2FsbGJhY2s8Ym9vbGVhbj4pOiB2b2lkO1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI2hpbnQgKi9cbiAgICAvLyBoaW50KGhpbnQ6IE9iamVjdCk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNpc0Nsb3NlZCAqL1xuICAgIC8vIGlzQ2xvc2VkKCk6IGJvb2xlYW47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjbGltaXQgKi9cbiAgICAvLyBsaW1pdCh2YWx1ZTogbnVtYmVyKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI21hcCAqL1xuICAgIC8vIG1hcDxVPih0cmFuc2Zvcm06IChkb2N1bWVudDogVCkgPT4gVSk6IEN1cnNvcjxVPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNtYXggKi9cbiAgICAvLyBtYXgobWF4OiBudW1iZXIpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjbWF4QXdhaXRUaW1lTVMgKi9cbiAgICAvLyBtYXhBd2FpdFRpbWVNUyh2YWx1ZTogbnVtYmVyKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI21heFNjYW4gKi9cbiAgICAvLyBtYXhTY2FuKG1heFNjYW46IE9iamVjdCk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNtYXhUaW1lTVMgKi9cbiAgICAvLyBtYXhUaW1lTVModmFsdWU6IG51bWJlcik6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNtaW4gKi9cbiAgICAvLyBtaW4obWluOiBudW1iZXIpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjbmV4dCAqL1xuICAgIC8vIG5leHQoKTogUHJvbWlzZTxUIHwgbnVsbD47XG4gICAgLy8gbmV4dChjYWxsYmFjazogTW9uZ29DYWxsYmFjazxUIHwgbnVsbD4pOiB2b2lkO1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI3Byb2plY3QgKi9cbiAgICAvLyBwcm9qZWN0KHZhbHVlOiBPYmplY3QpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjcmVhZCAqL1xuICAgIC8vIHJlYWQoc2l6ZTogbnVtYmVyKTogc3RyaW5nIHwgQnVmZmVyIHwgdm9pZDtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNuZXh0ICovXG4gICAgLy8gcmV0dXJuS2V5KHJldHVybktleTogT2JqZWN0KTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI3Jld2luZCAqL1xuICAgIC8vIHJld2luZCgpOiB2b2lkO1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI3NldEN1cnNvck9wdGlvbiAqL1xuICAgIC8vIHNldEN1cnNvck9wdGlvbihmaWVsZDogc3RyaW5nLCB2YWx1ZTogT2JqZWN0KTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI3NldFJlYWRQcmVmZXJlbmNlICovXG4gICAgLy8gc2V0UmVhZFByZWZlcmVuY2UocmVhZFByZWZlcmVuY2U6IHN0cmluZyB8IFJlYWRQcmVmZXJlbmNlKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI3Nob3dSZWNvcmRJZCAqL1xuICAgIC8vIHNob3dSZWNvcmRJZChzaG93UmVjb3JkSWQ6IE9iamVjdCk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNza2lwICovXG4gICAgLy8gc2tpcCh2YWx1ZTogbnVtYmVyKTogQ3Vyc29yPFQ+O1xuICAgIC8vIC8qKiBodHRwOi8vbW9uZ29kYi5naXRodWIuaW8vbm9kZS1tb25nb2RiLW5hdGl2ZS8zLjEvYXBpL0N1cnNvci5odG1sI3NuYXBzaG90ICovXG4gICAgLy8gc25hcHNob3Qoc25hcHNob3Q6IE9iamVjdCk6IEN1cnNvcjxUPjtcbiAgICAvLyAvKiogaHR0cDovL21vbmdvZGIuZ2l0aHViLmlvL25vZGUtbW9uZ29kYi1uYXRpdmUvMy4xL2FwaS9DdXJzb3IuaHRtbCNzb3J0ICovXG4gICAgLy8gc29ydChrZXlPckxpc3Q6IHN0cmluZyB8IE9iamVjdFtdIHwgT2JqZWN0LCBkaXJlY3Rpb24/OiBudW1iZXIpOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjc3RyZWFtICovXG4gICAgLy8gc3RyZWFtKG9wdGlvbnM/OiB7IHRyYW5zZm9ybT86IEZ1bmN0aW9uIH0pOiBDdXJzb3I8VD47XG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjdG9BcnJheSAqL1xuICAgIHRvQXJyYXkgKCk6IFByb21pc2U8VFtdPiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxUW10+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVxdWVzdC5vbmVycm9yID0gcmVqZWN0O1xuICAgICAgICAgICAgdGhpcy5yZXF1ZXN0Lm9uc3VjY2VzcyA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIERvIHNvbWV0aGluZyB3aXRoIHRoZSByZXF1ZXN0LnJlc3VsdCFcbiAgICAgICAgICAgICAgICByZXNvbHZlKHRoaXMucmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gLyoqIGh0dHA6Ly9tb25nb2RiLmdpdGh1Yi5pby9ub2RlLW1vbmdvZGItbmF0aXZlLzMuMS9hcGkvQ3Vyc29yLmh0bWwjdW5zaGlmdCAqL1xuICAgIC8vIHVuc2hpZnQoc3RyZWFtOiBCdWZmZXIgfCBzdHJpbmcpOiB2b2lkO1xufSJdLCJzb3VyY2VSb290IjoiIn0=